var u=(s,g,i)=>new Promise((p,r)=>{var n=o=>{try{l(i.next(o))}catch(e){r(e)}},_=o=>{try{l(i.throw(o))}catch(e){r(e)}},l=o=>o.done?p(o.value):Promise.resolve(o.value).then(n,_);l((i=i.apply(s,g)).next())});import{S as f,s as N,a as T,J as S,b as $,c as B}from"./index-4e626338.js";/* empty css                *//* empty css                  *//* empty css                */import{_ as V}from"./EditorWorker.vue_vue_type_script_setup_true_lang-44860150.js";import{g as P}from"./storage-b4c0d534.js";import{g as k}from"./plugin-68db7aa1.js";import{i as A}from"./icon-24f36b03.js";import{al as J,w as D,k as F,am as H,an as L}from"./elementPlus-07602b2b.js";import{d as M,r as R,c as G,a as t,w as a,o as w,h,u as d,s as y,a6 as C,x as E,G as j,H as K}from"./vue-65382a1b.js";import{_ as U}from"./xgplayerVue-c27b6911.js";import"./vueRepl-a238c739.js";import"./lodash-f91682a1.js";import"./vuema-115cb50e.js";import"./editorWorker-7e4b3ef6.js";import"./Close-095524a6.js";const q=s=>(j("data-v-0fc35020"),s=s(),K(),s),z={class:"go-edit"},Q=q(()=>h("span",{class:"go-edit-title go-mr-4"},"页面在线编辑器",-1)),W=M({__name:"index",setup(s){const{ChevronBackOutlineIcon:g,DownloadIcon:i,AnalyticsIcon:p}=A.ionicons5,r=window.showOpenFilePicker,n=R("");window.$message.warning("请不要刷新此窗口！");function _(){return u(this,null,function*(){const e=yield P();$(`编辑-${e.editCanvasConfig.projectName}`),n.value=S(e)})}setTimeout(_);function l(){k({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>u(this,null,function*(){try{const m=yield(yield r())[0].getFile(),c=new FileReader;c.readAsText(m),c.onloadend=()=>{n.value=(c.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(f.CHART,e=>{window.$message.success("正在进行更新..."),N(T.GO_CHART_STORAGE_LIST,[e.detail]),n.value=S(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),o())});function o(){return u(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");k({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=B(n.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(f.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(f.CLOSE))},(e,m)=>{const c=D,v=F,O=H,x=L,b=J;return w(),G("div",z,[t(b,null,{default:a(()=>[t(O,{class:"kh-flex-between",style:{background:"#333333"}},{default:a(()=>[h("div",null,[Q,d(r)?(w(),y(v,{key:0,class:"go-mr-3",onClick:l},{default:a(()=>[t(c,null,{default:a(()=>[t(d(i))]),_:1}),C(" 导入 ")]),_:1})):E("",!0),d(r)?(w(),y(v,{key:1,class:"go-mr-3",onClick:o},{icon:a(()=>[t(c,null,{default:a(()=>[t(d(p))]),_:1})]),default:a(()=>[C(" 保存 ")]),_:1})):E("",!0)])]),_:1}),t(x,{style:{padding:"0"}},{default:a(()=>[t(d(V),{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=I=>n.value=I),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const _e=U(W,[["__scopeId","data-v-0fc35020"]]);export{_e as default};

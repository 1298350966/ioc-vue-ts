var Ie=Object.defineProperty,we=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var de=(n,d,c)=>d in n?Ie(n,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[d]=c,j=(n,d)=>{for(var c in d||(d={}))xe.call(d,c)&&de(n,c,d[c]);if(se)for(var c of se(d))Ce.call(d,c)&&de(n,c,d[c]);return n},M=(n,d)=>we(n,De(d));var re=(n,d,c)=>new Promise((y,b)=>{var g=r=>{try{f(c.next(r))}catch(x){b(x)}},i=r=>{try{f(c.throw(r))}catch(x){b(x)}},f=r=>r.done?y(r.value):Promise.resolve(r.value).then(g,i);f((c=c.apply(n,d)).next())});import{u as pe,at as N,y as G,as as ce,z as V,g as ke,R as ie,ao as $e}from"./index-4e626338.js";import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                *//* empty css                  *//* empty css                 *//* empty css                */import{d as L,aI as me,a7 as J,g as A,al as fe,o as m,c as k,a as t,w as a,h as u,u as e,s as S,a6 as D,x as Q,F as W,q as ve,m as ue,l as z,G as te,H as ae,b as Se,f as ge,r as H,N as Ee,ah as Y,e as Re,$ as Te}from"./vue-65382a1b.js";import{i as X}from"./icon-24f36b03.js";import{c as Oe}from"./http-0d114cdb.js";import"./el-collapse-item-4ed993c7.js";/* empty css                 *//* empty css                                                                    */import{_ as $}from"./SettingItemBox-ce5066ee.js";/* empty css                        *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                     *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                                                                  *//* empty css                    *//* empty css                  *//* empty css                        */import"./chartEditStore-8641b951.js";import"./vuedraggable-26823587.js";import{_ as He}from"./index-806da9dd.js";import{n as Ue}from"./noData-2e4135e0.js";/* empty css                         */import{u as oe}from"./useTargetData.hook-7e83673b.js";import{a5 as Ne,a4 as ze,w as K,k as ne,o as he,n as ye,d as Be,i as be,$ as Fe,_ as Ae,x as qe,Q as Ve,P as Le,p as le,C as je}from"./elementPlus-07602b2b.js";import{_ as Z}from"./xgplayerVue-c27b6911.js";/* empty css                */import"./el-collapse-transition-4ed993c7.js";import{g as Me}from"./plugin-68db7aa1.js";import"./index.d-4993f78d.js";/* empty css                    *//* empty css                 *//* empty css                    *//* empty css                        */import"./pondIndex.vue_vue_type_style_index_0_scoped_9baf3e9a_lang-63a29e5a.js";/* empty css                  *//* empty css                 */import"./EditorWorker.vue_vue_type_script_setup_true_lang-44860150.js";import"./index-bf1882c4.js";import{P as Ge}from"./pondIndex-4a14e692.js";import{_ as Qe}from"./hCode-f0cdea69.js";import{_ as F}from"./SettingItem-0e9c370f.js";import{t as Ye}from"./index-55ccac47.js";import{l as Je}from"./lodash-f91682a1.js";import{C as We}from"./index-4e612df5.js";import"./vueRepl-a238c739.js";import"./vuema-115cb50e.js";import"./Close-095524a6.js";import"./axios-ba46900f.js";import"./axios-e76ab20a.js";/* empty css                   */import"./editorWorker-7e4b3ef6.js";import"./highlight-87778b4e.js";import"./echarts-676dbcd6.js";import"./fileTypeEnum-eae25d97.js";/* empty css                    */import"./useFile.hooks-6b86f602.js";const Xe=n=>(te("data-v-39517f4f"),n=n(),ae(),n),Ke={class:"go-chart-data-pond-list"},Ze={class:"pond-item-box"},et=Xe(()=>u("span",null," 创建 ",-1)),tt=["onClick"],at={class:"item-content"},ot={class:"item-content-body"},nt={class:"kh-nowrap flex-1"},lt={class:"kh-flex-between"},st={class:"kh-nowrap flex-1"},dt=["onClick"],rt=L({__name:"index",emits:["createPond","deletePond"],setup(n,{emit:d}){me(I=>({19483253:x.value}));const{DuplicateOutlineIcon:c,TrashIcon:y}=X.ionicons5,b=pe(),{chartEditStore:g,targetData:i}=oe(),{requestDataPond:f}=J(g.getRequestGlobalConfig),r=A(()=>i.value.request.requestDataPondId),x=A(()=>b.getAppTheme),w=()=>{d("createPond",!0)},_=(I,C)=>{I.stopPropagation(),I.preventDefault(),d("deletePond",C)},q=I=>{i.value.request.requestDataPondId=I.dataPondId};return(I,C)=>{const E=Ne,R=ze,P=K,O=ne,T=he,o=ye,l=Be,s=fe("Close"),h=be;return m(),k("div",Ke,[t(R,{style:{width:"20px"}},{default:a(()=>[t(E,{type:"info"}),t(E,{type:"success"})]),_:1}),u("div",Ze,[t(O,{class:"create-btn go-py-4",type:"primary",onClick:w},{icon:a(()=>[t(P,null,{default:a(()=>[t(e(c))]),_:1})]),default:a(()=>[et]),_:1}),t(T,{style:{margin:"10px 0"}}),e(f).length?Q("",!0):(m(),S(o,{key:0,justify:"center"},{default:a(()=>[u("span",{class:"not-layer-text",depth:3},[D(" 暂无数据内容， "),u("span",{onClick:w},"立即创建")])]),_:1})),t(h,null,{default:a(()=>[(m(!0),k(W,null,ve(e(f),v=>(m(),k("div",{key:v.dataPondId,class:ue([{select:v.dataPondId===r.value},"pond-item"]),onClick:p=>q(v)},[u("div",at,[u("div",ot,[u("div",null,[t(l,{class:"go-mr-1",type:v.dataPondId===r.value?"warning":"",bordered:!1},{default:a(()=>[D(" 名称 ")]),_:2},1032,["type"]),u("span",nt,z(v.dataPondName||"暂无"),1)]),u("div",lt,[t(l,{class:"go-mr-1",type:v.dataPondId===r.value?"warning":"",bordered:!1},{default:a(()=>[D(" 地址 ")]),_:2},1032,["type"]),u("span",st,z(v.dataPondRequestConfig.requestUrl||"暂无"),1)])]),u("div",{class:"item-content-icon go-transition-quick",onClick:p=>_(p,v)},[t(P,null,{default:a(()=>[t(s)]),_:1})],8,dt)]),u("div",{class:ue({"select-modal":v.dataPondId===r.value})},null,2)],10,tt))),128))]),_:1})])])}}});const ct=Z(rt,[["__scopeId","data-v-39517f4f"]]),_e=L({__name:"displayTable",props:{target:Object},setup(n){const d=n,c={key:"",value:""},y=Se({content:[]});return ge(()=>d.target,b=>{y.content=[];for(const g in b)y.content.push({key:g,value:b[g]});y.content.length||(y.content=[JSON.parse(JSON.stringify(c))])},{immediate:!0,deep:!0}),(b,g)=>{const i=Fe,f=Ae;return m(),S(f,{data:y.content,border:""},{default:a(()=>[t(i,{prop:"key",label:"key"},{default:a(({row:r})=>[D(z(r.key||"暂无"),1)]),_:1}),t(i,{prop:"value",label:"value"},{default:a(({row:r})=>[D(z(r.value||"暂无"),1)]),_:1})]),_:1},8,["data"])}}}),Pe=n=>(te("data-v-7903058d"),n=n(),ae(),n),it={class:"go-chart-data-display"},ut={class:"go-mr-3"},_t={key:0},pt={class:"go-mt-3"},mt={key:0},ft={key:1},vt=Pe(()=>u("span",null,"该接口没有 Body 体",-1)),gt={key:1},ht=Pe(()=>u("span",null,"sql",-1)),yt=L({__name:"index",props:{globalData:Object,targetData:Object},setup(n){const d=n,{HelpOutlineIcon:c,FlashIcon:y,PulseIcon:b}=X.ionicons5,{requestUrl:g,requestInterval:i,requestHttpType:f,requestContentType:r,requestSQLContent:x,requestParams:w,requestParamsBodyType:_,requestIntervalUnit:q}=J(d.targetData.dataPondRequestConfig);N.HEADER;const I={[G.DEFAULT]:"普通请求",[G.SQL]:"SQL 请求"},C=H(N.PARAMS);return(E,R)=>{const P=qe,O=K,T=he,o=Ve,l=Le,s=le,h=Qe,v=be;return m(),k("div",it,[t(v,{style:{"max-height":"570px"}},{default:a(()=>[u("div",ut,[u("div",null,[t(e($),{name:"主体信息"},{default:a(()=>[t(e(F),{name:"接口名称"},{default:a(()=>{var p;return[t(P,{size:"small",placeholder:((p=n.targetData)==null?void 0:p.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),t(e(F),{name:"接口类型"},{default:a(()=>[t(P,{size:"small",placeholder:e(f)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),t(e($),null,{default:a(()=>[t(e(F),{name:"组件间隔"},{default:a(()=>[t(P,{size:"small",placeholder:`${e(i)||"暂无"}`,disabled:!0},{suffix:a(()=>[D(z(n.targetData&&e(ce)[e(q)]),1)]),_:1},8,["placeholder"])]),_:1}),t(e(F),{name:"全局间隔（默认）"},{default:a(()=>{var p;return[t(P,{size:"small",placeholder:`${((p=n.globalData)==null?void 0:p.requestInterval)||"暂无"}`,disabled:!0},{suffix:a(()=>[D(z(n.globalData&&e(ce)[n.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),t(e($),{name:"源地址",alone:!0},{default:a(()=>{var p;return[t(P,{size:"small",placeholder:((p=n.globalData)==null?void 0:p.requestOriginUrl)||"暂无",disabled:!0},{prefix:a(()=>[t(O,{component:e(b)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),t(e($),{name:"接口地址",alone:!0},{default:a(()=>[t(P,{size:"small",placeholder:e(g)||"暂无",disabled:!0},{prefix:a(()=>[t(O,{component:e(y)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),t(T),t(e($),{name:"类型"},{default:a(()=>[t(e(F),{name:"配置类型"},{default:a(()=>[t(P,{size:"small",placeholder:n.targetData&&I[e(r)],disabled:!0},null,8,["placeholder"])]),_:1}),e(r)===e(G).DEFAULT?(m(),S(e(F),{key:0,name:"body 类型"},{default:a(()=>[t(P,{size:"small",placeholder:n.targetData&&e(_),disabled:!0},null,8,["placeholder"])]),_:1})):Q("",!0)]),_:1}),e(r)===e(G).DEFAULT?(m(),k("div",_t,[t(l,{modelValue:C.value,"onUpdate:modelValue":R[0]||(R[0]=p=>C.value=p)},{default:a(()=>[(m(!0),k(W,null,ve(e(N),p=>(m(),S(o,{key:p,name:p,label:p},{default:a(()=>[D(z(p),1)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"]),u("div",pt,[C.value!==e(N).BODY?(m(),k("div",mt,[t(_e,{class:"go-my-3",target:e(w)[C.value]},null,8,["target"])])):(m(),k("div",ft,[e(_)===e(V).NONE?(m(),S(s,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[vt]),_:1})):e(_)===e(V).FORM_DATA||e(_)===e(V).X_WWW_FORM_URLENCODED?(m(),S(_e,{key:1,class:"go-my-3",target:e(w)[e(N).BODY][e(_)]},null,8,["target"])):e(_)===e(V).JSON?(m(),S(s,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[t(h,{code:e(w)[e(N).BODY][e(_)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):e(_)===e(V).XML?(m(),S(h,{key:3,code:e(w)[e(N).BODY][e(_)]||"",language:"html"},null,8,["code"])):Q("",!0)]))])])):(m(),k("div",gt,[t(e($),{name:"键名"},{default:a(()=>[ht]),_:1}),t(e($),{name:"键值"},{default:a(()=>[t(h,{code:e(x).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const bt=Z(yt,[["__scopeId","data-v-7903058d"]]),qt=n=>(te("data-v-9dd86f91"),n=n(),ae(),n),Pt={class:"pond-content"},It={key:1,class:"no-data go-flex-center"},wt=["src"],Dt=qt(()=>u("span",null,"暂未选择公共接口",-1)),xt=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(n,{emit:d}){const c=n,{PencilIcon:y}=X.ionicons5,{chartEditStore:b,targetData:g}=oe(),{requestDataPond:i}=J(b.getRequestGlobalConfig),f=H(!1),r=A({get(){return c.modelShow},set(o){d("update:modelShow",o)}}),x=H(!1),w=H(!1),_=H(),q=A(()=>{var s,h;const o=(h=(s=g==null?void 0:g.value)==null?void 0:s.request)==null?void 0:h.requestDataPondId;return o?i.value.filter(v=>o===v.dataPondId)[0]:void 0});ge(()=>q.value,o=>{x.value=!0,_.value=o,Ee(()=>{x.value=!1})},{immediate:!0});const I=(o=!1)=>{w.value=!!o,f.value=!0},C=()=>{const o=ke();_.value={dataPondId:o,dataPondName:o,dataPondRequestConfig:Je.cloneDeep(M(j({},Ye),{requestDataType:ie.Pond}))},I()},E=o=>{w.value?R(o):P(o),w.value=!1,f.value=!1},R=o=>{try{const l=i.value.findIndex(s=>s.dataPondId===o.dataPondId);l!==-1?(i.value.splice(l,1,o),b.getComponentList.forEach(s=>{s.request.requestDataType===ie.Pond&&s.request.requestDataPondId===o.dataPondId&&(s.request=M(j({},Y(o.dataPondRequestConfig)),{requestDataPondId:o.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(l){window.$message.error("编辑失败，请稍后重试！")}},P=o=>{try{_.value?(i.value.unshift(o),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(l){window.$message.error("创建失败，请稍后重试!")}},O=o=>{Me({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const l=i.value.findIndex(s=>s.dataPondId===o.dataPondId);l!==-1?(i.value.splice(l,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},T=()=>{q.value&&(g.value.request=M(j({},Y(q.value.dataPondRequestConfig)),{requestDataPondId:q.value.dataPondId})),d("update:modelShow",!1),d("sendHandle")};return(o,l)=>{const s=le,h=K,v=ne,p=ye,ee=He;return m(),k(W,null,[t(ee,{title:"公共接口配置",class:"go-chart-data-pond-control",modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=B=>r.value=B)},{footer:a(()=>[t(p,{justify:"space-between"},{default:a(()=>[t(v,{type:"info",secondary:"",disabled:!q.value,onClick:l[0]||(l[0]=B=>I(!0))},{icon:a(()=>[t(h,null,{default:a(()=>[t(e(y))]),_:1})]),default:a(()=>[D(" 编辑内容 ")]),_:1},8,["disabled"]),t(v,{type:"primary",onClick:T},{default:a(()=>[D("保存 & 发送请求")]),_:1})]),_:1})]),default:a(()=>[t(s,{style:{height:"650px"}},{default:a(()=>[u("div",Pt,[q.value&&!x.value?(m(),S(e(bt),{key:0,targetData:q.value,globalData:e(b).getRequestGlobalConfig},null,8,["targetData","globalData"])):(m(),k("div",It,[u("img",{src:e(Ue),alt:"暂无数据"},null,8,wt),Dt])),t(e(ct),{onCreatePond:C,onDeletePond:O})])]),_:1})]),_:1},8,["modelValue"]),f.value?(m(),S(e(Ge),{key:0,modelShow:f.value,"onUpdate:modelShow":l[2]||(l[2]=B=>f.value=B),targetDataRequest:_.value,isEdit:w.value,onEditSaveHandle:E},null,8,["modelShow","targetDataRequest","isEdit"])):Q("",!0)],64)}}});const Ct=Z(xt,[["__scopeId","data-v-9dd86f91"]]),kt={class:"chart-data-pond"},$t={class:"kh-absolute-center"},St=L({__name:"index",setup(n){me(o=>({"43d85583":P.value}));const d=pe(),{HelpOutlineIcon:c,FlashIcon:y,PulseIcon:b,FishIcon:g}=X.ionicons5,{targetData:i,chartEditStore:f}=oe(),{requestDataPond:r,requestInterval:x,requestIntervalUnit:w}=J(f.getRequestGlobalConfig),_=H(!1),q=H(!1),I=H(!1);let C=0,E;const R=A(()=>{const o=i.value.request.requestDataPondId;return o?r.value.filter(s=>o===s.dataPondId)[0]:void 0}),P=A(()=>d.getAppTheme),O=()=>{q.value=!0},T=()=>re(this,null,function*(){var o;if(!((o=i.value)!=null&&o.request)){window.$message.warning("请选择一个公共接口！");return}_.value=!0;try{const l=yield Oe(Y(i.value.request),Y(f.getRequestGlobalConfig));if(_.value=!1,console.log(l),l){!(l!=null&&l.data)&&!i.value.filter&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！");let{filter:s,filterNode:h}=i.value;!s&&h&&(s="return data."+h),i.value.data=$e(l==null?void 0:l.data,l,s),I.value=!0;return}window.$message.warning("数据异常，请检查参数！")}catch(l){_.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Re(()=>{var l;const o=(l=i.value)==null?void 0:l.filter;E!==o&&C&&(E=o,T()),C++}),Te(()=>{E=null}),(o,l)=>{const s=K,h=qe,v=ne,p=le,ee=je,B=fe("go-skeleton");return m(),k(W,null,[u("div",kt,[t(p,{class:"el-card-shallow"},{default:a(()=>[t(e($),{name:"请求名称",alone:!0},{default:a(()=>{var U;return[t(h,{size:"small",placeholder:((U=R.value)==null?void 0:U.dataPondName)||"暂无",disabled:!0},{prefix:a(()=>[t(s,{component:e(g)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),t(e($),{name:"接口地址",alone:!0},{default:a(()=>{var U;return[t(h,{size:"small",placeholder:((U=R.value)==null?void 0:U.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:a(()=>[t(s,{component:e(y)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),u("div",{class:"edit-text",onClick:O},[u("div",$t,[t(v,{type:"primary"},{default:a(()=>[D("编辑配置")]),_:1})])])]),_:1})]),t(e($),{alone:!0},{name:a(()=>[D(" 测试 "),t(ee,{trigger:"hover",content:"默认赋值给 dataset 字段"},{default:a(()=>[t(s,{size:"21",depth:3},{default:a(()=>[t(e(c))]),_:1})]),_:1})]),default:a(()=>[t(v,{type:"primary",ghost:"",onClick:T},{icon:a(()=>[t(s,null,{default:a(()=>[t(e(y))]),_:1})]),default:a(()=>[D(" 发送请求 ")]),_:1})]),_:1}),t(e(We),{show:I.value&&!_.value,ajax:!0},null,8,["show"]),t(B,{load:_.value,repeat:3},null,8,["load"]),t(e(Ct),{modelShow:q.value,"onUpdate:modelShow":l[0]||(l[0]=U=>q.value=U),onSendHandle:T},null,8,["modelShow"])],64)}}});const La=Z(St,[["__scopeId","data-v-ea46d548"]]);export{La as default};

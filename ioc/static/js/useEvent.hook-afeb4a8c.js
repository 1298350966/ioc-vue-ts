var V=Object.defineProperty;var y=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var m=(e,n,o)=>n in e?V(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,v=(e,n)=>{for(var o in n||(n={}))k.call(n,o)&&m(e,o,n[o]);if(y)for(var o of y(n))F.call(n,o)&&m(e,o,n[o]);return e};import{E as EventLife}from"./index-4e626338.js";import{e as echarts}from"./echarts-676dbcd6.js";import{l as lodashExports}from"./lodash-f91682a1.js";import{i as inject}from"./vue-65382a1b.js";const components={},npmPkgs={echarts},useLifeHandler=(e,n)=>{if(!e.events)return{};const o=inject("rootConfig");console.log(n);const s={},u={};e.events.configEvents.baseEvent.forEach(t=>{s[t.type]||(s[t.type]=[]),t.trigger.forEach(r=>{if(r.type=="componentList"){let i=o[r.type].find(p=>p.id=r.targetId);if(i){const p=d=>{let E={e:d,data:e.option.dataset};console.log(getValue(lodashExports.cloneDeep(d.value),E)),r.update.forEach(f=>{f.key.length==1?i[f.key]=getValue(lodashExports.cloneDeep(f.value),E):lodashExports.get(i,f.key.slice(0,-1))[f.key.slice(-1)]=getValue(lodashExports.cloneDeep(f.value),E),console.log(i)})};s[t.type].push(p)}}else if(r.type=="globalDialog"){let i=o[r.type].find(p=>p.id=r.targetId);if(i){const p=d=>{let E={e:d,data:e.option.dataset};r.update.forEach(f=>{f.key.length==1?i[f.key]=getValue(lodashExports.cloneDeep(f.value),E):lodashExports.get(i,f.key.slice(0,-1))[f.key.slice(-1)]=getValue(lodashExports.cloneDeep(f.value),E),console.log(i)})};s[t.type].push(p)}}})}),setEChartsEvents(e.events.configEvents.eChartsEvents,o,s),console.log(e.events.configEvents.eChartsEvents);for(const t in e.events.baseEvent){const r=e.events.baseEvent[t];if(r){s[t]||(s[t]=[]);let i=p=>{generateBaseFunc(r).bind(components[e.id],p,e,o)()};s[t].push(i)}}const a=e.events.advancedEvents||{},l={[EventLife.VNODE_BEFORE_MOUNT](t){components[e.id]=t.component;const r=(a[EventLife.VNODE_BEFORE_MOUNT]||"").trim();generateFunc(r,t)},[EventLife.VNODE_MOUNTED](t){const r=(a[EventLife.VNODE_MOUNTED]||"").trim();generateFunc(r,t)}};for(const t in s)u[t]=r=>{console.log(r,e,o),s[t].forEach(i=>{i(r)})};return v(v({},u),l)};function generateBaseFunc(e){try{return new Function(`
      return (
        async function(mouseEvent,config,$root){
          ${e}
        }
      )`)()}catch(n){console.error(n)}}function generateFunc(e,n){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(npmPkgs).join()}} = node_modules;
          ${e}
        }
      )`)().bind(n==null?void 0:n.component)(n,components,npmPkgs)}catch(o){console.error(o)}}function getValue(value,data){if(typeof value=="object"){for(const e in value){const n=value[e];value[e]=getValue(n,data)}return value}else return typeof value=="string"&&/\$\{([^\}]+)\}/g.test(value)&&value.replace(/\$\{([^\}]+)\}/g,(_,key)=>(/\(\)/.test(key)?value=eval("data."+key):value=lodashExports.get(data,key),_)),value}function setEChartsEvents(e,n,o){e.forEach(s=>{o[s.type]||(o[s.type]=[]),s.trigger.forEach(u=>{console.log("output->",n,u);let a=n[u.type].find(l=>l.id==u.targetId);if(a){const l=t=>{setComponentValue(u,a,{e:t}),console.log(a)};o[s.type].push(l)}})})}function setComponentValue(e,n,o){console.log(e,n,o),Object.keys(e.updateValue).map(s=>{let u=`${s}`;if(Array.isArray(e.updateValue[s])){let l={};e.updateValue[s].forEach(t=>{l[t.key]=t.value});var a=getValue(lodashExports.cloneDeep(l),o)}else var a=getValue(lodashExports.cloneDeep(e.updateValue[s]),o);try{if(typeof a=="object"){let l=lodashExports.get(n,s),{targetId:t,updateValue:r}=e.updateValue[s];if(Array.isArray(l)&&t&&r){let i=l.find(p=>t==p.id);i&&setComponentValue(e.updateValue[s],i,o)}else Object.assign(lodashExports.get(n,u),a)}else lodashExports.set(n,s,a)}catch(l){console.log(l)}})}function setConfigEvents(e,n,o,s,u=null){let a=s[1];a&&e.forEach(l=>{l.trigger.forEach(t=>{let r=a[t.type].find(i=>i.id=t.targetId);if(r){const i=(...p)=>{const d=o[l.type].paramsName;let E={},f=d.length-s.length;d.slice(0,f>0?f:0).forEach((g,h)=>{E[g]=p[h]}),d.slice(f,d.length).forEach((g,h)=>{E[g]=s[h]}),checkFiltersFun(l.filters)&&(setComponentValue(t,r,E),console.log(r))};n.on(l.type,i.bind(u))}})})}function setCodeEvents(e,n,o,s,u=null){Object.keys(e).forEach(a=>{n.on(a,(...l)=>{const t=o[a].paramsName,r=[];let i=t.length-s.length;t.slice(0,i>0?i:0).forEach((p,d)=>{r.push(l[d])}),s.forEach(p=>{r.push(p)});try{new Function(...t,e[a]).call(u,...r)}catch(p){console.error(p)}})})}function checkFiltersFun(filters,_args){if(!filters||filters.conditions.length==0)return!0;let str="";return filters.conditions.forEach(c=>{let c_str="";c.conditions.forEach(condition=>{let condition_str="";condition_str+="getValue(condition.key,_args)",condition_str+=condition.condition,condition_str+="getValue(condition.value,_args)",c_str?c_str+=c.type+eval(condition_str):c_str+=eval(condition_str)}),str?str+=filters.type+eval(c_str):str+=eval(c_str)}),eval(str)}const useEvent=()=>{let e={};function n(u,a){e[u]?e[u].push(a):e[u]=[a]}function o(u,a){const l=e[u],t=l.indexOf(a);t!=-1&&l.splice(t,1)}function s(u,...a){e[u]&&e[u].forEach(l=>{l(...a)})}return{all:e,on:n,off:o,emit:s}};export{useEvent as a,setCodeEvents as b,checkFiltersFun as c,setConfigEvents as d,setComponentValue as s,useLifeHandler as u};

import{E as tt,B as xt,U as Dr,D as Ar,a as Tr,b as kr}from"./xgplayer-65a6fa30.js";function Bt(n,s){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,t)}return e}function ae(n){for(var s=1;s<arguments.length;s++){var e=arguments[s]!=null?arguments[s]:{};s%2?Bt(Object(e),!0).forEach(function(t){M(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Bt(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function q(){q=function(){return n};var n={},s=Object.prototype,e=s.hasOwnProperty,t=Object.defineProperty||function(v,h,m){v[h]=m.value},r=typeof Symbol=="function"?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function u(v,h,m){return Object.defineProperty(v,h,{value:m,enumerable:!0,configurable:!0,writable:!0}),v[h]}try{u({},"")}catch(v){u=function(h,m,A){return h[m]=A}}function l(v,h,m,A){var b=h&&h.prototype instanceof d?h:d,C=Object.create(b.prototype),B=new K(A||[]);return t(C,"_invoke",{value:k(v,m,B)}),C}function f(v,h,m){try{return{type:"normal",arg:v.call(h,m)}}catch(A){return{type:"throw",arg:A}}}n.wrap=l;var c={};function d(){}function p(){}function _(){}var E={};u(E,i,function(){return this});var g=Object.getPrototypeOf,S=g&&g(g(U([])));S&&S!==s&&e.call(S,i)&&(E=S);var R=_.prototype=d.prototype=Object.create(E);function T(v){["next","throw","return"].forEach(function(h){u(v,h,function(m){return this._invoke(h,m)})})}function y(v,h){function m(b,C,B,j){var H=f(v[b],v,C);if(H.type!=="throw"){var P=H.arg,ee=P.value;return ee&&typeof ee=="object"&&e.call(ee,"__await")?h.resolve(ee.__await).then(function(I){m("next",I,B,j)},function(I){m("throw",I,B,j)}):h.resolve(ee).then(function(I){P.value=I,B(P)},function(I){return m("throw",I,B,j)})}j(H.arg)}var A;t(this,"_invoke",{value:function(b,C){function B(){return new h(function(j,H){m(b,C,j,H)})}return A=A?A.then(B,B):B()}})}function k(v,h,m){var A="suspendedStart";return function(b,C){if(A==="executing")throw new Error("Generator is already running");if(A==="completed"){if(b==="throw")throw C;return J()}for(m.method=b,m.arg=C;;){var B=m.delegate;if(B){var j=N(B,m);if(j){if(j===c)continue;return j}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(A==="suspendedStart")throw A="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);A="executing";var H=f(v,h,m);if(H.type==="normal"){if(A=m.done?"completed":"suspendedYield",H.arg===c)continue;return{value:H.arg,done:m.done}}H.type==="throw"&&(A="completed",m.method="throw",m.arg=H.arg)}}}function N(v,h){var m=h.method,A=v.iterator[m];if(A===void 0)return h.delegate=null,m==="throw"&&v.iterator.return&&(h.method="return",h.arg=void 0,N(v,h),h.method==="throw")||m!=="return"&&(h.method="throw",h.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var b=f(A,v.iterator,h.arg);if(b.type==="throw")return h.method="throw",h.arg=b.arg,h.delegate=null,c;var C=b.arg;return C?C.done?(h[v.resultName]=C.value,h.next=v.nextLoc,h.method!=="return"&&(h.method="next",h.arg=void 0),h.delegate=null,c):C:(h.method="throw",h.arg=new TypeError("iterator result is not an object"),h.delegate=null,c)}function z(v){var h={tryLoc:v[0]};1 in v&&(h.catchLoc=v[1]),2 in v&&(h.finallyLoc=v[2],h.afterLoc=v[3]),this.tryEntries.push(h)}function G(v){var h=v.completion||{};h.type="normal",delete h.arg,v.completion=h}function K(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(z,this),this.reset(!0)}function U(v){if(v){var h=v[i];if(h)return h.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var m=-1,A=function b(){for(;++m<v.length;)if(e.call(v,m))return b.value=v[m],b.done=!1,b;return b.value=void 0,b.done=!0,b};return A.next=A}}return{next:J}}function J(){return{value:void 0,done:!0}}return p.prototype=_,t(R,"constructor",{value:_,configurable:!0}),t(_,"constructor",{value:p,configurable:!0}),p.displayName=u(_,o,"GeneratorFunction"),n.isGeneratorFunction=function(v){var h=typeof v=="function"&&v.constructor;return!!h&&(h===p||(h.displayName||h.name)==="GeneratorFunction")},n.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,_):(v.__proto__=_,u(v,o,"GeneratorFunction")),v.prototype=Object.create(R),v},n.awrap=function(v){return{__await:v}},T(y.prototype),u(y.prototype,a,function(){return this}),n.AsyncIterator=y,n.async=function(v,h,m,A,b){b===void 0&&(b=Promise);var C=new y(l(v,h,m,A),b);return n.isGeneratorFunction(h)?C:C.next().then(function(B){return B.done?B.value:C.next()})},T(R),u(R,o,"Generator"),u(R,i,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),n.keys=function(v){var h=Object(v),m=[];for(var A in h)m.push(A);return m.reverse(),function b(){for(;m.length;){var C=m.pop();if(C in h)return b.value=C,b.done=!1,b}return b.done=!0,b}},n.values=U,K.prototype={constructor:K,reset:function(v){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(G),!v)for(var h in this)h.charAt(0)==="t"&&e.call(this,h)&&!isNaN(+h.slice(1))&&(this[h]=void 0)},stop:function(){this.done=!0;var v=this.tryEntries[0].completion;if(v.type==="throw")throw v.arg;return this.rval},dispatchException:function(v){if(this.done)throw v;var h=this;function m(H,P){return C.type="throw",C.arg=v,h.next=H,P&&(h.method="next",h.arg=void 0),!!P}for(var A=this.tryEntries.length-1;A>=0;--A){var b=this.tryEntries[A],C=b.completion;if(b.tryLoc==="root")return m("end");if(b.tryLoc<=this.prev){var B=e.call(b,"catchLoc"),j=e.call(b,"finallyLoc");if(B&&j){if(this.prev<b.catchLoc)return m(b.catchLoc,!0);if(this.prev<b.finallyLoc)return m(b.finallyLoc)}else if(B){if(this.prev<b.catchLoc)return m(b.catchLoc,!0)}else{if(!j)throw new Error("try statement without catch or finally");if(this.prev<b.finallyLoc)return m(b.finallyLoc)}}}},abrupt:function(v,h){for(var m=this.tryEntries.length-1;m>=0;--m){var A=this.tryEntries[m];if(A.tryLoc<=this.prev&&e.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var b=A;break}}b&&(v==="break"||v==="continue")&&b.tryLoc<=h&&h<=b.finallyLoc&&(b=null);var C=b?b.completion:{};return C.type=v,C.arg=h,b?(this.method="next",this.next=b.finallyLoc,c):this.complete(C)},complete:function(v,h){if(v.type==="throw")throw v.arg;return v.type==="break"||v.type==="continue"?this.next=v.arg:v.type==="return"?(this.rval=this.arg=v.arg,this.method="return",this.next="end"):v.type==="normal"&&h&&(this.next=h),c},finish:function(v){for(var h=this.tryEntries.length-1;h>=0;--h){var m=this.tryEntries[h];if(m.finallyLoc===v)return this.complete(m.completion,m.afterLoc),G(m),c}},catch:function(v){for(var h=this.tryEntries.length-1;h>=0;--h){var m=this.tryEntries[h];if(m.tryLoc===v){var A=m.completion;if(A.type==="throw"){var b=A.arg;G(m)}return b}}throw new Error("illegal catch attempt")},delegateYield:function(v,h,m){return this.delegate={iterator:U(v),resultName:h,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},n}function Mt(n,s,e,t,r,i,a){try{var o=n[i](a),u=o.value}catch(l){e(l);return}o.done?s(u):Promise.resolve(u).then(t,r)}function ne(n){return function(){var s=this,e=arguments;return new Promise(function(t,r){var i=n.apply(s,e);function a(u){Mt(i,t,r,a,o,"next",u)}function o(u){Mt(i,t,r,a,o,"throw",u)}a(void 0)})}}function rt(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")}function Ut(n,s){for(var e=0;e<s.length;e++){var t=s[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,sr(t.key),t)}}function it(n,s,e){return s&&Ut(n.prototype,s),e&&Ut(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function M(n,s,e){return s=sr(s),s in n?Object.defineProperty(n,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[s]=e,n}function nr(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(s&&s.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),s&&_t(n,s)}function Je(n){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(n)}function _t(n,s){return _t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},_t(n,s)}function Or(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function W(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Rr(n,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return W(n)}function ar(n){var s=Or();return function(){var t=Je(n),r;if(s){var i=Je(this).constructor;r=Reflect.construct(t,arguments,i)}else r=t.apply(this,arguments);return Rr(this,r)}}function Pr(n,s){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var t=e.call(n,s||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}function sr(n){var s=Pr(n,"string");return typeof s=="symbol"?s:String(s)}function Nt(n,s){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,t)}return e}function Ve(n){for(var s=1;s<arguments.length;s++){var e=arguments[s]!=null?arguments[s]:{};s%2?Nt(Object(e),!0).forEach(function(t){D(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Nt(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function te(){te=function(){return n};var n={},s=Object.prototype,e=s.hasOwnProperty,t=Object.defineProperty||function(v,h,m){v[h]=m.value},r=typeof Symbol=="function"?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function u(v,h,m){return Object.defineProperty(v,h,{value:m,enumerable:!0,configurable:!0,writable:!0}),v[h]}try{u({},"")}catch(v){u=function(h,m,A){return h[m]=A}}function l(v,h,m,A){var b=h&&h.prototype instanceof d?h:d,C=Object.create(b.prototype),B=new K(A||[]);return t(C,"_invoke",{value:k(v,m,B)}),C}function f(v,h,m){try{return{type:"normal",arg:v.call(h,m)}}catch(A){return{type:"throw",arg:A}}}n.wrap=l;var c={};function d(){}function p(){}function _(){}var E={};u(E,i,function(){return this});var g=Object.getPrototypeOf,S=g&&g(g(U([])));S&&S!==s&&e.call(S,i)&&(E=S);var R=_.prototype=d.prototype=Object.create(E);function T(v){["next","throw","return"].forEach(function(h){u(v,h,function(m){return this._invoke(h,m)})})}function y(v,h){function m(b,C,B,j){var H=f(v[b],v,C);if(H.type!=="throw"){var P=H.arg,ee=P.value;return ee&&typeof ee=="object"&&e.call(ee,"__await")?h.resolve(ee.__await).then(function(I){m("next",I,B,j)},function(I){m("throw",I,B,j)}):h.resolve(ee).then(function(I){P.value=I,B(P)},function(I){return m("throw",I,B,j)})}j(H.arg)}var A;t(this,"_invoke",{value:function(b,C){function B(){return new h(function(j,H){m(b,C,j,H)})}return A=A?A.then(B,B):B()}})}function k(v,h,m){var A="suspendedStart";return function(b,C){if(A==="executing")throw new Error("Generator is already running");if(A==="completed"){if(b==="throw")throw C;return J()}for(m.method=b,m.arg=C;;){var B=m.delegate;if(B){var j=N(B,m);if(j){if(j===c)continue;return j}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(A==="suspendedStart")throw A="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);A="executing";var H=f(v,h,m);if(H.type==="normal"){if(A=m.done?"completed":"suspendedYield",H.arg===c)continue;return{value:H.arg,done:m.done}}H.type==="throw"&&(A="completed",m.method="throw",m.arg=H.arg)}}}function N(v,h){var m=h.method,A=v.iterator[m];if(A===void 0)return h.delegate=null,m==="throw"&&v.iterator.return&&(h.method="return",h.arg=void 0,N(v,h),h.method==="throw")||m!=="return"&&(h.method="throw",h.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var b=f(A,v.iterator,h.arg);if(b.type==="throw")return h.method="throw",h.arg=b.arg,h.delegate=null,c;var C=b.arg;return C?C.done?(h[v.resultName]=C.value,h.next=v.nextLoc,h.method!=="return"&&(h.method="next",h.arg=void 0),h.delegate=null,c):C:(h.method="throw",h.arg=new TypeError("iterator result is not an object"),h.delegate=null,c)}function z(v){var h={tryLoc:v[0]};1 in v&&(h.catchLoc=v[1]),2 in v&&(h.finallyLoc=v[2],h.afterLoc=v[3]),this.tryEntries.push(h)}function G(v){var h=v.completion||{};h.type="normal",delete h.arg,v.completion=h}function K(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(z,this),this.reset(!0)}function U(v){if(v){var h=v[i];if(h)return h.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var m=-1,A=function b(){for(;++m<v.length;)if(e.call(v,m))return b.value=v[m],b.done=!1,b;return b.value=void 0,b.done=!0,b};return A.next=A}}return{next:J}}function J(){return{value:void 0,done:!0}}return p.prototype=_,t(R,"constructor",{value:_,configurable:!0}),t(_,"constructor",{value:p,configurable:!0}),p.displayName=u(_,o,"GeneratorFunction"),n.isGeneratorFunction=function(v){var h=typeof v=="function"&&v.constructor;return!!h&&(h===p||(h.displayName||h.name)==="GeneratorFunction")},n.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,_):(v.__proto__=_,u(v,o,"GeneratorFunction")),v.prototype=Object.create(R),v},n.awrap=function(v){return{__await:v}},T(y.prototype),u(y.prototype,a,function(){return this}),n.AsyncIterator=y,n.async=function(v,h,m,A,b){b===void 0&&(b=Promise);var C=new y(l(v,h,m,A),b);return n.isGeneratorFunction(h)?C:C.next().then(function(B){return B.done?B.value:C.next()})},T(R),u(R,o,"Generator"),u(R,i,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),n.keys=function(v){var h=Object(v),m=[];for(var A in h)m.push(A);return m.reverse(),function b(){for(;m.length;){var C=m.pop();if(C in h)return b.value=C,b.done=!1,b}return b.done=!0,b}},n.values=U,K.prototype={constructor:K,reset:function(v){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(G),!v)for(var h in this)h.charAt(0)==="t"&&e.call(this,h)&&!isNaN(+h.slice(1))&&(this[h]=void 0)},stop:function(){this.done=!0;var v=this.tryEntries[0].completion;if(v.type==="throw")throw v.arg;return this.rval},dispatchException:function(v){if(this.done)throw v;var h=this;function m(H,P){return C.type="throw",C.arg=v,h.next=H,P&&(h.method="next",h.arg=void 0),!!P}for(var A=this.tryEntries.length-1;A>=0;--A){var b=this.tryEntries[A],C=b.completion;if(b.tryLoc==="root")return m("end");if(b.tryLoc<=this.prev){var B=e.call(b,"catchLoc"),j=e.call(b,"finallyLoc");if(B&&j){if(this.prev<b.catchLoc)return m(b.catchLoc,!0);if(this.prev<b.finallyLoc)return m(b.finallyLoc)}else if(B){if(this.prev<b.catchLoc)return m(b.catchLoc,!0)}else{if(!j)throw new Error("try statement without catch or finally");if(this.prev<b.finallyLoc)return m(b.finallyLoc)}}}},abrupt:function(v,h){for(var m=this.tryEntries.length-1;m>=0;--m){var A=this.tryEntries[m];if(A.tryLoc<=this.prev&&e.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var b=A;break}}b&&(v==="break"||v==="continue")&&b.tryLoc<=h&&h<=b.finallyLoc&&(b=null);var C=b?b.completion:{};return C.type=v,C.arg=h,b?(this.method="next",this.next=b.finallyLoc,c):this.complete(C)},complete:function(v,h){if(v.type==="throw")throw v.arg;return v.type==="break"||v.type==="continue"?this.next=v.arg:v.type==="return"?(this.rval=this.arg=v.arg,this.method="return",this.next="end"):v.type==="normal"&&h&&(this.next=h),c},finish:function(v){for(var h=this.tryEntries.length-1;h>=0;--h){var m=this.tryEntries[h];if(m.finallyLoc===v)return this.complete(m.completion,m.afterLoc),G(m),c}},catch:function(v){for(var h=this.tryEntries.length-1;h>=0;--h){var m=this.tryEntries[h];if(m.tryLoc===v){var A=m.completion;if(A.type==="throw"){var b=A.arg;G(m)}return b}}throw new Error("illegal catch attempt")},delegateYield:function(v,h,m){return this.delegate={iterator:U(v),resultName:h,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},n}function Ne(n){"@babel/helpers - typeof";return Ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Ne(n)}function Ft(n,s,e,t,r,i,a){try{var o=n[i](a),u=o.value}catch(l){e(l);return}o.done?s(u):Promise.resolve(u).then(t,r)}function we(n){return function(){var s=this,e=arguments;return new Promise(function(t,r){var i=n.apply(s,e);function a(u){Ft(i,t,r,a,o,"next",u)}function o(u){Ft(i,t,r,a,o,"throw",u)}a(void 0)})}}function oe(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")}function Vt(n,s){for(var e=0;e<s.length;e++){var t=s[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,ur(t.key),t)}}function ue(n,s,e){return s&&Vt(n.prototype,s),e&&Vt(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function D(n,s,e){return s=ur(s),s in n?Object.defineProperty(n,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[s]=e,n}function We(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(s&&s.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),s&&Ge(n,s)}function Le(n){return Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Le(n)}function Ge(n,s){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ge(n,s)}function or(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Qe(n,s,e){return or()?Qe=Reflect.construct.bind():Qe=function(r,i,a){var o=[null];o.push.apply(o,i);var u=Function.bind.apply(r,o),l=new u;return a&&Ge(l,a.prototype),l},Qe.apply(null,arguments)}function Cr(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function Ze(n){var s=typeof Map=="function"?new Map:void 0;return Ze=function(t){if(t===null||!Cr(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof s!="undefined"){if(s.has(t))return s.get(t);s.set(t,r)}function r(){return Qe(t,arguments,Le(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ge(r,t)},Ze(n)}function Lr(n,s){if(n==null)return{};var e={},t=Object.keys(n),r,i;for(i=0;i<t.length;i++)r=t[i],!(s.indexOf(r)>=0)&&(e[r]=n[r]);return e}function Ir(n,s){if(n==null)return{};var e=Lr(n,s),t,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)t=i[r],!(s.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(n,t)&&(e[t]=n[t])}return e}function x(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function xr(n,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(n)}function Ke(n){var s=or();return function(){var t=Le(n),r;if(s){var i=Le(this).constructor;r=Reflect.construct(t,arguments,i)}else r=t.apply(this,arguments);return xr(this,r)}}function Br(n,s){for(;!Object.prototype.hasOwnProperty.call(n,s)&&(n=Le(n),n!==null););return n}function $e(){return typeof Reflect!="undefined"&&Reflect.get?$e=Reflect.get.bind():$e=function(s,e,t){var r=Br(s,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?s:t):i.value}},$e.apply(this,arguments)}function Mr(n,s){if(n){if(typeof n=="string")return Gt(n,s);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Gt(n,s)}}function Gt(n,s){(s==null||s>n.length)&&(s=n.length);for(var e=0,t=new Array(s);e<s;e++)t[e]=n[e];return t}function Ur(n,s){var e=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=Mr(n))||s&&n&&typeof n.length=="number"){e&&(n=e);var t=0,r=function(){};return{s:r,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,a=!1,o;return{s:function(){e=e.call(n)},n:function(){var u=e.next();return i=u.done,u},e:function(u){a=!0,o=u},f:function(){try{!i&&e.return!=null&&e.return()}finally{if(a)throw o}}}}function Nr(n,s){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var t=e.call(n,s||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}function ur(n){var s=Nr(n,"string");return typeof s=="symbol"?s:String(s)}function Me(){var n,s,e=new Promise(function(t,r){n=t,s=r});return e.used=!1,e.resolve=function(){return e.used=!0,n.apply(void 0,arguments)},e.reject=function(){return e.used=!0,s.apply(void 0,arguments)},e}function Be(){try{return parseInt(performance.now(),10)}catch(n){return new Date().getTime()}}var se=function(){function n(){oe(this,n)}return ue(n,null,[{key:"start",value:function(e){return!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6||e.length===1&&e.start(0)<0?0:e.start(0)}},{key:"end",value:function(e){return!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1)}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(t){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],i=0,a=e.length;i<a;i++){var o=r.length;if(!o||!t)r.push([e.start(i),e.end(i)]);else{var u=r[o-1],l=u[1],f=e.start(i);if(f-l<=t){var c=e.end(i);c>l&&(u[1]=c)}else r.push([e.start(i),e.end(i)])}}return r}},{key:"totalLength",value:function(e){return!e||!e.length?0:e.reduce(function(t,r){return t+=r[1]-r[0]},0)}},{key:"info",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!e||!e.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,u=0,l=0,f=0,c=0,d=n.buffers(e,r),p=0,_=d.length;p<_;p++){var E=d[p];if(t+r>=E[0]&&t<E[1])i=E[0],a=E[1],o=p;else if(t+r<E[0]){u=E[0],l=E[1];break}else t+r>E[1]&&(f=E[0],c=E[1])}return{start:i,end:a,index:o,buffers:d,nextStart:u,nextEnd:l,prevStart:f,prevEnd:c,currentTime:t,behind:t-i,remaining:a?a-t:0,length:n.totalLength&&n.totalLength(d)}}}]),n}(),le,X={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ct=(le={},D(le,X.MANIFEST,{HLS:1100,DASH:1200}),D(le,X.NETWORK,2100),D(le,X.NETWORK_TIMEOUT,2101),D(le,X.NETWORK_FORBIDDEN,2103),D(le,X.NETWROK_RANGE_NOT_SATISFIABLE,2116),D(le,X.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),D(le,X.REMUX,{FMP4:4100,MP4:4200}),D(le,X.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,EME_HIJACK:5301}),D(le,X.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),D(le,X.OTHER,8e3),D(le,X.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002}),le),Se=function(n){We(e,n);var s=Ke(e);function e(t,r,i,a,o){var u;return oe(this,e),u=s.call(this,o||(i==null?void 0:i.message)),u.errorType=t===X.NETWORK_TIMEOUT?X.NETWORK:t,u.originError=i,u.ext=a,u.errorCode=ct[t][r]||ct[t],u.errorMessage=u.message,u.errorCode||(u.errorType=X.OTHER,u.errorCode=ct[u.errorType]),u}return ue(e,null,[{key:"create",value:function(r,i,a,o,u){return r instanceof e?r:(r instanceof Error&&(a=r,r=""),r||(r=X.OTHER),new e(r,i,a,o,u))}},{key:"network",value:function(r){var i;return new e(r!=null&&r.isTimeout?X.NETWORK_TIMEOUT:X.NETWORK,null,r instanceof Error?r:null,{url:r==null?void 0:r.url,response:r==null?void 0:r.response,httpCode:r==null||(i=r.response)===null||i===void 0?void 0:i.status})}}]),e}(Ze(Error)),Fr=typeof window!="undefined",Xe={DEBUG:1,LOG:2,WARN:3,ERROR:4},Vr=200*1024,Gr=["Boolean","Number","String","Undefined","Null","Date","Object"],Te=function(){function n(s,e){oe(this,n),this.name=s||"",this._prefix="[".concat(this.name,"]"),n.disabled=(e==null?void 0:e.disabled)||!0,this.logCacheLevel=(e==null?void 0:e.logCacheLevel)||3,this.logMaxSize=(e==null?void 0:e.logMaxSize)||Vr,this.logSize=0,this.logTextArray=[]}return ue(n,[{key:"debug",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logCache.apply(this,[Xe.DEBUG].concat(r)),!n.disabled&&(e=console).debug.apply(e,[this._prefix,Fe()].concat(r))}},{key:"log",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logCache.apply(this,[Xe.LOG].concat(r)),!n.disabled&&(e=console).log.apply(e,[this._prefix,Fe()].concat(r))}},{key:"warn",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logCache.apply(this,[Xe.WARN].concat(r)),!n.disabled&&(e=console).warn.apply(e,[this._prefix,Fe()].concat(r))}},{key:"error",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.logCache.apply(this,[Xe.ERROR].concat(r)),!n.disabled&&(e=console).error.apply(e,[this._prefix,Fe()].concat(r))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=i.map(function(l){return lr(l)});t=this._prefix+Fe()+JSON.stringify(o)}catch(l){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join(`
`);return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var e;n.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();D(Te,"disabled",!0);function Fe(){return new Date().toLocaleString()}function zr(n){if(Ne(n)!=="object")return n;var s=Object.prototype.toString.call(n).slice(8,-1);switch(s){case"Array":case"Uint8Array":case"ArrayBuffer":return s+"["+n.length+"]";case"Object":return"{}";default:return s}}function lr(n,s,e){e||(e=1),s||(s=2);var t={};if(!n||Ne(n)!=="object")return n;var r=Object.prototype.toString.call(n).slice(8,-1);if(!Gr.includes(r))return r;if(!(e>s)){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e===s?t[i]=zr(n[i]):Ne(n[i])==="object"?t[i]=lr(n[i],s,e+1):t[i]=n[i]);return t}}function jr(){try{return Fr?window.MediaSource:null}catch(n){}}var Ye=jr(),zt={APPEND:"appendBuffer",REMOVE:"removeBuffer"},nt=function(){function n(s,e){var t=this;oe(this,n),D(this,"media",null),D(this,"mediaSource",null),D(this,"_openPromise",Me()),D(this,"_queue",Object.create(null)),D(this,"_sourceBuffer",Object.create(null)),D(this,"_mseFullFlag",{}),D(this,"_st",0),D(this,"_opst",0),D(this,"_logger",null),D(this,"_config",null),D(this,"_url",null),D(this,"_onSBUpdateEnd",function(r){var i=t._queue[r];if(i){var a=i.shift();if(a){var o=Be()-t._opst;t._logger.debug("UpdateEnd",a.opName,o,a.context),a.promise.resolve({name:a.opName,context:a.context,costtime:o}),t._startQueue(r)}}}),D(this,"_onSBUpdateError",function(r,i){var a=t._queue[r];if(a){var o=a[0];o&&(t._logger.error("UpdateError",r,o.opName,o.context),o.promise.reject(new Se(X.MEDIA,X.SUB_TYPES.MSE_APPEND_BUFFER,i)))}}),this._config=Object.assign(n.getDefaultConfig(),e),s&&this.bindMedia(s),this._logger=new Te("MSE"),this._config.openLog&&Te.enable()}return ue(n,[{key:"isOpened",get:function(){var e;return((e=this.mediaSource)===null||e===void 0?void 0:e.readyState)==="open"}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return((e=this.mediaSource)===null||e===void 0?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"isFull",value:function(e){return e?this._mseFullFlag[e]:this._mseFullFlag[n.VIDEO]}},{key:"updateDuration",value:function(e){var t=this;return this.mediaSource&&this.mediaSource.duration>e?Promise.resolve():this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("[debug mse] setDuration ended");return}t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))},"updateDuration")}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,r=function i(){var a=Be()-e._st;e._logger.debug("MSE OPEN",a),t.removeEventListener("sourceopen",i),e._openPromise.resolve({costtime:a})};t.addEventListener("sourceopen",r),this._openPromise=Me()}return this._openPromise}},{key:"bindMedia",value:function(){var s=we(te().mark(function t(r){var i=this,a,o;return te().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.mediaSource||this.media)){l.next=3;break}return l.next=3,this.unbindMedia();case 3:if(!(!r||!Ye)){l.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=r,a=this.mediaSource=new Ye,this._st=Be(),o=function f(){var c=Be()-i._st;i._logger.debug("MSE OPEN"),a.removeEventListener("sourceopen",f),URL.revokeObjectURL(r.src),i._openPromise.resolve({costtime:c})},a.addEventListener("sourceopen",o),this._url=URL.createObjectURL(a),r.src=this._url,l.abrupt("return",this._openPromise);case 13:case"end":return l.stop()}},t,this)}));function e(t){return s.apply(this,arguments)}return e}()},{key:"unbindMedia",value:function(){var s=we(te().mark(function t(){var r=this,i,a,o;return te().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),i=this.mediaSource,i){if(Object.keys(this._queue).forEach(function(f){var c=r._queue[f];c&&c.forEach(function(d){return d.promise.resolve})}),a=!!this.media&&this.media.readyState>=1,o=i.readyState==="open",a&&o)try{i.endOfStream()}catch(f){}Object.keys(this._sourceBuffer).forEach(function(f){try{i.removeSourceBuffer(r._sourceBuffer[f])}catch(c){}})}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(f){}this.media=null}this.mediaSource=null,this._openPromise=Me(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function e(){return s.apply(this,arguments)}return e}()},{key:"createSource",value:function(e,t){if(!(this._sourceBuffer[e]||!this.mediaSource)){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(i){throw new Se(X.MEDIA,X.SUB_TYPES.MSE_ADD_SB,i)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this,i=this._sourceBuffer[e];return!this.mediaSource||!i||i.mimeType===t?Promise.resolve():typeof i.changeType!="function"?Promise.reject():this._enqueueOp(e,function(){i.changeType(t),i.mimeType=t,r._onSBUpdateEnd(e)})}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var i=this;return!t||!t.byteLength||!this._sourceBuffer[e]?Promise.resolve():this._enqueueOp(e,function(){var a;i.mediaSource&&(i._logger.debug("MSE APPEND START",r),i._opst=Be(),(a=i._sourceBuffer[e])===null||a===void 0||a.appendBuffer(t))},zt.APPEND,r)}},{key:"remove",value:function(e,t,r,i){var a=this,o=!1;return this._mseFullFlag[e]&&(o=!0),this._enqueueOp(e,function(){if(a.mediaSource){var u=a._sourceBuffer[e];if(t>=r||!u){a._onSBUpdateEnd(e);return}a._opst=Be(),a._logger.debug("MSE REMOVE START",e,t,r,i),u.remove(t,r)}},zt.REMOVE,i,o)}},{key:"clearBuffer",value:function(e,t){var r=this,i;return Object.keys(this._sourceBuffer).forEach(function(a){i=r._enqueueOp(a,function(){if(r.mediaSource){var o=r._sourceBuffer[a];r._logger.debug("MSE clearBuffer START",a,e,t),o.remove(e,t)}})}),i}},{key:"clearAllBuffer",value:function(){var e=this,t;return Object.keys(this._sourceBuffer).forEach(function(r){t=e._enqueueOp(r,function(){if(e.mediaSource){var i=e._sourceBuffer[r];e._logger.debug("MSE clearAllBuffer START",r),i.remove(0,se.end(se.get(i)))}})}),t}},{key:"clearOpQueues",value:function(e){var t;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(!(!r||!r[e]||r.length<5)){var i=[];r.forEach(function(a){a.context&&a.context.isinit&&i.push(a)}),this._queue[e]=r.slice(0,2),i.length>0&&(t=this._queue[e]).push.apply(t,i)}}},{key:"endOfStream",value:function(e){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var r=t.mediaSource;!r||r.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||!(r!=null&&r.setLiveSeekableRange)||r.readyState!=="open"||r.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return se.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return se.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return se.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,i,a){var o=this;if(!this.mediaSource)return Promise.resolve();var u=this._queue[e]=this._queue[e]||[],l={exec:t,promise:Me(),opName:r,context:i};return a?(u.splice(0,0,l),this._mseFullFlag[e]=!1,this._startQueue(e)):u.push(l),this.isOpened?u.length===1&&this._startQueue(e):this._openPromise.then(function(){u.length===1&&o._startQueue(e)}),l.promise}},{key:"_enqueueBlockingOp",value:function(){var s=we(te().mark(function t(r,i){var a=this,o,u;return te().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mediaSource){f.next=2;break}return f.abrupt("return",Promise.resolve());case 2:if(o=Object.keys(this._sourceBuffer),o.length){f.next=5;break}return f.abrupt("return",r());case 5:return u=[],o.forEach(function(c){var d=a._queue[c],p=Me();u.push(p),d.push({exec:function(){return p.resolve()},promise:p,opName:i}),d.length===1&&a._startQueue(c)}),f.abrupt("return",Promise.all(u).then(function(){try{return r()}finally{o.forEach(function(c){var d=a._queue[c],p=a._sourceBuffer[c];d==null||d.shift(),(!p||!p.updating)&&a._startQueue(c)})}}));case 8:case"end":return f.stop()}},t,this)}));function e(t,r){return s.apply(this,arguments)}return e}()},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(i){i&&i.message&&i.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new Se(X.MEDIA,X.SUB_TYPES.MSE_FULL,i))):(this._logger.error(i),r.promise.reject(new Se(X.MEDIA,X.SUB_TYPES.MSE_OTHER,i)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var i=this;return this._enqueueOp(e,function(){t<0&&(t+=.001),i._sourceBuffer[e].timestampOffset=t,i._onSBUpdateEnd(e)},"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)},"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!Ye)return!1;try{return Ye.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}}]),n}();D(nt,"VIDEO","video");D(nt,"AUDIO","audio");var Ce={FETCH:"fetch",XHR:"xhr"},ze={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},ge=function(n){We(e,n);var s=Ke(e);function e(t,r,i,a){var o;return oe(this,e),o=s.call(this,a),D(x(o),"retryCount",0),D(x(o),"isTimeout",!1),D(x(o),"loaderType",Ce.FETCH),D(x(o),"startTime",0),D(x(o),"endTime",0),D(x(o),"options",{}),o.url=t,o.request=r,o.response=i,o}return ue(e)}(Ze(Error)),fr=Object.prototype.toString;function Hr(n){return n!==null&&Ne(n)==="object"}function jt(n){if(fr.call(n)!=="[object Object]")return!1;var s=Object.getPrototypeOf(n);return s===null||s===Object.prototype}function Wr(n){return fr.call(n)==="[object Date]"}function cr(n){if(!(!n||n[0]===null||n[0]===void 0||n[0]===0&&(n[1]===null||n[1]===void 0))){var s="bytes="+n[0]+"-";return n[1]&&(s+=n[1]),s}}function Ht(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hr(n,s){if(n){if(!s)return n;var e,t=Object.keys(s).map(function(i){if(e=s[i],e!=null)return Array.isArray(e)?i=i+"[]":e=[e],e.map(function(a){return Wr(a)?a=a.toISOString():Hr(a)&&(a=JSON.stringify(a)),"".concat(Ht(i),"=").concat(Ht(a))}).join("&")}).filter(Boolean).join("&");if(t){var r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+t}return n}}function yt(n,s,e,t,r,i,a,o,u,l,f){r=r!=null?parseFloat(r):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var c={range:u,vid:l,index:o,contentLength:t,age:r,startTime:i,firstByteTime:a,endTime:Date.now(),priOptions:f};return{data:n,done:s,options:c,response:e}}function bt(n,s){return Math.round(n*8*1e3/s/1024)}var L={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},Wt=2*1024*1024,Et=function(n){We(e,n);var s=Ke(e);function e(){var t;return oe(this,e),t=s.call(this),D(x(t),"_abortController",null),D(x(t),"_timeoutTimer",null),D(x(t),"_reader",null),D(x(t),"_response",null),D(x(t),"_aborted",!1),D(x(t),"_index",-1),D(x(t),"_range",null),D(x(t),"_receivedLength",0),D(x(t),"_running",!1),D(x(t),"_logger",null),D(x(t),"_vid",""),D(x(t),"_onProcessMinLen",0),D(x(t),"_onCancel",null),D(x(t),"_priOptions",null),t}return ue(e,[{key:"load",value:function(r){var i,a=this,o=r.url,u=r.vid,l=r.timeout,f=r.responseType,c=r.onProgress,d=r.index,p=r.onTimeout,_=r.onCancel,E=r.range,g=r.transformResponse,S=r.request,R=r.params,T=r.logger,y=r.method,k=r.headers,N=r.body,z=r.mode,G=r.credentials,K=r.cache,U=r.redirect,J=r.referrer,v=r.referrerPolicy,h=r.onProcessMinLen,m=r.priOptions;this._logger=T,this._aborted=!1,this._onProcessMinLen=h,this._onCancel=_,this._abortController=typeof AbortController!="undefined"&&new AbortController,this._running=!0,this._index=d,this._range=E||[0,0],this._vid=u||o,this._priOptions=m||{};var A={method:y,headers:k,body:N,mode:z,credentials:G,cache:K,redirect:U,referrer:J,referrerPolicy:v,signal:(i=this._abortController)===null||i===void 0?void 0:i.signal},b=!1;clearTimeout(this._timeoutTimer),o=hr(o,R);var C=cr(E);C&&(S?k=S.headers:k=A.headers=A.headers||(Headers?new Headers:{}),Headers&&k instanceof Headers?k.append("Range",C):k.Range=C),l&&(this._timeoutTimer=setTimeout(function(){if(b=!0,a.cancel(),p){var j=new ge(o,A,null,"timeout");j.isTimeout=!0,p(j,{index:a._index,range:a._range,vid:a._vid,priOptions:a._priOptions})}},l));var B=Date.now();return this._logger.debug("[fetch load start], index,",d,",range,",E),new Promise(function(j,H){fetch(S||o,S?void 0:A).then(function(){var P=we(te().mark(function ee(I){var ke,de,Oe,xe;return te().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(clearTimeout(a._timeoutTimer),a._response=I,!(a._aborted||!a._running)){Z.next=4;break}return Z.abrupt("return");case 4:if(g&&(I=g(I,o)||I),I.ok){Z.next=7;break}throw new ge(o,A,I,"bad network response");case 7:if(ke=Date.now(),f!==ze.TEXT){Z.next=15;break}return Z.next=11,I.text();case 11:de=Z.sent,a._running=!1,Z.next=37;break;case 15:if(f!==ze.JSON){Z.next=22;break}return Z.next=18,I.json();case 18:de=Z.sent,a._running=!1,Z.next=37;break;case 22:if(!c){Z.next=29;break}return a.resolve=j,a.reject=H,a._loadChunk(I,c,B,ke),Z.abrupt("return");case 29:return Z.next=31,I.arrayBuffer();case 31:de=Z.sent,de=new Uint8Array(de),a._running=!1,Oe=Date.now()-B,xe=bt(de.byteLength,Oe),a.emit(L.REAL_TIME_SPEED,{speed:xe,len:de.byteLength,time:Oe,vid:a._vid,index:a._index,range:a._range,priOptions:a._priOptions});case 37:a._logger.debug("[fetch load end], index,",d,",range,",E),j(yt(de,!0,I,I.headers.get("Content-Length"),I.headers.get("age"),B,ke,d,E,a._vid,a._priOptions));case 39:case"end":return Z.stop()}},ee)}));return function(ee){return P.apply(this,arguments)}}()).catch(function(P){var ee;clearTimeout(a._timeoutTimer),a._running=!1,!(a._aborted&&!b)&&(P=P instanceof ge?P:new ge(o,A,null,(ee=P)===null||ee===void 0?void 0:ee.message),P.startTime=B,P.endTime=Date.now(),P.isTimeout=b,P.options={index:a._index,range:a._range,vid:a._vid,priOptions:a._priOptions},H(P))})})}},{key:"cancel",value:function(){var t=we(te().mark(function i(){return te().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._aborted){o.next=2;break}return o.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){o.next=14;break}if(o.prev=5,!this._reader){o.next=9;break}return o.next=9,this._reader.cancel();case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(u){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return o.stop()}},i,this,[[5,11]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"_loadChunk",value:function(r,i,a,o){var u=this;if(!r.body||!r.body.getReader){this._running=!1;var l=new ge(r.url,"",r,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Wt),this._writeIdx=0);var f=this._reader=r.body.getReader(),c,d,p,_=function(){var E=we(te().mark(function g(){var S,R,T,y,k,N,z,G;return te().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return d=Date.now(),U.prev=1,U.next=4,f.read();case 4:c=U.sent,p=Date.now(),U.next=13;break;case 8:return U.prev=8,U.t0=U.catch(1),p=Date.now(),u._aborted||(u._running=!1,U.t0.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},u.reject(U.t0)),U.abrupt("return");case 13:if(R=((S=u._range)===null||S===void 0?void 0:S.length)>0?u._range[0]:0,T=R+u._receivedLength,!u._aborted){U.next=19;break}return u._running=!1,i(void 0,!1,{range:[T,T],vid:u._vid,index:u._index,startTime:d,endTime:p,st:a,firstByteTime:o,priOptions:u._priOptions},r),U.abrupt("return");case 19:y=c.value?c.value.byteLength:0,u._receivedLength+=y,u._logger.debug("【fetchLoader,onProgress call】,task,",u._range,", start,",T,", end,",R+u._receivedLength,", done,",c.done),u._onProcessMinLen>0?u._writeIdx+y>=u._onProcessMinLen||c.done?(k=new Uint8Array(u._writeIdx+y),k.set(u._cache.slice(0,u._writeIdx),0),y>0&&k.set(c.value,u._writeIdx),u._writeIdx=0,u._logger.debug("【fetchLoader,onProgress enough】,done,",c.done,",len,",k.byteLength,", writeIdx,",u._writeIdx)):y>0&&u._writeIdx+y<Wt?(u._cache.set(c.value,u._writeIdx),u._writeIdx+=y,u._logger.debug("【fetchLoader,onProgress cache】,len,",y,", writeIdx,",u._writeIdx)):y>0&&(N=new Uint8Array(u._writeIdx+y+2048),u._logger.debug("【fetchLoader,onProgress extra start】,size,",u._writeIdx+y+2048,", datalen,",y,", writeIdx,",u._writeIdx),N.set(u._cache.slice(0,u._writeIdx),0),y>0&&N.set(c.value,u._writeIdx),u._writeIdx+=y,delete u._cache,u._cache=N,u._logger.debug("【fetchLoader,onProgress extra end】,len,",y,", writeIdx,",u._writeIdx)):k=c.value,(k&&k.byteLength>0||c.done)&&i(k,c.done,{range:[u._range[0]+u._receivedLength-(k?k.byteLength:0),u._range[0]+u._receivedLength],vid:u._vid,index:u._index,startTime:d,endTime:p,st:a,firstByteTime:o,priOptions:u._priOptions},r),c.done?(z=Date.now()-a,G=bt(u._receivedLength,z),u.emit(L.REAL_TIME_SPEED,{speed:G,len:u._receivedLength,time:z,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions}),u._running=!1,u._logger.debug("[fetchLoader onProgress end],task,",u._range,",done,",c.done),u.resolve(yt(c,!0,r,r.headers.get("Content-Length"),r.headers.get("age"),a,o,u._index,u._range,u._vid,u._priOptions))):_();case 25:case"end":return U.stop()}},g,null,[[1,8]])}));return function(){return E.apply(this,arguments)}}();_()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(r){this._running=r}}],[{key:"isSupported",value:function(){return typeof fetch!="undefined"}}]),e}(tt);function Kr(n){return Ve({loaderType:Ce.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ze.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},n)}var qr=function(n){We(e,n);var s=Ke(e);function e(){var t;return oe(this,e),t=s.call(this),D(x(t),"_xhr",null),D(x(t),"_aborted",!1),D(x(t),"_timeoutTimer",null),D(x(t),"_range",null),D(x(t),"_receivedLength",0),D(x(t),"_url",null),D(x(t),"_onProgress",null),D(x(t),"_index",-1),D(x(t),"_headers",null),D(x(t),"_currentChunkSizeKB",384),D(x(t),"_timeout",null),D(x(t),"_xhr",null),D(x(t),"_withCredentials",null),D(x(t),"_startTime",-1),D(x(t),"_loadCompleteResolve",null),D(x(t),"_loadCompleteReject",null),D(x(t),"_runing",!1),D(x(t),"_logger",!1),D(x(t),"_vid",""),D(x(t),"_responseType",void 0),D(x(t),"_credentials",void 0),D(x(t),"_method",void 0),D(x(t),"_transformResponse",void 0),D(x(t),"_firstRtt",void 0),D(x(t),"_onCancel",null),D(x(t),"_priOptions",null),t}return ue(e,[{key:"load",value:function(r){var i=this;clearTimeout(this._timeoutTimer),this._logger=r.logger,this._range=r.range,this._onProgress=r.onProgress,this._index=r.index,this._headers=r.headers,this._withCredentials=r.credentials==="include"||r.credentials==="same-origin",this._body=r.body||null,r.method&&(this._method=r.method),this._timeout=r.timeout||null,this._runing=!0,this._vid=r.vid||r.url,this._responseType=r.responseType,this._firstRtt=-1,this._onTimeout=r.onTimeout,this._onCancel=r.onCancel,this._request=r.request,this._priOptions=r.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=hr(r.url,r.params);var a=Date.now();return new Promise(function(o,u){i._loadCompleteResolve=o,i._loadCompleteReject=u,i._startLoad()}).catch(function(o){if(clearTimeout(i._timeoutTimer),i._runing=!1,!i._aborted)throw o=o instanceof ge?o:new ge(i._url,i._request),o.startTime=a,o.endTime=Date.now(),o.options={index:i._index,vid:i._vid,priOptions:i._priOptions},o})}},{key:"_startLoad",value:function(){var r=null;if(this._responseType===ze.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var i=this._currentChunkSizeKB*1024,a=this._range[0]+this._receivedLength,o=this._range[1];i<this._range[1]-a&&(o=a+i),r=[a,o],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",r)}else r=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",r);this._internalOpen(r)}},{key:"_internalOpen",value:function(r){var i=this;try{this._startTime=Date.now();var a=this._xhr=new XMLHttpRequest;a.open(this._method||"GET",this._url,!0),a.responseType=this._responseType,this._timeout&&(a.timeout=this._timeout),a.withCredentials=this._withCredentials,a.onload=this._onLoad.bind(this),a.onreadystatechange=this._onReadyStatechange.bind(this),a.onerror=function(l){var f,c,d;i._running=!1;var p=new ge(i._url,i._request,l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.response,"xhr.onerror.status:"+(l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.status)+",statusText,"+(l==null||(d=l.currentTarget)===null||d===void 0?void 0:d.statusText));p.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(p)},a.ontimeout=function(l){i.cancel();var f=new ge(i._url,i._request,{status:408},"timeout");i._onTimeout&&(f.isTimeout=!0,i._onTimeout(f,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),f.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(f)};var o=this._headers||{},u=cr(r);u&&(o.Range=u),o&&Object.keys(o).forEach(function(l){a.setRequestHeader(l,o[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",r),a.send(this._body)}catch(l){l.options={index:this._index,range:r,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(r){var i=r.target;i.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(r){var i,a=r.target.status;if(a<200||a>299){var o=new ge(this._url,null,Ve(Ve({},r.target.response),{},{status:a}),"bad response,status:"+a);return o.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(o)}var u=null,l=!1,f,c=((i=this._range)===null||i===void 0?void 0:i.length)>0?this._range[0]:0;if(this._responseType===ze.ARRAY_BUFFER){var d,p=new Uint8Array(r.target.response);if(f=c+this._receivedLength,p&&p.byteLength>0){this._receivedLength+=p.byteLength;var _=Date.now()-this._startTime,E=bt(this._receivedLength,_);this.emit(L.REAL_TIME_SPEED,{speed:E,len:this._receivedLength,time:_,vid:this._vid,index:this._index,range:[f,c+this._receivedLength],priOptions:this._priOptions})}u=p,((d=this._range)===null||d===void 0?void 0:d.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",f,"end ",c+this._receivedLength,",dataLen,",p?p.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,u=r.target.response;var g={ok:a>=200&&a<300,status:a,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(g=this._transformResponse(g,this._url)||g),this._onProgress&&this._onProgress(u,l,{index:this._index,vid:this._vid,range:[f,c+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},g),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(yt(this._onProgress?null:u,l,g,g.headers["content-length"],g.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,$e(Le(e.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(r){this._running=r}},{key:"_getHeaders",value:function(r){var i=r.getAllResponseHeaders().trim().split(`\r
`),a={},o=Ur(i),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,f=l.split(": ");a[f[0].toLowerCase()]=f.slice(1).join(": ")}}catch(c){o.e(c)}finally{o.f()}return a}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest!="undefined"}}]),e}(tt),Xr=["retry","retryDelay","onRetryError","transformError"],Yr=function(){function n(s,e){oe(this,n),this.promise=Me(),this.alive=!!e.onProgress,!e.logger&&(e.logger=new Te("Loader")),this._loaderType=s,this._loader=s===Ce.FETCH&&window.fetch?new Et:new qr,this._config=e,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=e.retryCheckFunc,this._logger=e.logger}return ue(n,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,i=t.retryDelay,a=t.onRetryError,o=t.transformError,u=Ir(t,Xr),l=function(){var f=we(te().mark(function c(){var d,p,_;return te().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,e._loader.load(u);case 3:d=g.sent,e.promise.resolve(d),g.next=27;break;case 7:if(g.prev=7,g.t0=g.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",g.t0),!e._canceled){g.next=13;break}return g.abrupt("return");case 13:if(g.t0.loaderType=e._loaderType,g.t0.retryCount=e._retryCount,p=g.t0,o&&(p=o(p)||p),a&&e._retryCount>0&&a(p,e._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),e._retryCount++,_=!0,e._retryCheckFunc&&(_=e._retryCheckFunc(g.t0)),!(_&&e._retryCount<=r)){g.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",u.range),e._retryTimer=setTimeout(l,i),g.abrupt("return");case 26:e.promise.reject(p);case 27:case"end":return g.stop()}},c,null,[[0,7]])}));return function(){return f.apply(this,arguments)}}();return l(),this.promise}},{key:"cancel",value:function(){var s=we(te().mark(function t(){return te().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,i.abrupt("return",this._loader.cancel());case 4:case"end":return i.stop()}},t,this)}));function e(){return s.apply(this,arguments)}return e}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),n}();function Qr(n){return n&&!n.paused&&!n.ended&&n.playbackRate!==0&&n.readyState!==0}function $r(n){if(!n)return{};if(typeof n.getVideoPlaybackQuality=="function"){var s=n.getVideoPlaybackQuality();return{droppedVideoFrames:s.droppedVideoFrames||s.corruptedVideoFrames,totalVideoFrames:s.totalVideoFrames,creationTime:s.creationTime}}return{droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDecodedFrameCount,creationTime:performance.now()}}function Jr(){for(var n=arguments.length,s=new Array(n),e=0;e<n;e++)s[e]=arguments[e];if(s=s.filter(Boolean),s.length<2)return s[0];var t=new Uint8Array(s.reduce(function(i,a){return i+a.byteLength},0)),r=0;return s.forEach(function(i){t.set(i,r),r+=i.byteLength}),t}function Zr(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(s){return setTimeout(s,n)})}var ei=function(n){We(e,n);var s=Ke(e);function e(t){var r;return oe(this,e),r=s.call(this,t),D(x(r),"type",Ce.FETCH),D(x(r),"_queue",[]),D(x(r),"_alive",[]),D(x(r),"_currentTask",null),D(x(r),"_config",void 0),r._config=Kr(t),(r._config.loaderType===Ce.XHR||!Et.isSupported())&&(r.type=Ce.XHR),r.log=t.logger,r}return ue(e,[{key:"isFetch",value:function(){return this.type===Ce.FETCH}},{key:"load",value:function(r){var i=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof r=="string"||!r?a.url=r||a.url||this._config.url:a=r,a=Object.assign({},this._config,a),a.params&&(a.params=Object.assign({},a.params)),a.headers&&jt(a.headers)&&(a.headers=Object.assign({},a.headers)),a.body&&jt(a.body)&&(a.body=Object.assign({},a.body)),a.transformRequest&&(a=a.transformRequest(a)||a),a.logger=this.log;var o=new Yr(this.type,a);return o.loader.on(L.REAL_TIME_SPEED,function(u){i.emit(L.REAL_TIME_SPEED,u)}),this._queue.push(o),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),o.promise}},{key:"cancel",value:function(){var t=we(te().mark(function i(){var a;return te().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&a.push(this._currentTask.cancel()),this._queue=[],this._alive=[],u.next=6,Promise.all(a);case 6:return u.next=8,Zr();case 8:case"end":return u.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"_processTask",value:function(){var r=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var i=this._currentTask.exec().catch(function(a){});i&&typeof i.finally=="function"&&i.finally(function(){var a,o;(a=r._currentTask)!==null&&a!==void 0&&a.alive&&((o=r._alive)===null||o===void 0?void 0:o.length)>0&&(r._alive=r._alive.filter(function(u){return u&&u!==r._currentTask})),r._processTask()})}}}],[{key:"isFetchSupport",value:function(){return Et.isSupported()}}]),e}(tt),ti=function(){function n(){oe(this,n),D(this,"_prevCurrentTime",0)}return ue(n,[{key:"do",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(e){var a=e.currentTime,o=0;if(this._prevCurrentTime===a){var u=se.info(se.get(e),a);if(!u.buffers.length)return;r&&u.nextStart||u.nextStart&&u.nextStart-a<t?o=u.nextStart+.1:u.end&&u.end-a>i&&!e.seeking&&(o=a+.1)}this._prevCurrentTime=a,o&&a!==o&&(e.currentTime=o)}}}]),n}(),ri=function(){function n(s){var e=this;oe(this,n),D(this,"_seiSet",new Set),this.emitter=s,s.on(L.SEI,function(t){t&&e._seiSet.add(t)})}return ue(n,[{key:"throw",value:function(e){var t=this;if(!(e==null||!this._seiSet.size)){var r=e-.2,i=e+.2,a=[];this._seiSet.forEach(function(o){o.time>=r&&o.time<=i&&a.push(o)}),a.forEach(function(o){t._seiSet.delete(o),t.emitter.emit(L.SEI_IN_TIME,o)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),n}(),ii=function(){function n(){oe(this,n),D(this,"_chunkSpeeds",[]),D(this,"_speeds",[])}return ue(n,[{key:"addRecord",value:function(e,t){!e||!t||(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){!e||!t||(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return!this._chunkSpeeds.length&&!this._speeds.length?0:this._speeds.length?this._speeds.reduce(function(e,t){return e+=t})/this._speeds.length:this._chunkSpeeds.reduce(function(e,t){return e+=t})/this._chunkSpeeds.length}},{key:"getLatestSpeed",value:function(){return!this._chunkSpeeds.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),n}(),Kt=function(){function n(s){oe(this,n),D(this,"encodeType",""),D(this,"audioCodec",""),D(this,"videoCodec",""),D(this,"domain",""),D(this,"fps",0),D(this,"bitrate",0),D(this,"width",0),D(this,"height",0),D(this,"samplerate",0),D(this,"channelCount",0),D(this,"gop",0),D(this,"_bitsAccumulateSize",0),D(this,"_bitsAccumulateDuration",0),this._timescale=s}return ue(n,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setFpsFromScriptData",value:function(e){var t,r=e.data,i=r==null||(t=r.onMetaData)===null||t===void 0?void 0:t.framerate;i&&i>0&&i<100&&(this.fps=i)}},{key:"setVideoMeta",value:function(e){if(this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen){var t=e.fpsNum/e.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if((!this.fps||this.fps>=100)&&e.length){var r=e.reduce(function(i,a){return i+=a.duration},0)/e.length;this.fps=Math.round(this._timescale/r)}e.forEach(function(i){i.gopId===1&&t.gop++,t._bitsAccumulateDuration+=i.duration/(t._timescale/1e3),t._bitsAccumulateSize+=i.units.reduce(function(a,o){return a+=o.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),n}(),ni=function(){function n(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;oe(this,n),D(this,"_core",null),D(this,"_samples",[]),this._core=s,this._timescale=e,this._stats=new Kt(e),this._bindEvents()}return ue(n,[{key:"getStats",value:function(){var e,t,r,i,a,o,u,l=((e=this._core)===null||e===void 0?void 0:e.media)||{},f=l.currentTime,c=f===void 0?0:f,d=l.decodeFps,p=d===void 0?0:d;return Ve(Ve({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(r=t.speedInfo)===null||r===void 0?void 0:r.call(t).speed)||0,avgSpeed:((i=this._core)===null||i===void 0||(a=i.speedInfo)===null||a===void 0?void 0:a.call(i).avgSpeed)||0,currentTime:c,bufferEnd:((o=this._core)===null||o===void 0||(u=o.bufferInfo())===null||u===void 0?void 0:u.remaining)||0,decodeFps:p})}},{key:"_bindEvents",value:function(){var e=this;this._core.on(L.DEMUXED_TRACK,function(t){var r=t.videoTrack;return e._stats.updateBitrate(r.samples)}),this._core.on(L.FLV_SCRIPT_DATA,function(t){e._stats.setFpsFromScriptData(t)}),this._core.on(L.METADATA_PARSED,function(t){t.type==="video"?e._stats.setVideoMeta(t.track):e._stats.setAudioMeta(t.track)}),this._core.on(L.TTFB,function(t){e._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Kt(this._timescale)}}]),n}();function ai(n,s){var e=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var t,r,i,a,o=[],u=!0,l=!1;try{if(i=(e=e.call(n)).next,s===0){if(Object(e)!==e)return;u=!1}else for(;!(u=(t=i.call(e)).done)&&(o.push(t.value),o.length!==s);u=!0);}catch(f){l=!0,r=f}finally{try{if(!u&&e.return!=null&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw r}}return o}}function Q(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")}function qt(n,s){for(var e=0;e<s.length;e++){var t=s[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,mr(t.key),t)}}function $(n,s,e){return s&&qt(n.prototype,s),e&&qt(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function w(n,s,e){return s=mr(s),s in n?Object.defineProperty(n,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[s]=e,n}function dr(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(s&&s.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),s&&St(n,s)}function et(n){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(n)}function St(n,s){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},St(n,s)}function si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function oi(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ui(n,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oi(n)}function vr(n){var s=si();return function(){var t=et(n),r;if(s){var i=et(this).constructor;r=Reflect.construct(t,arguments,i)}else r=t.apply(this,arguments);return ui(this,r)}}function li(n,s){return ci(n)||ai(n,s)||pr(n,s)||vi()}function ce(n){return fi(n)||hi(n)||pr(n)||di()}function fi(n){if(Array.isArray(n))return wt(n)}function ci(n){if(Array.isArray(n))return n}function hi(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function pr(n,s){if(n){if(typeof n=="string")return wt(n,s);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wt(n,s)}}function wt(n,s){(s==null||s>n.length)&&(s=n.length);for(var e=0,t=new Array(s);e<s;e++)t[e]=n[e];return t}function di(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vi(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pi(n,s){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var t=e.call(n,s||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}function mr(n){var s=pi(n,"string");return typeof s=="symbol"?s:String(s)}var Ue={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},De={AVC:"avc",HEVC:"hevc"},_e={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},re={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},Tt=function(){function n(){Q(this,n),w(this,"id",1),w(this,"type",Ue.VIDEO),w(this,"codecType",De.AVC),w(this,"pid",-1),w(this,"hvcC",void 0),w(this,"codec",""),w(this,"timescale",0),w(this,"formatTimescale",0),w(this,"sequenceNumber",0),w(this,"baseMediaDecodeTime",0),w(this,"baseDts",0),w(this,"duration",0),w(this,"warnings",[]),w(this,"samples",[]),w(this,"pps",[]),w(this,"sps",[]),w(this,"vps",[]),w(this,"fpsNum",0),w(this,"fpsDen",0),w(this,"sarRatio",[]),w(this,"width",0),w(this,"height",0),w(this,"nalUnitSize",4),w(this,"present",!1),w(this,"isVideoEncryption",!1),w(this,"isAudioEncryption",!1),w(this,"isVideo",!0),w(this,"kid",null),w(this,"pssh",null),w(this,"ext",void 0)}return $(n,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),n}(),kt=function(){function n(){Q(this,n),w(this,"id",2),w(this,"type",Ue.AUDIO),w(this,"codecType",_e.AAC),w(this,"pid",-1),w(this,"codec",""),w(this,"sequenceNumber",0),w(this,"sampleDuration",0),w(this,"timescale",0),w(this,"formatTimescale",0),w(this,"baseMediaDecodeTime",0),w(this,"duration",0),w(this,"warnings",[]),w(this,"samples",[]),w(this,"baseDts",0),w(this,"sampleSize",16),w(this,"sampleRate",0),w(this,"channelCount",0),w(this,"objectType",0),w(this,"sampleRateIndex",0),w(this,"config",[]),w(this,"present",!1),w(this,"isVideoEncryption",!1),w(this,"isAudioEncryption",!1),w(this,"kid",null),w(this,"ext",void 0)}return $(n,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===_e.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),n}(),Ot=function(){function n(s,e,t){Q(this,n),w(this,"flag",{}),w(this,"keyframe",!1),w(this,"gopId",0),w(this,"duration",0),w(this,"size",0),w(this,"units",[]),w(this,"chromaFormat",420),this.originPts=this.pts=s,this.originDts=this.dts=e,t&&(this.units=t)}return $(n,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),n}(),Ie=$(function n(s,e,t,r){Q(this,n),w(this,"duration",1024),w(this,"flag",{dependsOn:2,isNonSyncSample:0}),w(this,"keyframe",!0),this.originPts=this.pts=this.dts=s,this.data=e,this.size=e.byteLength,this.sampleOffset=r,t&&(this.duration=t)}),gr=$(function n(s,e){Q(this,n),w(this,"time",0),this.data=s,this.originPts=this.pts=e}),mi=function(n){dr(e,n);var s=vr(e);function e(){return Q(this,e),s.apply(this,arguments)}return $(e)}(gr),_r=function(n){dr(e,n);var s=vr(e);function e(){return Q(this,e),s.apply(this,arguments)}return $(e)}(gr),Rt=function(){function n(){Q(this,n),w(this,"id",3),w(this,"type",Ue.METADATA),w(this,"timescale",0),w(this,"flvScriptSamples",[]),w(this,"seiSamples",[])}return $(n,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),n}(),je=function(){function n(s){Q(this,n),this.name=s||"",this._prefix="[".concat(this.name,"]")}return $(n,[{key:"warn",value:function(){var e;if(!n.disabled){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).warn.apply(e,[this._prefix].concat(r))}}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();w(je,"disabled",!0);var at=typeof window!="undefined",Pt=at&&navigator.userAgent.toLocaleLowerCase(),yr=at&&/^((?!chrome|android).)*safari/.test(Pt),gi=at&&Pt.includes("firefox"),_i=at&&Pt.includes("android"),ve=function(){function n(){Q(this,n)}return $(n,null,[{key:"getRateIndexByRate",value:function(e){return n.FREQ.indexOf(e)}},{key:"parseADTS",value:function(e,t){for(var r=e.length,i=0;i+2<r&&!(e[i]===255&&(e[i+1]&246)===240);)i++;if(!(i>=r)){var a=i,o=[],u=(e[i+2]&60)>>>2,l=n.FREQ[u];if(!l)throw new Error("Invalid sampling index: ".concat(u));for(var f=((e[i+2]&192)>>>6)+1,c=(e[i+2]&1)<<2|(e[i+3]&192)>>>6,d=n._getConfig(u,c,f),p=d.config,_=d.codec,E,g,S=0,R=n.getFrameDuration(l);i+7<r;){if(e[i]!==255||(e[i+1]&246)!==240){i++;continue}if(g=(e[i+3]&3)<<11|e[i+4]<<3|(e[i+5]&224)>>5,r-i<g)break;E=(~e[i+1]&1)*2,o.push({pts:t+S*R,data:e.subarray(i+7+E,i+g)}),S++,i+=g}return{skip:a,remaining:i>=r?void 0:e.subarray(i),frames:o,samplingFrequencyIndex:u,sampleRate:l,objectType:f,channelCount:c,codec:_,config:p,originCodec:"mp4a.40.".concat(f)}}}},{key:"parseAudioSpecificConfig",value:function(e){if(e.length){var t=e[0]>>>3,r=(e[0]&7)<<1|e[1]>>>7,i=(e[1]&120)>>>3,a=n.FREQ[r];if(a){var o=n._getConfig(r,i,t),u=o.config,l=o.codec;return{samplingFrequencyIndex:r,sampleRate:a,objectType:t,channelCount:i,config:u,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var i=[],a,o;return gi?e>=6?(a=5,o=e-3):(a=2,o=e):_i?(a=2,o=e):(a=r===2||r===5?r:5,o=e,e>=6?o=e-3:t===1&&(a=2,o=e)),i[0]=a<<3,i[0]|=(e&14)>>1,i[1]=(e&1)<<7,i[1]|=t<<3,a===5&&(i[1]|=(o&14)>>1,i[2]=(o&1)<<7,i[2]|=8,i[3]=0),{config:i,codec:"mp4a.40.".concat(a)}}},{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),n}();w(ve,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var yi=500,Xt=3,ht=1e3,dt=5e3,bi=1e3,Ei=200,Yt=5e3,Qt=5,Si=function(){function n(s,e,t){Q(this,n),this.videoTrack=s,this.audioTrack=e,this.metadataTrack=t,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return $(n,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*1e3);var a=this.videoTrack,o=this.audioTrack;(r||!i)&&(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),r&&!i&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(o,a),!i&&t&&(this._audioNextPts=this._videoNextDts=t);var u=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(u&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._keyFrameInNextChunk=!1,this._fixVideo(a),this.metadataTrack.exist()){var l=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(f){f.pts=f.originPts-e._baseDts,f.time=Math.max(0,f.pts)/l}),this.metadataTrack.flvScriptSamples.forEach(function(f){f.pts=f.originPts-e._baseDts,f.time=Math.max(0,f.pts)/l})}a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/1e3)}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){r.forEach(function(R){R.dts-=t._baseDts,R.pts-=t._baseDts,R.keyframe&&(t._keyFrameInNextChunk=!0)});var i;if(e.fpsNum&&e.fpsDen)i=e.timescale*(e.fpsDen/e.fpsNum);else if(e.length>1){var a=e.samples[0],o=e.samples[r.length-1];i=Math.floor((o.dts-a.dts)/(r.length-1))}else i=this._lastVideoDuration||40;var u=r.pop();if(this._videoLastSample&&r.unshift(this._videoLastSample),this._videoLastSample=u,!!r.length){if(this._videoNextDts===void 0){var l=r[0];this._videoNextDts=l.dts}var f=r.length,c=0,d=r[0],p=this._videoNextDts-d.dts;if(Math.abs(p)>Ei){if(Math.abs(d.dts-this._lastVideoExceptionChunkFirstDtsDot)>Yt){var _;this._lastVideoExceptionChunkFirstDtsDot=d.dts,e.warnings.push({type:re.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:d.dts,nextSampleDts:(_=r[1])===null||_===void 0?void 0:_.dts,sampleDuration:p})}this._videoTimestampBreak>=Qt?(this._videoNextDts=d.dts,this._videoTimestampBreak=0):(d.dts+=p,d.pts+=p,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var E=0;E<f;E++){var g=r[E].dts,S=r[E+1];E<f-1?c=S.dts-g:u?c=u.dts-g:c=i,(c>bi||c<0)&&(this._videoTimestampBreak++,Math.abs(g-this._lastVideoExceptionLargeGapDot)>Yt&&(this._lastVideoExceptionLargeGapDot=g,e.warnings.push({type:re.LARGE_VIDEO_GAP,time:g/e.timescale,dts:g,originDts:r[E].originDts,nextDts:this._videoNextDts,sampleDuration:c,refSampleDuration:i})),c=i),r[E].duration=c,this._videoNextDts+=c,this._lastVideoDuration=c}}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach(function(i){i.dts=i.pts-=t._baseDts}),this._doFixAudioInternal(e,r,1e3))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,i=t.samples;if(!r.length&&!i.length)return!1;var a=1/0,o=1/0;r.length&&(e.baseDts=a=r[0].pts),i.length&&(t.baseDts=o=i[0].dts),this._baseDts=Math.min(a,o);var u=o-a;return Number.isFinite(u)&&Math.abs(u)>yi&&t.warnings.push({type:re.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:a,baseDts:this._baseDts,delta:u}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var e=this._calculateBaseDts(this.audioTrack,this.videoTrack);e&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=e.codecType===_e.AAC?ve.getFrameDuration(e.timescale,r):this._getG711Duration(e));var i=e.sampleDuration,a=e.codecType===_e.AAC?1024:i*e.timescale/1e3;if(this._audioNextPts===void 0){var o=t[0];this._audioNextPts=o.pts}for(var u=0;u<t.length;u++){var l=this._audioNextPts,f=t[u],c=f.pts-l;if(u===0&&this._audioTimestampBreak>=Qt&&this._keyFrameInNextChunk&&(l=this._audioNextPts=f.dts,c=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&c>=Xt*i&&c<=ht&&!yr){var d=this._getSilentFrame(e)||t[0].data.subarray(),p=Math.floor(c/i);Math.abs(f.pts-this._lastAudioExceptionGapDot)>dt&&(this._lastAudioExceptionGapDot=f.pts,e.warnings.push({type:re.AUDIO_FILLED,pts:f.pts,originPts:f.originPts,count:p,nextPts:l,refSampleDuration:i}));for(var _=0;_<p;_++){var E=new Ie(Math.floor(this._audioNextPts+i)-Math.floor(this._audioNextPts),d,a);E.originPts=Math.floor(this._baseDts+l),t.splice(u,0,E),this._audioNextPts+=i,u++}u--}else c<=-Xt*i&&c>=-1*ht?(Math.abs(f.pts-this._lastAudioExceptionOverlapDot)>dt&&(this._lastAudioExceptionOverlapDot=f.pts,e.warnings.push({type:re.AUDIO_DROPPED,pts:f.pts,originPts:f.originPts,nextPts:l,refSampleDuration:i})),t.splice(u,1),u--):(Math.abs(c)>ht&&(this._audioTimestampBreak++,Math.abs(f.pts-this._lastAudioExceptionLargeGapDot)>dt&&(this._lastAudioExceptionLargeGapDot=f.pts,e.warnings.push({type:re.LARGE_AUDIO_GAP,time:f.pts/1e3,pts:f.pts,originPts:f.originPts,nextPts:l,sampleDuration:c,refSampleDuration:i}))),f.dts=f.pts=l,f.duration=a,this._audioNextPts+=i)}}},{key:"_getG711Duration",value:function(e){var t=e.sampleSize,r=e.channelCount,i=e.sampleRate,a=e.samples[0];if(a)return a.data.byteLength*2/r/(t/8)/i*1e3}},{key:"_getSilentFrame",value:function(e){return e.codecType===_e.AAC?ve.getSilentFrame(e.codec,e.channelCount):new Uint8Array(8*e.sampleDuration*e.channelCount)}}]),n}();function he(){for(var n=arguments.length,s=new Array(n),e=0;e<n;e++)s[e]=arguments[e];s=s.filter(Boolean);var t=new Uint8Array(s.reduce(function(i,a){return i+a.byteLength},0)),r=0;return s.forEach(function(i){t.set(i,r),r+=i.byteLength}),t}var wi=Math.pow(2,32);function Y(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[s]<<8)+(n[s+1]||0)}function Di(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[s]<<16)+(n[s+1]<<8)+(n[s+2]||0)}function O(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n[s]<<24>>>0)+(n[s+1]<<16)+(n[s+2]<<8)+(n[s+3]||0)}function Ae(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return O(n,s)*wi+O(n,s+4)}function br(n){for(var s="avc1.",e,t=0;t<3;t++)e=n[t].toString(16),e.length<2&&(e="0".concat(e)),s+=e;return s}function $t(n){if(!Array.isArray(n)){for(var s=[],e="",t=0;t<n.length;t++)t%2&&(e=n[t-1]+n[t],s.push(parseInt(e,16)),e="");return s}return n.map(function(r){return parseInt(r,16)})}var me=function(){function n(){Q(this,n)}return $(n,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,i=0;e[r]!==null&&e[r]!==void 0&&e[r]!==1;)r++;if(r++,i=r+2,i>=t)return[];for(var a=[];i<t;)switch(e[i]){case 0:if(e[i-1]!==0){i+=2;break}else if(e[i-2]!==0){i++;break}r!==i-2&&a.push(e.subarray(r,i-2));do i++;while(e[i]!==1&&i<t);r=i+1,i=r+2;break;case 1:if(e[i-1]!==0||e[i-2]!==0){i+=3;break}r!==i-2&&a.push(e.subarray(r,i-2)),r=i+1,i=r+2;break;default:i+=3;break}return r<t&&a.push(e.subarray(r)),a}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(e.length<4)){for(var r=e.length,i=[],a=0,o;a+t<r;)if(o=O(e,a),t===3&&(o>>>=8),a+=t,!!o){if(a+o>r)break;i.push(e.subarray(a,a+o)),a+=o}return i}}},{key:"parseSEI",value:function(e,t){for(var r=e.length,i=t?2:1,a=0,o=0,u="";e[i]===255;)a+=255,i++;for(a+=e[i++];e[i]===255;)o+=255,i++;if(o+=e[i++],a===5&&r>i+16)for(var l=0;l<16;l++)u+=e[i].toString(16),i++;return{payload:e.subarray(i),type:a,size:o,uuid:u}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)e[i]===0&&e[i+1]===0&&e[i+2]===3?(r.push(i+2),i+=2):i++;if(!r.length)return e;var a=t-r.length,o=new Uint8Array(a),u=0;for(i=0;i<a;u++,i++)u===r[0]&&(u++,r.shift()),o[i]=e[u];return o}}]),n}(),Dt=function(){function n(s){if(Q(this,n),w(this,"_bytesAvailable",void 0),w(this,"_bitsAvailable",0),w(this,"_word",0),!s)throw new Error("ExpGolomb data params is required");this._data=s,this._bytesAvailable=s.byteLength,this._bytesAvailable&&this._loadWord()}return $(n,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=e-t,t>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(this._word&2147483648>>>e)return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,i,a=0;a<e;a++)r!==0&&(i=this.readEG(),r=(t+i+256)%256),t=r===0?t:r}}]),n}(),Er=function(){function n(){Q(this,n)}return $(n,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(e){if(!(e.length<7)){for(var t=(e[4]&3)+1,r,i=[],a=[],o=6,u=e[5]&31,l,f=0;f<u;f++)if(l=e[o]<<8|e[o+1],o+=2,!!l){var c=e.subarray(o,o+l);o+=l,i.push(c),r||(r=n.parseSPS(me.removeEPB(c)))}var d=e[o];o++;for(var p,_=0;_<d;_++)p=e[o]<<8|e[o+1],o+=2,p&&(a.push(e.subarray(o,o+p)),o+=p);return{sps:r,spsArr:i,ppsArr:a,nalUnitSize:t}}}},{key:"parseSPS",value:function(e){var t=new Dt(e);t.readUByte();var r=t.readUByte(),i=t.readUByte(),a=t.readUByte();t.skipUEG();var o=420;if(r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128||r===138||r===144){var u=t.readUEG();if(u<=3&&(o=[0,420,422,444][u]),u===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=u!==3?8:12,f=0;f<l;f++)t.readBool()&&(f<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(c===0)t.readUEG();else if(c===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var d=t.readUEG(),p=0;p<d;p++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var _=t.readUEG(),E=t.readUEG(),g=t.readBits(1);g===0&&t.skipBits(1),t.skipBits(1);var S=0,R=0,T=0,y=0;t.readBool()&&(S=t.readUEG(),R=t.readUEG(),T=t.readUEG(),y=t.readUEG());var k,N,z,G,K;if(t.readBool()){if(t.readBool()){var U=t.readUByte();switch(U){case 1:k=[1,1];break;case 2:k=[12,11];break;case 3:k=[10,11];break;case 4:k=[16,11];break;case 5:k=[40,33];break;case 6:k=[24,11];break;case 7:k=[20,11];break;case 8:k=[32,11];break;case 9:k=[80,33];break;case 10:k=[18,11];break;case 11:k=[15,11];break;case 12:k=[64,33];break;case 13:k=[160,99];break;case 14:k=[4,3];break;case 15:k=[3,2];break;case 16:k=[2,1];break;case 255:{k=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var J=t.readBits(32),v=t.readBits(32);N=t.readBool(),z=v,G=J*2,K=z/G}}return{codec:br(e.subarray(1,4)),profileIdc:r,profileCompatibility:i,levelIdc:a,chromaFormat:o,width:Math.ceil((_+1)*16-2*(S+R)),height:(2-g)*(E+1)*16-(g?2:4)*(T+y),sarRatio:k,fpsNum:z,fpsDen:G,fps:K,fixedFrame:N}}}]),n}(),At=function(){function n(){Q(this,n)}return $(n,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(e.length<23)){t=t||{};for(var r=(e[21]&3)+1,i,a,o=[],u=[],l=[],f=23,c=e[22],d,p,_,E=0;E<c;E++){d=e[f]&63,p=e[f+1]<<8|e[f+2],f+=3;for(var g=0;g<p;g++)if(_=e[f]<<8|e[f+1],f+=2,!!_){switch(d){case 32:{var S=e.subarray(f,f+_);i||(i=n.parseVPS(me.removeEPB(S),t)),l.push(S)}break;case 33:{var R=e.subarray(f,f+_);a||(a=n.parseSPS(me.removeEPB(R),t)),o.push(R)}break;case 34:u.push(e.subarray(f,f+_));break}f+=_}}return{hvcC:t,sps:a,spsArr:o,ppsArr:u,vpsArr:l,nalUnitSize:r}}}},{key:"parseVPS",value:function(e,t){t=t||{};var r=new Dt(e);r.readUByte(),r.readUByte(),r.readBits(12);var i=r.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,i+1),r.readBits(17),n._parseProfileTierLevel(r,i,t),t}},{key:"parseSPS",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var r=new Dt(e);r.readUByte(),r.readUByte(),r.readBits(4);var i=r.readBits(3);t.numTemporalLayers=Math.max(i+1,t.numTemporalLayers||0),t.temporalIdNested=r.readBits(1),n._parseProfileTierLevel(r,i,t),r.readUEG();var a=t.chromaFormatIdc=r.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var u=0;a===3&&(u=r.readBits(1));var l=r.readUEG(),f=r.readUEG(),c=r.readBits(1),d,p,_,E;if(c===1&&(d=r.readUEG(),p=r.readUEG(),_=r.readUEG(),E=r.readUEG()),t.bitDepthLumaMinus8=r.readUEG(),t.bitDepthChromaMinus8=r.readUEG(),c===1){var g=(a===1||a===2)&&u===0?2:1,S=a===1&&u===0?2:1;l-=g*(p+d),f-=S*(E+_)}return{codec:"hev1.1.6.L93.B0",width:l,height:f,chromaFormat:o,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var i=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),i),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var a=e.readBits(8);i<r.generalTierFlag?r.generalLevelIdc=a:r.generalLevelIdc=Math.max(a,r.generalLevelIdc||0);for(var o=[],u=[],l=0;l<t;l++)o[l]=e.readBits(1),u[l]=e.readBits(1);t>0&&e.readBits((8-t)*2);for(var f=0;f<t;f++)o[f]!==0&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),u[f]!==0&&e.readBits(8)}}]),n}(),Jt=function(){function n(){Q(this,n)}return $(n,null,[{key:"decode",value:function(e){for(var t=[],r=e,i=0,a=e.length;i<a;){if(r[i]<128){t.push(String.fromCharCode(r[i])),++i;continue}else if(!(r[i]<192)){if(r[i]<224){if(n._checkContinuation(r,i,1)){var o=(r[i]&31)<<6|r[i+1]&63;if(o>=128){t.push(String.fromCharCode(o&65535)),i+=2;continue}}}else if(r[i]<240){if(n._checkContinuation(r,i,2)){var u=(r[i]&15)<<12|(r[i+1]&63)<<6|r[i+2]&63;if(u>=2048&&(u&63488)!==55296){t.push(String.fromCharCode(u&65535)),i+=3;continue}}}else if(r[i]<248&&n._checkContinuation(r,i,3)){var l=(r[i]&7)<<18|(r[i+1]&63)<<12|(r[i+2]&63)<<6|r[i+3]&63;if(l>65536&&l<1114112){l-=65536,t.push(String.fromCharCode(l>>>10|55296)),t.push(String.fromCharCode(l&1023|56320)),i+=4;continue}}}t.push(String.fromCharCode(65533)),++i}return t.join("")}},{key:"_checkContinuation",value:function(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if((i[++t]&192)!==128)return!1;return!0}else return!1}}]),n}(),Ai=function(){function n(){Q(this,n)}return $(n,null,[{key:"parse",value:function(e){if(!(e.length<3)){var t={},r=n._parseValue(new DataView(e.buffer,e.byteOffset,e.byteLength)),i=n._parseValue(new DataView(e.buffer,e.byteOffset+r.size,e.byteLength-r.size));return t[r.data]=i.data,t}}},{key:"_parseValue",value:function(e){var t=e.byteLength,r=e.getUint8(0),i=1,a=!1,o;switch(r){case 0:o=e.getFloat64(1),i+=8;break;case 1:{o=!!e.getUint8(1),i+=1;break}case 2:{var u=n._parseString(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i)),l=u.data,f=u.size;o=l,i+=f}break;case 3:{o={};var c=0;for((e.getUint32(t-4)&16777215)===9&&(c=3);i<t-4;){var d=n._parseObject(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i-c)),p=d.size,_=d.data,E=d.isEnd;if(E)break;o[_.name]=_.value,i+=p}if(i<=t-3){var g=e.getUint32(i-1)&16777215;g===9&&(i+=3)}}break;case 8:{o={},i+=4;var S=0;for((e.getUint32(t-4)&16777215)===9&&(S=3);i<t-8;){var R=n._parseObject(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i-S)),T=R.size,y=R.data,k=R.isEnd;if(k)break;o[y.name]=y.value,i+=T}if(i<=t-3){var N=e.getUint32(i-1)&16777215;N===9&&(i+=3)}}break;case 9:o=void 0,i=1,a=!0;break;case 10:{o=[];var z=e.getUint32(1);i+=4;for(var G=0;G<z;G++){var K=n._parseValue(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i)),U=K.data,J=K.size;o.push(U),i+=J}}break;case 11:{var v=e.getFloat64(i)+e.getInt16(i+8)*6e4;o=new Date(v),i+=10}break;case 12:{var h=e.getUint32(1);i+=4,o="",h>0&&(o=Jt.decode(new Uint8Array(e.buffer,e.byteOffset+i,h))),i+=h}break;default:i=t;break}return{data:o,size:i,isEnd:a}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return t>0&&(r=Jt.decode(new Uint8Array(e.buffer,e.byteOffset+2,t))),{data:r,size:2+t}}},{key:"_parseObject",value:function(e){if(!(e.byteLength<3)){var t=n._parseString(e),r=n._parseValue(new DataView(e.buffer,e.byteOffset+t.size,e.byteLength-t.size));return{data:{name:t.data,value:r.data},size:t.size+r.size,isEnd:r.isEnd}}}}]),n}(),ye=new je("FlvDemuxer"),Sr=function(){function n(s,e,t){Q(this,n),w(this,"_headerParsed",!1),w(this,"_remainingData",null),w(this,"_gopId",0),w(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=s||new Tt,this.audioTrack=e||new kt,this.metadataTrack=t||new Rt,this._fixer=new Si(this.videoTrack,this.audioTrack,this.metadataTrack)}return $(n,[{key:"demux",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.audioTrack,a=this.videoTrack,o=this.metadataTrack;if((t||!r)&&(this._remainingData=null,this._headerParsed=!1),t?(a.reset(),i.reset(),o.reset()):(a.samples=[],i.samples=[],o.seiSamples=[],o.flvScriptSamples=[],a.warnings=[],i.warnings=[],this._remainingData&&(e=he(this._remainingData,e),this._remainingData=null)),!e.length)return{videoTrack:a,audioTrack:i,metadataTrack:o};var u=0;if(!this._headerParsed){if(!n.probe(e))throw new Error("Invalid flv file");i.present=(e[4]&4)>>>2!==0,a.present=(e[4]&1)!==0,this._headerParsed=!0,u=O(e,5)+4}for(var l=e.length,f,c,d,p,_;u+15<l&&(f=e[u],c=e[u+1]<<16|e[u+2]<<8|e[u+3],!(u+15+c>l));)d=(e[u+7]<<24>>>0)+(e[u+4]<<16)+(e[u+5]<<8)+e[u+6],u+=11,p=e.subarray(u,u+c),f===8?this._parseAudio(p,d):f===9?this._parseVideo(p,d):f===18?this._parseScript(p,d):ye.warn("Invalid tag type: ".concat(f)),u+=c,_=O(e,u),_!==11+c&&ye.warn("Invalid PrevTagSize ".concat(_," (").concat(11+c,")")),u+=4;return u<l&&(this._remainingData=e.subarray(u)),i.formatTimescale=a.formatTimescale=a.timescale=o.timescale=1e3,i.timescale=i.sampleRate||0,!i.exist()&&i.hasSample()&&i.reset(),!a.exist()&&a.hasSample()&&a.reset(),{videoTrack:a,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,i){return this.demux(e,t,r),this.fix(i,t,r)}},{key:"_parseAudio",value:function(e,t){if(e.length){var r=(e[0]&240)>>>4,i=this.audioTrack;if(r!==10&&r!==7&&r!==8){ye.warn("Unsupported sound format: ".concat(r)),i.reset();return}if(r!==10){var a=(e[0]&12)>>2,o=(e[0]&2)>>1,u=e[0]&1;i.sampleRate=n.AUDIO_RATE[a],i.sampleSize=o?16:8,i.channelCount=u+1}r===10?this._parseAac(e,t):this._parseG711(e,t,r)}}},{key:"_parseG711",value:function(e,t,r){var i=this.audioTrack;i.codecType=r===7?_e.G711PCMA:_e.G711PCMU,i.sampleRate=8e3,i.codec=i.codecType,i.samples.push(new Ie(t,e.subarray(1)))}},{key:"_parseAac",value:function(e,t){var r=this.audioTrack;if(r.codecType=_e.AAC,e[1]===0){var i=ve.parseAudioSpecificConfig(e.subarray(2));i?(r.codec=i.codec,r.channelCount=i.channelCount,r.sampleRate=i.sampleRate,r.config=i.config,r.objectType=i.objectType,r.sampleRateIndex=i.samplingFrequencyIndex):(r.reset(),ye.warn("Cannot parse AudioSpecificConfig",e))}else if(e[1]===1){if(t==null)return;r.samples.push(new Ie(t,e.subarray(2)))}else ye.warn("Unknown AACPacketType: ".concat(e[1]))}},{key:"_parseVideo",value:function(e,t){var r=this;if(!(e.length<6)){var i=(e[0]&240)>>>4,a=e[0]&15,o=this.videoTrack;if(a!==7&&a!==12){o.reset(),ye.warn("Unsupported codecId: ".concat(a));return}var u=a===12;o.codecType=u?De.HEVC:De.AVC;var l=e[1],f=(e[2]<<16|e[3]<<8|e[4])<<8>>8;if(l===0){var c=e.subarray(5),d=u?At.parseHEVCDecoderConfigurationRecord(c):Er.parseAVCDecoderConfigurationRecord(c);if(d){var p=d.hvcC,_=d.sps,E=d.ppsArr,g=d.spsArr,S=d.vpsArr,R=d.nalUnitSize;p&&(o.hvcC=o.hvcC||p),_&&(o.codec=_.codec,o.width=_.width,o.height=_.height,o.sarRatio=_.sarRatio,o.fpsNum=_.fpsNum,o.fpsDen=_.fpsDen),g.length&&(o.sps=g),E.length&&(o.pps=E),S&&S.length&&(o.vps=S),R&&(o.nalUnitSize=R)}else ye.warn("Cannot parse ".concat(u?"HEVC":"AVC","DecoderConfigurationRecord"),e)}else if(l===1){var T=me.parseAvcC(e.subarray(5),o.nalUnitSize);if(T=this._checkAddMetaNalToUnits(u,T,o),T&&T.length){var y=new Ot(t+f,t,T);i===1&&y.setToKeyframe(),o.samples.push(y),T.forEach(function(k){var N=u?k[0]>>>1&63:k[0]&31;switch(N){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!u&&N!==5||u&&N===5)break;y.setToKeyframe();break;case 6:case 39:case 40:if(!u&&N!==6||u&&N===6)break;r.metadataTrack.seiSamples.push(new _r(me.parseSEI(me.removeEPB(k),u),t+f));break}}),y.keyframe&&this._gopId++,y.gopId=this._gopId}else ye.warn("Cannot parse NALUs",e)}else l===2||ye.warn("Unknown AVCPacketType: ".concat(l))}}},{key:"_checkAddMetaNalToUnits",value:function(e,t,r){if(!e||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,t;var i=t.map(function(a){return a[0]>>>1&63});return i.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(r.pps[0]),t.unshift(r.sps[0]),t.unshift(r.vps[0]),t.filter(Boolean))}},{key:"_parseScript",value:function(e,t){this.metadataTrack.flvScriptSamples.push(new mi(Ai.parse(e),t))}}],[{key:"probe",value:function(e){return e[0]!==70||e[1]!==76||e[2]!==86||e[3]!==1?!1:O(e,5)>=9}}]),n}();w(Sr,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var Ti=9e4/2,Zt=3,vt=9e4,pt=5*9e4,mt=9e4,ki=9e4/2,Oi=function(){function n(s,e,t){Q(this,n),this.videoTrack=s,this.audioTrack=e,this.metadataTrack=t,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return $(n,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*9e4);var a=this.videoTrack,o=this.audioTrack,u=a.samples,l=o.samples;if(!(!u.length&&!l.length)){var f=u[0],c=l[0],d=0;if(u.length&&l.length&&(d=f.dts-c.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),r&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!i){this._videoNextDts=d>0?t+d:t,this._audioNextPts=d>0?t:t-d;var p=f?f.dts-this._baseDts-this._videoNextDts:0,_=c?c.pts-this._baseDts-this._audioNextPts:0;Math.abs(p||_)>mt&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._fixVideo(a),this.metadataTrack.exist()){var E=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(g){g.pts=g.originPts-e._baseDts,g.time=Math.max(0,g.pts)/E})}a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){if(r.forEach(function(T){T.dts-=t._baseDts,T.pts-=t._baseDts}),this._videoNextDts===void 0){var i=r[0];this._videoNextDts=i.dts}var a=r.length,o=0,u=r[0],l=r[1],f=this._videoNextDts-u.dts;if(Math.abs(f)>ki){var c;u.dts+=f,u.pts+=f,e.warnings.push({type:re.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:u.dts,nextSampleDts:(c=r[1])===null||c===void 0?void 0:c.dts,sampleDuration:f}),l&&Math.abs(l.dts-u.dts)>mt&&(this._videoTimestampBreak=!0,r.forEach(function(T,y){y!==0&&(T.dts+=f,T.pts+=f)}))}var d;if(e.fpsNum&&e.fpsDen)d=e.timescale*(e.fpsDen/e.fpsNum);else{var p=e.samples[0],_=e.samples[a-1];d=a===1?9e3:Math.floor((_.dts-p.dts)/(a-1))}for(var E=0;E<a;E++){var g=r[E].dts,S=r[E+1];if(E<a-1?o=S.dts-g:r[E-1]?o=Math.min(g-r[E-1].dts,d):o=d,o>mt||o<0){this._videoTimestampBreak=!0,o=this._audioTimestampBreak?d:Math.max(o,30*90);var R=this._audioNextPts||0;S&&S.dts>R&&(o=d),e.warnings.push({type:re.LARGE_VIDEO_GAP,time:g/e.timescale,dts:g,originDts:r[E].originDts,nextDts:this._videoNextDts,sampleDuration:o,refSampleDuration:d})}r[E].duration=o,this._videoNextDts+=o}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach(function(i){i.pts-=t._baseDts,i.dts=i.pts}),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,i=t.samples;if(!r.length&&!i.length)return!1;var a=1/0,o=1/0;r.length&&(e.baseDts=a=r[0].pts),i.length&&(t.baseDts=o=i[0].dts),this._baseDts=Math.min(a,o);var u=o-a;return Number.isFinite(u)&&Math.abs(u)>Ti&&t.warnings.push({type:re.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:a,baseDts:this._baseDts,delta:u}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var e=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!e)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=ve.getFrameDuration(e.timescale,r));var i=e.sampleDuration;if(this._audioNextPts===void 0){var a=t[0];this._audioNextPts=a.pts}for(var o=0;o<t.length;o++){var u=this._audioNextPts,l=t[o],f=l.pts-u;if(!this._audioTimestampBreak&&f>=Zt*i&&f<=vt&&!yr){var c=ve.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),d=Math.floor(f/i);Math.abs(l.pts-this._lastAudioExceptionGapDot)>pt&&(this._lastAudioExceptionGapDot=l.pts),e.warnings.push({type:re.AUDIO_FILLED,pts:l.pts,originPts:l.originPts,count:d,nextPts:u,refSampleDuration:i});for(var p=0;p<d;p++){var _=new Ie(Math.floor(u),c);_.originPts=Math.floor(this._baseDts+u),t.splice(o,0,_),this._audioNextPts+=i,o++}o--}else f<=-Zt*i&&f>=-1*vt?(Math.abs(l.pts-this._lastAudioExceptionOverlapDot)>pt&&(this._lastAudioExceptionOverlapDot=l.pts,e.warnings.push({type:re.AUDIO_DROPPED,pts:l.pts,originPts:l.originPts,nextPts:u,refSampleDuration:i})),t.splice(o,1),o--):(Math.abs(f)>=vt&&(this._audioTimestampBreak=!0,Math.abs(l.pts-this._lastAudioExceptionLargeGapDot)>pt&&(this._lastAudioExceptionLargeGapDot=l.pts,e.warnings.push({type:re.LARGE_AUDIO_GAP,time:l.pts/1e3,pts:l.pts,originPts:l.originPts,nextPts:u,sampleDuration:f,refSampleDuration:i}))),l.dts=l.pts=u,this._audioNextPts+=i)}}}]),n}(),pe=new je("TsDemuxer"),Ni=function(){function n(s,e,t){Q(this,n),w(this,"_pmtId",-1),w(this,"_remainingPacketData",null),w(this,"_videoPesData",[]),w(this,"_audioPesData",[]),w(this,"_gopId",0),this.videoTrack=s||new Tt,this.audioTrack=e||new kt,this.metadataTrack=t||new Rt,this._fixer=new Oi(this.videoTrack,this.audioTrack,this.metadataTrack)}return $(n,[{key:"demux",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.audioTrack,a=this.videoTrack,o=this.metadataTrack;t&&(this._pmtId=-1,a.reset(),i.reset(),o.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(a.samples=[],i.samples=[],o.seiSamples=[],a.warnings=[],i.warnings=[],this._remainingPacketData&&(e=he(this._remainingPacketData,e),this._remainingPacketData=null));var u=e.length,l=u%188;l&&(this._remainingPacketData=e.subarray(u-l),u-=l);for(var f=a.pid,c=i.pid,d=0;d<u;d+=188){if(e[d]!==71)throw new Error("TS packet did not start with 0x47");var p=!!(e[d+1]&64),_=((e[d+1]&31)<<8)+e[d+2],E=(e[d+3]&48)>>4,g=void 0;if(E>1){if(g=d+5+e[d+4],g===d+188)continue}else g=d+4;switch(_){case 0:p&&(g+=e[g]+1),this._pmtId=(e[g+10]&31)<<8|e[g+11];break;case this._pmtId:{p&&(g+=e[g]+1);var S=g+3+((e[g+1]&15)<<8|e[g+2])-4,R=(e[g+10]&15)<<8|e[g+11];for(g+=12+R;g<S;){var T=(e[g+1]&31)<<8|e[g+2];switch(e[g]){case 15:i.pid=c=T;break;case 27:if(f!==-1)break;a.codecType=De.AVC,a.pid=f=T;break;case 36:if(f!==-1)break;a.codecType=De.HEVC,a.pid=f=T;break;default:pe.warn("Unsupported stream. type: ".concat(e[g],", pid: ").concat(T))}g+=((e[g+3]&15)<<8|e[g+4])+5}}break;case f:p&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(g,d+188));break;case c:p&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(g,d+188));break;case 17:case 8191:break;default:pe.warn("Unknown pid: ".concat(_))}}return this._parseVideoData(),this._parseAudioData(),i.formatTimescale=a.formatTimescale=a.timescale=o.timescale=9e4,i.timescale=i.sampleRate||0,{videoTrack:a,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,i){return this.demux(e,t,r),this.fix(i,t,r)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var e=n._parsePES(he.apply(void 0,ce(this._videoPesData)));if(!e){pe.warn("Cannot parse video pes",this._videoPesData);return}var t=me.parseAnnexB(e.data);t?this._createVideoSample(t,e.pts,e.dts):pe.warn("Cannot parse avc units",e),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(e,t,r){var i=this;if(e.length){var a=this.videoTrack,o=a.codecType===De.HEVC,u=new Ot(t,r);e.forEach(function(l){var f=o?l[0]>>>1&63:l[0]&31;switch(f){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&f!==5||o&&f===5)break;u.setToKeyframe(),i._gopId++;break;case 6:case 39:case 40:if(!o&&f!==6||o&&f===6)break;i.metadataTrack.seiSamples.push(new _r(me.parseSEI(me.removeEPB(l),o),t));return;case 32:if(!o)break;if(!a.vps.length){var c=At.parseVPS(me.removeEPB(l),a.hvcC);a.hvcC=a.hvcC||c,a.vps=[l]}break;case 7:case 33:if(!o&&f!==7||o&&f===7)break;if(!a.sps.length){var d=me.removeEPB(l),p=o?At.parseSPS(d,a.hvcC):Er.parseSPS(d);a.sps=[l],a.hvcC=a.hvcC||p.hvcC,a.codec=p.codec,a.width=p.width,a.height=p.height,a.sarRatio=p.sarRatio,a.fpsNum=p.fpsNum,a.fpsDen=p.fpsDen}break;case 8:case 34:if(!o&&f!==8||o&&f===8)break;a.pps.length||(a.pps=[l]);break}u.units.push(l)}),u.gopId=this._gopId,this._pushVideoSample(a,u)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length)if(t.pts===null||t.pts===void 0){pe.warn("Video sample no pts",t);var r=e.samples[e.samples.length-1];r?(t.pts=r.pts,t.dts=r.dts):pe.warn("Drop video sample",t)}else e.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var e=n._parsePES(he.apply(void 0,ce(this._audioPesData)));if(!e){pe.warn("Cannot parse audio pes",this._audioPesData);return}this._parseAacData(e),this._audioPesData=[]}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(r==null){if(pe.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+ve.getFrameDuration(t.sampleRate)}var i=ve.parseADTS(e.data,r);if(i){var a;t.codec=i.codec,t.channelCount=i.channelCount,t.sampleRate=i.sampleRate,t.objectType=i.objectType,t.sampleRateIndex=i.samplingFrequencyIndex,t.config=i.config,(a=t.samples).push.apply(a,ce(i.frames.map(function(o){return new Ie(o.pts,o.data)}))),i.skip&&pe.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&pe.warn("Remaining aac adts ".concat(i.remaining," bits"))}else pe.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return e.length?e[0]===71&&e[188]===71&&e[376]===71:!1}},{key:"_parsePES",value:function(e){var t=e[8];if(!(t==null||e.length<t+9)){var r=e[0]<<16|e[1]<<8|e[2];if(r===1){var i=(e[4]<<8)+e[5];if(!(i&&i>e.length-6)){var a,o,u=e[7];return u&192&&(a=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,u&64?(o=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,a-o>60*9e4&&(a=o)):o=a),{data:e.subarray(9+t),pts:a,dts:o}}}}}}]),n}(),fe=function(){function n(){Q(this,n)}return $(n,null,[{key:"findBox",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[];if(!e)return i;for(var a=0,o="",u=0;e.length>7;){if(a=O(e),o=String.fromCharCode.apply(null,e.subarray(4,8)),u=8,a===1?(a=Ae(e,8),u+=8):a||(a=e.length),!t[0]||o===t[0]){var l=e.subarray(0,a);if(t.length<2)i.push({start:r,size:a,headerSize:u,type:o,data:l});else return n.findBox(l.subarray(u),t.slice(1),r+u)}r+=a,e=e.subarray(a)}return i}},{key:"tfhd",value:function(e){return F(e,!0,function(t,r){t.trackId=O(r);var i=4,a=t.flags&255&1,o=t.flags&255&2,u=t.flags&255&8,l=t.flags&255&16,f=t.flags&255&32;a&&(i+=4,t.baseDataOffset=O(r,i),i+=4),o&&(t.sampleDescriptionIndex=O(r,i),i+=4),u&&(t.defaultSampleDuration=O(r,i),i+=4),l&&(t.defaultSampleSize=O(r,i),i+=4),f&&(t.defaultSampleFlags=O(r,i))})}},{key:"sidx",value:function(e){return F(e,!0,function(t,r){var i=0;t.reference_ID=O(r,i),i+=4,t.timescale=O(r,i),i+=4,t.version===0?(t.earliest_presentation_time=O(r,i),i+=4,t.first_offset=O(r,i),i+=4):(t.earliest_presentation_time=Ae(r,i),i+=8,t.first_offset=Ae(r,i),i+=8),i+=2,t.references=[];var a=Y(r,i);i+=2;for(var o=0;o<a;o++){var u={};t.references.push(u);var l=O(r,i);i+=4,u.reference_type=l>>31&1,u.referenced_size=l&2147483647,u.subsegment_duration=O(r,i),i+=4,l=O(r,i),i+=4,u.starts_with_SAP=l>>31&1,u.SAP_type=l>>28&7,u.SAP_delta_time=l&268435455}})}},{key:"moov",value:function(e){return F(e,!1,function(t,r,i){t.mvhd=n.mvhd(n.findBox(r,["mvhd"],i)[0]),t.trak=n.findBox(r,["trak"],i).map(function(a){return n.trak(a)}),t.pssh=n.pssh(n.findBox(r,["pssh"],i)[0])})}},{key:"mvhd",value:function(e){return F(e,!0,function(t,r){var i=0;t.version===1?(t.timescale=O(r,16),t.duration=Ae(r,20),i+=28):(t.timescale=O(r,8),t.duration=O(r,12),i+=16),t.nextTrackId=O(r,i+76)})}},{key:"trak",value:function(e){return F(e,!1,function(t,r,i){t.tkhd=n.tkhd(n.findBox(r,["tkhd"],i)[0]),t.mdia=n.mdia(n.findBox(r,["mdia"],i)[0])})}},{key:"tkhd",value:function(e){return F(e,!0,function(t,r){var i=0;t.version===1?(t.trackId=O(r,16),t.duration=Ae(r,24),i+=32):(t.trackId=O(r,8),t.duration=O(r,16),i+=20),t.width=O(r,i+52),t.height=O(r,i+56)})}},{key:"mdia",value:function(e){return F(e,!1,function(t,r,i){t.mdhd=n.mdhd(n.findBox(r,["mdhd"],i)[0]),t.hdlr=n.hdlr(n.findBox(r,["hdlr"],i)[0]),t.minf=n.minf(n.findBox(r,["minf"],i)[0])})}},{key:"mdhd",value:function(e){return F(e,!0,function(t,r){var i=0;t.version===1?(t.timescale=O(r,16),t.duration=Ae(r,20),i+=28):(t.timescale=O(r,8),t.duration=O(r,12),i+=16);var a=Y(r,i);t.language=String.fromCharCode((a>>10&31)+96,(a>>5&31)+96,(a&31)+96)})}},{key:"hdlr",value:function(e){return F(e,!0,function(t,r){t.version===0&&(t.handlerType=String.fromCharCode.apply(null,r.subarray(4,8)))})}},{key:"minf",value:function(e){return F(e,!1,function(t,r,i){t.vmhd=n.vmhd(n.findBox(r,["vmhd"],i)[0]),t.smhd=n.smhd(n.findBox(r,["smhd"],i)[0]),t.stbl=n.stbl(n.findBox(r,["stbl"],i)[0])})}},{key:"vmhd",value:function(e){return F(e,!0,function(t,r){t.graphicsmode=Y(r),t.opcolor=[Y(r,2),Y(r,4),Y(r,6)]})}},{key:"smhd",value:function(e){return F(e,!0,function(t,r){t.balance=Y(r)})}},{key:"stbl",value:function(e){return F(e,!1,function(t,r,i){var a,o,u;t.stsd=n.stsd(n.findBox(r,["stsd"],i)[0]),t.stts=n.stts(n.findBox(r,["stts"],i)[0]),t.ctts=n.ctts(n.findBox(r,["ctts"],i)[0]),t.stsc=n.stsc(n.findBox(r,["stsc"],i)[0]),t.stsz=n.stsz(n.findBox(r,["stsz"],i)[0]),t.stco=n.stco(n.findBox(r,["stco"],i)[0]),t.stco||(t.co64=n.co64(n.findBox(r,["co64"],i)[0]),t.stco=t.co64);var l=(a=t.stsd.entries[0])===null||a===void 0||(o=a.sinf)===null||o===void 0||(u=o.schi)===null||u===void 0?void 0:u.tenc.default_IV_size;t.stss=n.stss(n.findBox(r,["stss"],i)[0]),t.senc=n.senc(n.findBox(r,["senc"],i)[0],l)})}},{key:"senc",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return F(e,!0,function(r,i){var a=0,o=O(i,a);a+=4,r.samples=[];for(var u=0;u<o;u++){var l={};l.InitializationVector=[];for(var f=0;f<t;f++)l.InitializationVector[f]=i[a+f];if(a+=t,r.flags&2){l.subsamples=[];var c=Y(i,a);a+=2;for(var d=0;d<c;d++){var p={};p.BytesOfClearData=Y(i,a),a+=2,p.BytesOfProtectedData=O(i,a),a+=4,l.subsamples.push(p)}}r.samples.push(l)}})}},{key:"pssh",value:function(e){return F(e,!0,function(t,r){for(var i=[],a=[],o=0,u=0;u<16;u++)a.push(gt(r[o+u]));if(o+=16,t.version>0){var l=O(r,o);o+=4;for(var f=0;f<(""+l).length;f++)for(var c=0;c<16;c++){var d=r[o];o+=1,i.push(gt(d))}}var p=O(r,o);t.data_size=p,o+=4,t.kid=i,t.system_id=a,t.buffer=r})}},{key:"stsd",value:function(e){return F(e,!0,function(t,r,i){t.entryCount=O(r),t.entries=n.findBox(r.subarray(4),[],i+4).map(function(a){switch(a.type){case"avc1":case"avc2":case"avc3":case"avc4":return n.avc1(a);case"hvc1":case"hev1":return n.hvc1(a);case"mp4a":return n.mp4a(a);case"alaw":case"ulaw":return n.alaw(a);case"enca":return F(a,!1,function(o,u,l){o.channelCount=Y(u,16),o.samplesize=Y(u,18),o.sampleRate=O(u,24)/65536,u=u.subarray(28),o.sinf=n.sinf(n.findBox(u,["sinf"],l)[0]),o.esds=n.esds(n.findBox(u,["esds"],l)[0])});case"encv":return F(a,!1,function(o,u,l){o.width=Y(u,24),o.height=Y(u,26),o.horizresolution=O(u,28),o.vertresolution=O(u,32),u=u.subarray(78),o.sinf=n.sinf(n.findBox(u,["sinf"],l)[0]),o.avcC=n.avcC(n.findBox(u,["avcC"],l)[0]),o.hvcC=n.hvcC(n.findBox(u,["hvcC"],l)[0]),o.pasp=n.pasp(n.findBox(u,["pasp"],l)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(e){return F(e,!1,function(t,r){var i=6;t.default_IsEncrypted=r[i],i+=1,t.default_IV_size=r[i],i+=1,t.default_KID=[];for(var a=0;a<16;a++)t.default_KID.push(gt(r[i])),i+=1})}},{key:"schi",value:function(e){return F(e,!1,function(t,r,i){t.tenc=n.tenc(n.findBox(r,["tenc"],i)[0])})}},{key:"sinf",value:function(e){return F(e,!1,function(t,r,i){t.schi=n.schi(n.findBox(r,["schi"],i)[0]),t.frma=n.frma(n.findBox(r,["frma"],i)[0])})}},{key:"frma",value:function(e){return F(e,!1,function(t,r){t.data_format="";for(var i=0;i<4;i++)t.data_format+=String.fromCharCode(r[i])})}},{key:"avc1",value:function(e){return F(e,!1,function(t,r,i){var a=tr(t,r),o=r.subarray(a);i+=a,t.avcC=n.avcC(n.findBox(o,["avcC"],i)[0]),t.pasp=n.pasp(n.findBox(o,["pasp"],i)[0])})}},{key:"avcC",value:function(e){return F(e,!1,function(t,r){t.configurationVersion=r[0],t.AVCProfileIndication=r[1],t.profileCompatibility=r[2],t.AVCLevelIndication=r[3],t.codec=br([r[1],r[2],r[3]]),t.lengthSizeMinusOne=r[4]&3,t.spsLength=r[5]&31,t.sps=[];for(var i=6,a=0;a<t.spsLength;a++){var o=Y(r,i);i+=2,t.sps.push(r.subarray(i,i+o)),i+=o}t.ppsLength=r[i],i+=1,t.pps=[];for(var u=0;u<t.ppsLength;u++){var l=Y(r,i);i+=2,t.pps.push(r.subarray(i,i+=l)),i+=l}})}},{key:"hvc1",value:function(e){return F(e,!1,function(t,r,i){var a=tr(t,r),o=r.subarray(a);i+=a,t.hvcC=n.hvcC(n.findBox(o,["hvcC"],i)[0]),t.pasp=n.pasp(n.findBox(o,["pasp"],i)[0])})}},{key:"hvcC",value:function(e){return F(e,!1,function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var i=r[1];t.generalProfileSpace=i>>6,t.generalTierFlag=(i&32)>>5,t.generalProfileIdc=i&31,t.generalProfileCompatibility=O(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=Y(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var a=23,o=0,u=0,l=0,f=0;f<t.numOfArrays;f++){o=r[a]&63,u=Y(r,a+1),a+=3;for(var c=[],d=0;d<u;d++)l=Y(r,a),a+=2,c.push(r.subarray(a,a+l)),a+=l;if(o===32){var p;(p=t.vps).push.apply(p,c)}else if(o===33){var _;(_=t.sps).push.apply(_,c)}else if(o===34){var E;(E=t.pps).push.apply(E,c)}}})}},{key:"pasp",value:function(e){return F(e,!1,function(t,r){t.hSpacing=O(r),t.vSpacing=O(r,4)})}},{key:"mp4a",value:function(e){return F(e,!1,function(t,r,i){var a=rr(t,r);t.esds=n.esds(n.findBox(r.subarray(a),["esds"],i+a)[0])})}},{key:"esds",value:function(e){return F(e,!0,function(t,r){t.codec="mp4a.";for(var i=0,a=0,o=0,u=0;r.length;){for(i=0,u=r[i],a=r[i+1],i+=2;a&128;)o=(a&127)<<7,a=r[i],i+=1;if(o+=a&127,u===3)r=r.subarray(i+3);else if(u===4)t.codec+=(r[i].toString(16)+".").padStart(3,"0"),r=r.subarray(i+13);else if(u===5){var l=t.config=r.subarray(i,i+o),f=(l[0]&248)>>3;f===31&&l.length>=2&&(f=32+((l[0]&7)<<3)+((l[1]&224)>>5)),t.objectType=f,t.codec+=f.toString(16),t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}else{t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}}})}},{key:"alaw",value:function(e){return F(e,!1,function(t,r){rr(t,r)})}},{key:"stts",value:function(e){return F(e,!0,function(t,r){for(var i=O(r),a=[],o=4,u=0;u<i;u++)a.push({count:O(r,o),delta:O(r,o+4)}),o+=8;t.entryCount=i,t.entries=a})}},{key:"ctts",value:function(e){return F(e,!0,function(t,r){var i=O(r),a=[],o=4;if(t.version===1)for(var u=0;u<i;u++)a.push({count:O(r,o),offset:O(r,o+4)}),o+=8;else for(var l=0;l<i;l++)a.push({count:O(r,o),offset:-(~O(r,o+4)+1)}),o+=8;t.entryCount=i,t.entries=a})}},{key:"stsc",value:function(e){return F(e,!0,function(t,r){for(var i=O(r),a=[],o=4,u=0;u<i;u++)a.push({firstChunk:O(r,o),samplesPerChunk:O(r,o+4),sampleDescriptionIndex:O(r,o+8)}),o+=12;t.entryCount=i,t.entries=a})}},{key:"stsz",value:function(e){return F(e,!0,function(t,r){var i=O(r),a=O(r,4),o=[];if(!i)for(var u=8,l=0;l<a;l++)o.push(O(r,u)),u+=4;t.sampleSize=i,t.sampleCount=a,t.entrySizes=o})}},{key:"stco",value:function(e){return F(e,!0,function(t,r){for(var i=O(r),a=[],o=4,u=0;u<i;u++)a.push(O(r,o)),o+=4;t.entryCount=i,t.entries=a})}},{key:"co64",value:function(e){return F(e,!0,function(t,r){for(var i=O(r),a=[],o=4,u=0;u<i;u++)a.push(Ae(r,o)),o+=8;t.entryCount=i,t.entries=a})}},{key:"stss",value:function(e){return F(e,!0,function(t,r){for(var i=O(r),a=[],o=4,u=0;u<i;u++)a.push(O(r,o)),o+=4;t.entryCount=i,t.entries=a})}},{key:"moof",value:function(e){return F(e,!1,function(t,r,i){t.mfhd=n.mfhd(n.findBox(r,["mfhd"],i)[0]),t.traf=n.findBox(r,["traf"],i).map(function(a){return n.traf(a)})})}},{key:"mfhd",value:function(e){return F(e,!0,function(t,r){t.sequenceNumber=O(r)})}},{key:"traf",value:function(e){return F(e,!1,function(t,r,i){t.tfhd=n.tfhd(n.findBox(r,["tfhd"],i)[0]),t.tfdt=n.tfdt(n.findBox(r,["tfdt"],i)[0]),t.trun=n.trun(n.findBox(r,["trun"],i)[0])})}},{key:"trun",value:function(e){return F(e,!0,function(t,r){var i=t.version,a=t.flags,o=r.length,u=t.sampleCount=O(r),l=4;if(o>l&&a&1&&(t.dataOffset=-(~O(r,l)+1),l+=4),o>l&&a&4&&(t.firstSampleFlags=O(r,l),l+=4),t.samples=[],o>l)for(var f,c=0;c<u;c++)f={},a&256&&(f.duration=O(r,l),l+=4),a&512&&(f.size=O(r,l),l+=4),a&1024&&(f.flags=O(r,l),l+=4),a&2048&&(i?f.cts=-(~O(r,l+4)+1):f.cts=O(r,l),l+=4),t.samples.push(f)})}},{key:"tfdt",value:function(e){return F(e,!0,function(t,r){t.version===1?t.baseMediaDecodeTime=Ae(r):t.baseMediaDecodeTime=O(r)})}},{key:"probe",value:function(e){return!!n.findBox(e,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var i,a,o=e.trak;if(!(!o||!o.length)){var u=o.find(function(ft){var Re,Pe;return((Re=ft.mdia)===null||Re===void 0||(Pe=Re.hdlr)===null||Pe===void 0?void 0:Pe.handlerType)==="vide"}),l=o.find(function(ft){var Re,Pe;return((Re=ft.mdia)===null||Re===void 0||(Pe=Re.hdlr)===null||Pe===void 0?void 0:Pe.handlerType)==="soun"});if(u&&t){var f,c,d,p,_,E,g,S=t,R=(f=u.tkhd)===null||f===void 0?void 0:f.trackId;R!=null&&(S.id=u.tkhd.trackId),S.tkhdDuration=u.tkhd.duration,S.mvhdDurtion=e.mvhd.duration,S.mvhdTimecale=e.mvhd.timescale,S.timescale=S.formatTimescale=u.mdia.mdhd.timescale,S.duration=u.mdia.mdhd.duration||S.mvhdDurtion/S.mvhdTimecale*S.timescale;var T=u.mdia.minf.stbl.stsd.entries[0];if(S.width=T.width,S.height=T.height,T.pasp&&(S.sarRatio=[T.pasp.hSpacing,T.pasp.vSpacing]),T.hvcC)S.codecType=De.HEVC,S.codec=T.hvcC.codec,S.vps=T.hvcC.vps,S.sps=T.hvcC.sps,S.pps=T.hvcC.pps,S.hvcC=T.hvcC.data;else if(T.avcC)S.codec=T.avcC.codec,S.sps=T.avcC.sps,S.pps=T.avcC.pps;else throw new Error("unknown video stsd entry");if(S.present=!0,S.ext={},S.ext.stss=(c=u.mdia)===null||c===void 0||(d=c.minf)===null||d===void 0||(p=d.stbl)===null||p===void 0?void 0:p.stss,S.ext.ctts=(_=u.mdia)===null||_===void 0||(E=_.minf)===null||E===void 0||(g=E.stbl)===null||g===void 0?void 0:g.ctts,T&&T.type==="encv"){var y,k,N,z,G,K,U,J;S.isVideoEncryption=!0,T.default_KID=(y=T.sinf)===null||y===void 0||(k=y.schi)===null||k===void 0?void 0:k.tenc.default_KID,T.default_IsEncrypted=(N=T.sinf)===null||N===void 0||(z=N.schi)===null||z===void 0?void 0:z.tenc.default_IsEncrypted,T.default_IV_size=(G=T.sinf)===null||G===void 0||(K=G.schi)===null||K===void 0?void 0:K.tenc.default_IV_size,S.videoSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,T.data_format=(U=T.sinf)===null||U===void 0||(J=U.frma)===null||J===void 0?void 0:J.data_format,S.useEME=e.useEME,S.kidValue=e.kidValue,S.pssh=e.pssh,S.encv=T}}if(l&&r){var v,h,m,A,b,C,B,j,H,P=r,ee=(v=l.tkhd)===null||v===void 0?void 0:v.trackId;ee!=null&&(P.id=l.tkhd.trackId),P.tkhdDuration=l.tkhd.duration,P.mvhdDurtion=e.mvhd.duration,P.mvhdTimecale=e.mvhd.timescale,P.timescale=P.formatTimescale=l.mdia.mdhd.timescale,P.duration=l.mdia.mdhd.duration||P.mvhdDurtion/P.mvhdTimecale*P.timescale;var I=l.mdia.minf.stbl.stsd.entries[0];switch(P.sampleSize=I.sampleSize,P.sampleRate=I.sampleRate,P.channelCount=I.channelCount,P.present=!0,I.type){case"alaw":P.codecType=P.codec=_e.G711PCMA,P.sampleRate=8e3;break;case"ulaw":P.codecType=P.codec=_e.G711PCMU,P.sampleRate=8e3;break;default:P.sampleDuration=ve.getFrameDuration(P.sampleRate,P.timescale),P.sampleRateIndex=ve.getRateIndexByRate(P.sampleRate),P.objectType=((i=I.esds)===null||i===void 0?void 0:i.objectType)||2,I.esds&&(P.config=Array.from(I.esds.config)),P.codec=((a=I.esds)===null||a===void 0?void 0:a.codec)||"mp4a.40.2";break}if(P.sampleDuration=ve.getFrameDuration(P.sampleRate,P.timescale),P.objectType=((h=I.esds)===null||h===void 0?void 0:h.objectType)||2,I.esds&&(I.esds.config?P.config=Array.from(I.esds.config):console.warn("esds config is null")),P.codec=((m=I.esds)===null||m===void 0?void 0:m.codec)||"mp4a.40.2",P.sampleRateIndex=ve.getRateIndexByRate(P.sampleRate),P.ext={},P.ext.stss=(A=l.mdia)===null||A===void 0||(b=A.minf)===null||b===void 0||(C=b.stbl)===null||C===void 0?void 0:C.stss,P.ext.ctts=(B=l.mdia)===null||B===void 0||(j=B.minf)===null||j===void 0||(H=j.stbl)===null||H===void 0?void 0:H.ctts,P.present=!0,I&&I.type==="enca"){var ke,de,Oe,xe,qe,Z,st,ot;P.isAudioEncryption=!0,I.data_format=(ke=I.sinf)===null||ke===void 0||(de=ke.frma)===null||de===void 0?void 0:de.data_format,I.default_KID=(Oe=I.sinf)===null||Oe===void 0||(xe=Oe.schi)===null||xe===void 0?void 0:xe.tenc.default_KID,I.default_IsEncrypted=(qe=I.sinf)===null||qe===void 0||(Z=qe.schi)===null||Z===void 0?void 0:Z.tenc.default_IsEncrypted,I.default_IV_size=(st=I.sinf)===null||st===void 0||(ot=st.schi)===null||ot===void 0?void 0:ot.tenc.default_IV_size,P.audioSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,P.useEME=e.useEME,P.kidValue=e.kidValue,P.enca=I}}if(r&&(r.isVideoEncryption=t?t.isVideoEncryption:!1),t&&(t.isAudioEncryption=r?r.isAudioEncryption:!1),t!=null&&t.encv||r!=null&&r.enca){var ut,lt,Ct=t==null||(ut=t.encv)===null||ut===void 0?void 0:ut.default_KID,Lt=r==null||(lt=r.enca)===null||lt===void 0?void 0:lt.default_KID,It=Ct||Lt?(Ct||Lt).join(""):null;t&&(t.kid=It),r&&(r.kid=It)}return t&&(t.flags=3841),r&&(r.flags=1793),{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var i,a=t==null||(i=t.samples)===null||i===void 0?void 0:i.length;if(!a)return 1024;var o=1024*a/t.timescale;return o*e.timescale/r}},{key:"moofToSamples",value:function(e,t,r){var i={};return e.mfhd&&(t&&(t.sequenceNumber=e.mfhd.sequenceNumber),r&&(r.sequenceNumber=e.mfhd.sequenceNumber)),e.traf.forEach(function(a){var o=a.tfhd,u=a.tfdt,l=a.trun;if(!(!o||!l)){u&&(t&&t.id===o.trackId&&(t.baseMediaDecodeTime=u.baseMediaDecodeTime),r&&r.id===o.trackId&&(r.baseMediaDecodeTime=u.baseMediaDecodeTime));var f=o.defaultSampleSize||0,c=o.defaultSampleDuration||n.evaluateDefaultDuration(t,r,l.samples.length||l.sampleCount),d=l.dataOffset||0,p=0,_=-1;if(!l.samples.length&&l.sampleCount){i[o.trackId]=[];for(var E=0;E<l.sampleCount;E++)i[o.trackId].push({offset:d,dts:p,duration:c,size:f}),p+=c,d+=f}else i[o.trackId]=l.samples.map(function(g,S){return g={offset:d,dts:p,pts:p+(g.cts||0),duration:g.duration||c,size:g.size||f,gopId:_,keyframe:S===0||g.flags!==null&&g.flags!==void 0&&(g.flags&65536)>>>0!==65536},g.keyframe&&(_++,g.gopId=_),p+=g.duration,d+=g.size,g})}}),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(!(!t||!t.length)){var r=t.find(function(U){var J,v;return((J=U.mdia)===null||J===void 0||(v=J.hdlr)===null||v===void 0?void 0:v.handlerType)==="vide"}),i=t.find(function(U){var J,v;return((J=U.mdia)===null||J===void 0||(v=J.hdlr)===null||v===void 0?void 0:v.handlerType)==="soun"});if(!(!r&&!i)){var a,o;if(r){var u,l,f=(u=r.mdia)===null||u===void 0||(l=u.minf)===null||l===void 0?void 0:l.stbl;if(!f)return;var c=f.stts,d=f.stsc,p=f.stsz,_=f.stco,E=f.stss,g=f.ctts;if(!c||!d||!p||!_||!E)return;a=er(c,d,p,_,g,E)}if(i){var S,R,T,y=(S=i.mdia)===null||S===void 0||(R=S.minf)===null||R===void 0?void 0:R.stbl;if(!y)return;var k=(T=i.mdia.mdhd)===null||T===void 0?void 0:T.timescale,N=y.stts,z=y.stsc,G=y.stsz,K=y.stco;if(!k||!N||!z||!G||!K)return;o=er(N,z,G,K)}return{videoSamples:a,audioSamples:o}}}}}]),n}();function er(n,s,e,t,r,i){var a=[],o=r==null?void 0:r.entries,u=s.entries,l=t.entries,f=e.entrySizes,c=i==null?void 0:i.entries,d;c&&(d={},c.forEach(function(z){d[z-1]=!0}));var p;o&&(p=[],o.forEach(function(z){for(var G=z.count,K=z.offset,U=0;U<G;U++)p.push(K)}));var _,E=-1,g=0,S=0,R=0,T=0,y=0,k=u[0].samplesPerChunk,N=u[1]?u[1].firstChunk-1:1/0;return n.entries.forEach(function(z){for(var G=z.count,K=z.delta,U=0;U<G;U++)_={dts:g,duration:K,size:f[S]||e.sampleSize,offset:l[R]+y,index:S},c&&(_.keyframe=d[S],_.keyframe&&E++,_.gopId=E),p&&S<p.length&&(_.pts=_.dts+p[S]),a.push(_),g+=K,S++,S<k?y+=_.size:(R++,y=0,R>=N&&(T++,N=u[T+1]?u[T+1].firstChunk-1:1/0),k+=u[T].samplesPerChunk)}),a}function tr(n,s){return n.dataReferenceIndex=Y(s,6),n.width=Y(s,24),n.height=Y(s,26),n.horizresolution=O(s,28),n.vertresolution=O(s,32),n.frameCount=Y(s,40),n.depth=Y(s,74),78}function rr(n,s){return n.dataReferenceIndex=Y(s,6),n.channelCount=Y(s,16),n.sampleSize=Y(s,18),n.sampleRate=O(s,24)/65536,28}function F(n,s,e){if(n){if(n.size!==n.data.length)throw new Error("box ".concat(n.type," size !== data.length"));var t={start:n.start,size:n.size,headerSize:n.headerSize,type:n.type};return s&&(t.version=n.data[n.headerSize],t.flags=Di(n.data,n.headerSize+1),t.headerSize+=4),e(t,n.data.subarray(t.headerSize),t.start+t.headerSize),t}}var Ri=function(s,e,t){for(var r=String(t),i=e>>0,a=Math.ceil(i/r.length),o=[],u=String(s);a--;)o.push(r);return o.join("").substring(0,i-u.length)+u},gt=function(){for(var s=[],e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.forEach(function(i){s.push(Ri(Number(i).toString(16),2,0))}),s[0]},Fi=function(){function n(s,e,t){Q(this,n),this.videoTrack=s||new Tt,this.audioTrack=e||new kt,this.metadataTrack=t||new Rt}return $(n,[{key:"demux",value:function(e,t){var r=this.videoTrack,i=this.audioTrack,a=r.exist(),o=i.exist();if(r.samples=[],i.samples=[],t){if(!o){var u=fe.findBox(t,["moov"])[0];if(!u)throw new Error("cannot found moov box");fe.moovToTrack(fe.moov(u),null,i)}var l=fe.findBox(t,["moof"])[0];if(l){var f=fe.moofToSamples(fe.moof(l),null,i)[i.id],c=i.baseMediaDecodeTime;if(f){var d=l.start;f.map(function(y){y.offset+=d;var k=t.subarray(y.offset,y.offset+y.size);i.samples.push(new Ie(y.dts+c,k,y.duration))})}}}if(e){if(!a&&!o){var p=fe.findBox(e,["moov"])[0];if(!p)throw new Error("cannot found moov box");fe.moovToTrack(fe.moov(p),r,i)}var _=fe.findBox(e,["moof"])[0];if(_){var E=fe.moofToSamples(fe.moof(_),r,i),g=r.baseMediaDecodeTime,S=i.baseMediaDecodeTime,R=_.start,T;Object.keys(E).forEach(function(y){r.id==y?E[y].map(function(k){k.offset+=R;var N=new Ot((k.pts||k.dts)+g,k.dts+g);N.duration=k.duration,N.gopId=k.gopId,k.keyframe&&N.setToKeyframe();var z=e.subarray(k.offset,k.offset+k.size);N.data=z;for(var G=0,K=z.length-1;G<K;)T=O(z,G),G+=4,N.units.push(z.subarray(G,G+T)),G+=T;r.samples.push(N)}):i.id==y&&E[y].map(function(k){k.offset+=R;var N=e.subarray(k.offset,k.offset+k.size);i.samples.push(new Ie(k.dts+S,N,k.duration))})})}}return{videoTrack:r,audioTrack:i,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return fe.probe(e)}}]),n}();function Pi(n){for(var s=0,e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];t.forEach(function(o){s+=o.length});var i=new n(s),a=0;return t.forEach(function(o){i.set(o,a),a+=o.length}),i}var ie=function(){function n(){Q(this,n),this.buffer=new Uint8Array(0)}return $(n,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];r.forEach(function(a){a?e.buffer=Pi(Uint8Array,e.buffer,a):window.console.warn(a)})}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,e&255])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255])}}]),n}(),ir=Math.pow(2,32)-1,V=function(){function n(){Q(this,n)}return $(n,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r=r.filter(Boolean);var a=8+r.reduce(function(l,f){return l+f.byteLength},0),o=new Uint8Array(a);o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=a&255,o.set(e,4);var u=8;return r.forEach(function(l){o.set(l,u),u+=l.byteLength}),o}},{key:"ftyp",value:function(e){var t=e.find(function(r){return r.type===Ue.VIDEO&&r.codecType===De.HEVC});return t?n.FTYPHEV1:n.FTYPAVC1}},{key:"initSegment",value:function(e){var t=n.ftyp(e),r=he(t,n.moov(e));return r}},{key:"pssh",value:function(e){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],$t(e.kid),[0,0,0,0]));return n.box(n.types.pssh,t)}},{key:"moov",value:function(e){if(e[0].useEME&&(e[0].encv||e[0].enca)){e[0].pssh||(e[0].pssh={kid:e[0].kid});var t=this.pssh(e[0].pssh);return n.box.apply(n,[n.types.moov,n.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale),n.mvex(e)].concat(ce(e.map(function(r){return n.trak(r)})),[t]))}else return n.box.apply(n,[n.types.moov,n.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale)].concat(ce(e.map(function(r){return n.trak(r)})),[n.mvex(e)]))}},{key:"mvhd",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,r=n.box(n.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return r}},{key:"trak",value:function(e){var t=n.box(n.types.trak,n.tkhd(e.id,e.tkhdDuration||0,e.width,e.height),n.mdia(e));return t}},{key:"tkhd",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=n.box(n.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,i>>8&255,i&255,0,0]));return a}},{key:"mdia",value:function(e){var t=n.box(n.types.mdia,n.mdhd(e.duration,e.timescale),n.hdlr(e.type),n.minf(e));return t}},{key:"mdhd",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,r=n.box(n.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,85,196,0,0]));return r}},{key:"hdlr",value:function(e){var t=n.box(n.types.hdlr,n.HDLR_TYPES[e]);return t}},{key:"minf",value:function(e){var t=n.box(n.types.minf,e.type===Ue.VIDEO?n.VMHD:n.SMHD,n.DINF,n.stbl(e));return t}},{key:"stbl",value:function(e){var t=[];e&&e.ext&&e.ext.stss&&t.push(n.stss(e.ext.stss.entries));var r=n.box(n.types.stbl,n.stsd(e),n.STTS,t[0],n.STSC,n.STSZ,n.STCO);return r}},{key:"stsd",value:function(e){var t;e.type==="audio"?e.useEME&&e.enca?t=n.enca(e):t=n.mp4a(e):e.useEME&&e.encv?t=n.encv(e):t=n.avc1hev1(e);var r=n.box(n.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return r}},{key:"enca",value:function(e){var t=e.enca.channelCount,r=e.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>8&255,r&255,0,0]),a=n.esds(e.config),o=n.sinf(e.enca);return n.box(n.types.enca,i,a,o)}},{key:"encv",value:function(e){var t,r,i=e.sps.length>0?e.sps[0]:[],a=e.pps.length>0?e.pps[0]:[],o=e.width,u=e.height,l=e.sarRatio[0],f=e.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((t=(r=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,i.length&255]).concat.apply(r,ce(i)).concat([1,a.length>>>8&255,a.length&255])).concat.apply(t,ce(a))),p=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),_=n.sinf(e.encv),E=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,f>>24,f>>16&255,f>>8&255,f&255]);return n.box(n.types.encv,c,n.box(n.types.avcC,d),n.box(n.types.btrt,p),_,n.box(n.types.pasp,E))}},{key:"schi",value:function(e){var t=new Uint8Array([]),r=n.tenc(e);return n.box(n.types.schi,t,r)}},{key:"tenc",value:function(e){var t=new Uint8Array([0,0,0,0,0,0,e.default_IsEncrypted&255,e.default_IV_size&255].concat($t(e.default_KID)));return n.box(n.types.tenc,t)}},{key:"sinf",value:function(e){var t=new Uint8Array([]),r=new Uint8Array([e.data_format.charCodeAt(0),e.data_format.charCodeAt(1),e.data_format.charCodeAt(2),e.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=n.schi(e);return n.box(n.types.sinf,t,n.box(n.types.frma,r),n.box(n.types.schm,i),a)}},{key:"avc1hev1",value:function(e){var t=e.codecType===De.HEVC,r=t?n.types.hvc1:n.types.avc1,i=t?n.hvcC(e):n.avcC(e),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,e.width&255,e.height>>8&255,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t?a.push(n.box(n.types.fiel,new Uint8Array([1,0]))):e.sarRatio&&e.sarRatio.length>1&&a.push(n.pasp(e.sarRatio)),n.box.apply(n,[r].concat(a))}},{key:"avcC",value:function(e){var t,r,i=[],a=[],o;return e.sps.forEach(function(u){o=u.byteLength,i.push(o>>>8&255),i.push(o&255),i.push.apply(i,ce(u))}),e.pps.forEach(function(u){o=u.byteLength,a.push(o>>>8&255),a.push(o&255),a.push.apply(a,ce(u))}),n.box(n.types.avcC,new Uint8Array((t=(r=[1,i[3],i[4],i[5],255,224|e.sps.length]).concat.apply(r,i).concat([e.pps.length])).concat.apply(t,a)))}},{key:"hvcC",value:function(e){var t=e.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var r=e.vps,i=e.sps,a=e.pps,o;if(t){var u=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,f=(r.length&&1)+(i.length&&1)+(a.length&&1);o=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,f];var c=function(p){var _;o.push(p.length>>8,p.length),(_=o).push.apply(_,ce(p))};r.length&&(o.push(160,0,r.length),r.forEach(c)),i.length&&(o.push(161,0,i.length),i.forEach(c)),a.length&&(o.push(162,0,a.length),a.forEach(c))}else o=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return n.box(n.types.hvcC,new Uint8Array(o))}},{key:"pasp",value:function(e){var t=li(e,2),r=t[0],i=t[1];return n.box(n.types.pasp,new Uint8Array([r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"mp4a",value:function(e){return n.box(n.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.sampleRate>>8&255,e.sampleRate&255,0,0]),e.config.length?n.esds(e.config):void 0)}},{key:"esds",value:function(e){var t=e.length,r=n.box(n.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(e).concat([6,1,2])));return r}},{key:"mvex",value:function(e){var t=n.box.apply(n,[n.types.mvex].concat(ce(e.map(function(r){return n.trex(r.id)}))));return t}},{key:"trex",value:function(e){var t=n.box(n.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(e){var t=n.box(n.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(e){var t=n.box(n.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(e){var t=n.box.apply(n,[n.types.moof,n.mfhd(e[0].samples?e[0].samples[0].gopId:0)].concat(ce(e.map(function(r){return n.traf(r)}))));return t}},{key:"mfhd",value:function(e){var t=n.box(n.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]));return t}},{key:"traf",value:function(e){var t=n.tfhd(e.id),r=n.tfdt(e,e.baseMediaDecodeTime),i=0,a;if(e.isVideo&&e.videoSenc&&(a=e.videoSenc,a.forEach(function(h){i=i+8,h.subsamples&&h.subsamples.length&&(i=i+2,i=i+h.subsamples.length*6)})),e.videoSencLength=i,!e.useEME||!e.isVideoEncryption&&!e.isAudioEncryption){var o=n.sdtp(e),u=16+20+8+16+8+8;return n.box(n.types.traf,t,r,o,n.trun(e.samples,o.byteLength+u))}else if(e.isVideoEncryption)if(e.isVideo){var l=n.saiz(e),f=n.saio(e),c=n.trun1(e),d=n.senc(e),p=n.box(n.types.traf,t,r,l,f,c,d);return p}else if(e.isAudioEncryption){var g=n.sbgp(),S=n.saiz(e),R=n.saio(e),T=n.senc(e),y=n.trun1(e),k=n.box(n.types.traf,t,r,g,S,R,T,y);return k}else{var _=n.sbgp(),E=n.trun1(e);return n.box(n.types.traf,t,r,_,E)}else if(e.isVideo){var N=n.trun1(e);return n.box(n.types.traf,t,r,N)}else{var z=n.sbgp(),G=n.saiz(e),K=n.saio(e),U=n.senc(e),J=n.trun1(e),v=n.box(n.types.traf,t,r,z,G,K,U,J);return v}}},{key:"sdtp",value:function(e){var t=new ie;return e.samples.forEach(function(r){t.write(new Uint8Array(e.isVideo?[r.keyframe?32:16]:[16]))}),n.box(n.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(e){var t=new ie,r=ie.writeUint32(e.samples.length),i=null;if(e.isVideo){var a=e.videoSencLength;i=ie.writeUint32(e.samples.length*16+a+149),!e.isVideoEncryption&&e.isAudioEncryption&&(i=ie.writeUint32(e.samples.length*16+92))}else{var o=e.samples.length*12+124;e.isAudioEncryption&&(o=e.samples.length*12+8*e.audioSenc.length+177),i=ie.writeUint32(o)}return e.samples.forEach(function(u){t.write(ie.writeUint32(u.duration)),t.write(ie.writeUint32(u.size)),t.write(ie.writeUint32(u.keyframe?33554432:65536)),e.isVideo&&t.write(ie.writeUint32(u.cts?u.cts:0))}),n.box(n.types.trun,this.extension(0,e.flags),r,i,t.buffer)}},{key:"senc",value:function(e){var t=new ie,r=e.samples.length,i=e.isVideo?16:8,a=e.isVideo?2:0,o=[],u=0;return e.isVideo?(o=e.videoSenc,u=e.videoSencLength):o=e.audioSenc,u=u||i*r,t.write(ie.writeUint32(16+u),n.types.senc,this.extension(0,a)),t.write(ie.writeUint32(r)),o.forEach(function(l){for(var f=0;f<l.InitializationVector.length;f++)t.write(new Uint8Array([l.InitializationVector[f]]));l.subsamples&&l.subsamples.length&&(t.write(ie.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(c){t.write(ie.writeUint16(c.BytesOfClearData)),t.write(ie.writeUint32(c.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(e){var t=e.samples.length*12+141;!e.isVideo&&e.isAudioEncryption&&(t=149);var r=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return n.box(n.types.saio,r)}},{key:"saiz",value:function(e){var t=e.samples.length,r=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return n.box(n.types.saiz,r)}},{key:"sbgp",value:function(){var e=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return n.box(n.types.sbgp,this.extension(0,0),e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(e){return n.box(n.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}},{key:"tfdt",value:function(e,t){var r=Math.floor(t/(ir+1)),i=Math.floor(t%(ir+1));return e.useEME&&(e.isVideoEncryption||e.isAudioEncryption)?n.box(n.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])):n.box(n.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"trun",value:function(e,t){var r=e.length,i=12+16*r;t+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var o=0;o<r;o++){var u=e[o],l=u.duration,f=u.size,c=u.flag,d=c===void 0?{}:c,p=u.cts,_=p===void 0?0:p;a.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,d.isLeading<<2|(d.dependsOn===null||d.dependsOn===void 0?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(d.isNonSyncSample===null||d.isNonSyncSample===void 0?1:d.isNonSyncSample),d.degradationPriority&61440,d.degradationPriority&15,_>>>24&255,_>>>16&255,_>>>8&255,_&255],12+16*o)}return n.box(n.types.trun,a)}},{key:"moovMP4",value:function(e){return n.box.apply(n,[n.types.moov,n.mvhd(e[0].duration,e[0].timescale)].concat(ce(e.map(function(t){return n.trackMP4(t)}))))}},{key:"trackMP4",value:function(e){return n.box(n.types.trak,n.tkhd(e.id,e.duration,e.width,e.height),n.mdiaMP4(e))}},{key:"mdiaMP4",value:function(e){return n.box(n.types.mdia,n.mdhd(e.duration,e.timescale),n.hdlr(e.type),n.minfMP4(e))}},{key:"minfMP4",value:function(e){return n.box(n.types.minf,e.type===Ue.VIDEO?n.VMHD:n.SMHD,n.DINF,n.stblMP4(e))}},{key:"stblMP4",value:function(e){var t=e.ext,r=[n.stsd(e),n.stts(t.stts),n.stsc(t.stsc),n.stsz(t.stsz),n.stco(t.stco)];return t.stss.length&&r.push(n.stss(t.stss)),t.ctts.length&&r.push(n.ctts(t.ctts)),n.box.apply(n,[n.types.stbl].concat(r))}},{key:"stts",value:function(e){var t=e.length,r=new Uint8Array(8*t),i=0;return e.forEach(function(a){var o=a.value,u=a.count;r.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),n.box(n.types.stts,he(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"stsc",value:function(e){var t=e.length,r=new Uint8Array(12*t),i=0;return e.forEach(function(a){var o=a.firstChunk,u=a.samplesPerChunk,l=a.sampleDescIndex;r.set([o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255],i),i+=12}),n.box(n.types.stsc,he(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"stsz",value:function(e){var t=e.length,r=new Uint8Array(4*t),i=0;return e.forEach(function(a){r.set([a>>24,a>>16&255,a>>8&255,a&255],i),i+=4}),n.box(n.types.stsz,he(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"stco",value:function(e){var t=e.length,r=new Uint8Array(4*t),i=0;return e.forEach(function(a){r.set([a>>24,a>>16&255,a>>8&255,a&255],i),i+=4}),n.box(n.types.stco,he(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"stss",value:function(e){var t=e.length,r=new Uint8Array(4*t),i=0;return e.forEach(function(a){r.set([a>>24,a>>16&255,a>>8&255,a&255],i),i+=4}),n.box(n.types.stss,he(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"ctts",value:function(e){var t=e.length,r=new Uint8Array(8*t),i=0;return e.forEach(function(a){var o=a.value,u=a.count;r.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),n.box(n.types.ctts,he(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),r))}},{key:"styp",value:function(){return n.box(n.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(e){var t=e.timescale,r=e.samples[0].duration,i=r*e.samples.length,a=e.samples[0].sampleOffset*r,o=8;e.samples.forEach(function(d){o+=d.size});var u=0;if(e.isVideo){var l=0,f;e.videoSenc&&(f=e.videoSenc),e.isVideo&&f.forEach(function(d){l=l+8,d.subsamples&&d.subsamples.length&&(l=l+2,l=l+d.subsamples.length*6)}),e.videoSencLength=l,u=o+141+e.samples.length*16+l,e.useEME&&e.isAudioEncryption&&!e.isVideoEncryption&&(u=o+e.samples.length*16+84)}else u=o+116+e.samples.length*12,e.useEME&&e.isAudioEncryption&&(u=o+169+e.samples.length*12+8*e.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,e.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,a>>24&255,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,1,0,u>>16&255,u>>8&255,u&255,i>>24&255,i>>16&255,i>>8&255,i&255,144,0,0,0]);return n.box(n.types.sidx,c)}},{key:"mdat",value:function(e){var t=n.box(n.types.mdat,e);return t}}]),n}();w(V,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(n,s){return n[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)],n},Object.create(null)));w(V,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});w(V,"FTYPAVC1",V.box(V.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));w(V,"FTYPHEV1",V.box(V.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));w(V,"DINF",V.box(V.types.dinf,V.box(V.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));w(V,"VMHD",V.box(V.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));w(V,"SMHD",V.box(V.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));w(V,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));w(V,"STTS",V.box(V.types.stts,V.StblTable));w(V,"STSC",V.box(V.types.stsc,V.StblTable));w(V,"STSZ",V.box(V.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));w(V,"STCO",V.box(V.types.stco,V.StblTable));var wr=function(){function n(s,e){Q(this,n),this.name=s||"",this._prefix="[".concat(this.name,"]"),n.disabled=e}return $(n,[{key:"debug",value:function(){var e;if(!n.disabled){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).debug.apply(e,[this._prefix].concat(r))}}},{key:"log",value:function(){var e;if(!n.disabled){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).log.apply(e,[this._prefix].concat(r))}}},{key:"warn",value:function(){var e;if(!n.disabled){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).warn.apply(e,[this._prefix].concat(r))}}},{key:"error",value:function(){var e;if(!n.disabled){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];(e=console).error.apply(e,[this._prefix].concat(r))}}},{key:"table",value:function(){var e;n.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}}],[{key:"enable",value:function(){n.disabled=!1}},{key:"disable",value:function(){n.disabled=!0}}]),n}();w(wr,"disabled",!0);var Ci=function(){function n(s,e,t){Q(this,n),this.videoTrack=s,this.audioTrack=e;var r=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=r&&Number(r[1])<50,this.log=new wr("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return $(n,[{key:"remux",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.videoTrack,i=this.audioTrack,a=r.exist(),o=i.exist(),u,l,f,c=[];e&&(t&&t.initMerge?(a&&c.push(this.videoTrack),o&&c.push(this.audioTrack),f=V.initSegment(c)):(a&&(u=V.initSegment([this.videoTrack])),o&&(l=V.initSegment([this.audioTrack]))));var d,p;return a&&r.hasSample()&&(d=this._remuxVideo()),o&&i.hasSample()&&(p=this._remuxAudio()),r.samples=[],i.samples=[],{initSegment:f,videoInitSegment:u,audioInitSegment:l,videoSegment:d,audioSegment:p}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach(function(_){r+=_.units.reduce(function(E,g){return E+g.byteLength},0),r+=_.units.length*4});for(var i=new Uint8Array(r),a=new DataView(i.buffer),o=function(E,g){g=t[u];var S=0;g.units.forEach(function(R){a.setUint32(E,R.byteLength),E+=4,i.set(R,E),E+=R.byteLength,S+=4+R.byteLength}),g.size=S,f=E,c=g},u=0,l=t.length,f=0,c;u<l;u++)o(f,c);var d=V.mdat(i),p=V.moof([e]);return he(p,d)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce(function(a,o){return a+o.size},0));e.samples.reduce(function(a,o){return t.set(o.data,a),a+o.size},0);var r=V.mdat(t),i=V.moof([e]);return he(i,r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),n}(),be=new Te("BufferService"),Li=function(){function n(s,e,t){rt(this,n),M(this,"flv",null),M(this,"_demuxer",new Sr),M(this,"_remuxer",null),M(this,"_mse",null),M(this,"_softVideo",null),M(this,"_sourceCreated",!1),M(this,"_needInitSegment",!0),M(this,"_discontinuity",!0),M(this,"_contiguous",!1),M(this,"_initSegmentId",""),M(this,"_cachedBuffer",null),M(this,"_demuxStartTime",0),M(this,"_opts",null),this.flv=s,this._opts=t,e?this._softVideo=e:(this._remuxer=new Ci(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new nt,this._mse.bindMedia(s.media))}return it(n,[{key:"baseDts",get:function(){var e,t;return(e=this._demuxer)===null||e===void 0||(t=e._fixer)===null||t===void 0?void 0:t._baseDts}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(e){this._contiguous=!1,this._demuxStartTime=e}},{key:"reset",value:function(){var s=ne(q().mark(function t(){var r,i=arguments;return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!r)){o.next=6;break}return o.next=4,this._mse.unbindMedia();case 4:return o.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="";case 11:case"end":return o.stop()}},t,this)}));function e(){return s.apply(this,arguments)}return e}()},{key:"endOfStream",value:function(){var s=ne(q().mark(function t(){return q().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=7;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.flv.emit(L.BUFFEREOS);case 5:i.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return i.stop()}},t,this)}));function e(){return s.apply(this,arguments)}return e}()},{key:"updateDuration",value:function(){var s=ne(q().mark(function t(r){return q().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._mse){a.next=7;break}if(this._mse.isOpened){a.next=4;break}return a.next=4,this._mse.open();case 4:return be.debug("update duration",r),a.next=7,this._mse.updateDuration(r);case 7:case"end":return a.stop()}},t,this)}));function e(t){return s.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var s=ne(q().mark(function t(){return q().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=3;break}return i.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return i.stop()}},t,this)}));function e(){return s.apply(this,arguments)}return e}()},{key:"appendBuffer",value:function(){var s=ne(q().mark(function t(r){var i,a,o,u,l,f,c,d,p,_,E,g,S,R;return q().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this._cachedBuffer&&(r=Jr(this._cachedBuffer,r),this._cachedBuffer=null),i=this._demuxer,!(!r||!r.length||!i)){y.next=4;break}return y.abrupt("return");case 4:y.prev=4,i.demuxAndFix(r,this._discontinuity,this._contiguous,this._demuxStartTime),y.next=11;break;case 8:throw y.prev=8,y.t0=y.catch(4),new Se(X.DEMUX,X.SUB_TYPES.FLV,y.t0);case 11:if(a=i.videoTrack,o=i.audioTrack,u=i.metadataTrack,l=a.exist(),f=o.exist(),this._opts.onlyAudio&&(l=!1,a.present=!1),this._opts.onlyVideo&&(f=!1,o.present=!1),!(!l&&a.present||!f&&o.present)){y.next=29;break}if(c=0,d=l?a:f?o:void 0,d&&d.samples.length&&(c=(d.samples[d.samples.length-1].originPts-d.samples[0].originPts)/d.timescale*1e3),!(c>this._opts.analyzeDuration)){y.next=27;break}be.warn("analyze duration exceeded, ".concat(c,"ms"),d),a.present=l,o.present=f,this.flv.emit(L.ANALYZE_DURATION_EXCEEDED,{duration:c}),y.next=29;break;case 27:return this._cachedBuffer=r,y.abrupt("return");case 29:if(p=a.type,_=o.type,this._fireEvents(a,o,u),this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0,E=this._mse,this.flv.emit(L.DEMUXED_TRACK,{videoTrack:a}),g="".concat(a.codec,"/").concat(a.width,"/").concat(a.height,"/").concat(o.codec,"/").concat(o.config),g!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=g,this._emitMetaParsedEvent(a,o)),!E){y.next=65;break}if(this._sourceCreated){y.next=47;break}return y.next=43,E.open();case 43:l&&(be.log("codec: video/mp4;codecs=".concat(a.codec)),E.createSource(p,"video/mp4;codecs=".concat(a.codec))),f&&(be.log("codec: audio/mp4;codecs=".concat(o.codec)),E.createSource(_,"audio/mp4;codecs=".concat(o.codec))),this._sourceCreated=!0,this.flv.emit(L.SOURCEBUFFER_CREATED);case 47:y.prev=47,S=this._remuxer.remux(this._needInitSegment),y.next=54;break;case 51:throw y.prev=51,y.t1=y.catch(47),new Se(X.REMUX,X.SUB_TYPES.FMP4,y.t1);case 54:if(!(this._needInitSegment&&!S.videoInitSegment&&!S.audioInitSegment)){y.next=56;break}return y.abrupt("return");case 56:return this._needInitSegment=!1,R=[],S.videoInitSegment&&R.push(E.append(p,S.videoInitSegment)),S.audioInitSegment&&R.push(E.append(_,S.audioInitSegment)),S.videoSegment&&R.push(E.append(p,S.videoSegment)),S.audioSegment&&R.push(E.append(_,S.audioSegment)),y.abrupt("return",Promise.all(R));case 65:this._softVideo&&this._softVideo.appendBuffer(a,o);case 66:case"end":return y.stop()}},t,this,[[4,8],[47,51]])}));function e(t){return s.apply(this,arguments)}return e}()},{key:"evictBuffer",value:function(){var s=ne(q().mark(function t(r){var i=this,a,o,u,l;return q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=this.flv.media,!(!this._mse||!this._demuxer||!a||!r||r<0)){c.next=3;break}return c.abrupt("return");case 3:if(o=a.currentTime,u=o-r,!(u<=0)){c.next=7;break}return c.abrupt("return");case 7:if(l=se.start(se.get(a)),!(l+1>=u)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this._mse.clearBuffer(0,u).then(function(){return i.flv.emit(L.REMOVE_BUFFER,{removeEnd:u})}));case 11:case"end":return c.stop()}},t,this)}));function e(t){return s.apply(this,arguments)}return e}()},{key:"_emitMetaParsedEvent",value:function(e,t){e.exist()&&this.flv.emit(L.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.flv.emit(L.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),be.debug("track parsed",e,t)}},{key:"_fireEvents",value:function(e,t,r){var i=this;be.debug(e.samples,t.samples),r.flvScriptSamples.forEach(function(a){i.flv.emit(L.FLV_SCRIPT_DATA,a),be.debug("flvScriptData",a)}),e.samples.forEach(function(a){a.keyframe&&i.flv.emit(L.KEYFRAME,{pts:a.pts})}),e.warnings.forEach(function(a){var o;switch(a.type){case re.LARGE_AV_SHIFT:o=L.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case re.LARGE_VIDEO_GAP:o=L.LARGE_VIDEO_DTS_GAP_DETECT;break;case re.LARGE_VIDEO_GAP_BETWEEN_CHUNK:o=L.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}o&&i.flv.emit(L.STREAM_EXCEPTION,ae(ae({},a),{},{type:o})),be.warn("video exception",a)}),t.warnings.forEach(function(a){var o;switch(a.type){case re.LARGE_AUDIO_GAP:o=L.LARGE_AUDIO_DTS_GAP_DETECT;break;case re.AUDIO_FILLED:o=L.AUDIO_GAP_DETECT;break;case re.AUDIO_DROPPED:o=L.AUDIO_OVERLAP_DETECT;break}o&&i.flv.emit(L.STREAM_EXCEPTION,ae(ae({},a),{},{type:o})),be.warn("audio exception",a)}),r.seiSamples.forEach(function(a){i.flv.emit(L.SEI,ae(ae({},a),{},{sei:{code:a.data.type,content:a.data.payload,dts:a.pts}}))})}}]),n}();function Ii(n){var s=ae({retryCount:3,retryDelay:1e3,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1},n);return s.isLive&&s.preloadTime&&(s.maxLatency||(s.maxLatency=s.preloadTime*2),s.targetLatency||(s.targetLatency=s.preloadTime),(s.disconnectTime===null||s.disconnectTime===void 0)&&(s.disconnectTime=s.maxLatency)),s}function xi(n,s){var e=0,t=n.length-1,r=0,i=0,a=t;for(s<n[0]&&(e=0,i=a+1);i<=a;)if(r=i+Math.floor((a-i)/2),r===t||s>=n[r]&&s<n[r+1]){e=r;break}else n[r]<s?i=r+1:a=r-1;return e}var Ee=new Te("flv"),He=function(n){nr(e,n);var s=ar(e);function e(t){var r;return rt(this,e),r=s.call(this),M(W(r),"media",null),M(W(r),"_loading",!1),M(W(r),"_opts",null),M(W(r),"_bufferService",null),M(W(r),"_gapService",null),M(W(r),"_stats",null),M(W(r),"_mediaLoader",null),M(W(r),"_maxChunkWaitTimer",null),M(W(r),"_tickTimer",null),M(W(r),"_tickInterval",500),M(W(r),"_urlSwitching",!1),M(W(r),"_seamlessSwitching",!1),M(W(r),"_keyframes",null),M(W(r),"_acceptRanges",!0),M(W(r),"_onProgress",function(){var i=ne(q().mark(function a(o,u,l,f){var c,d,p,_,E,g,S,R;return q().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(c=l.startTime,d=l.endTime,p=l.st,_=l.firstByteTime,r._loading=!u,r._firstProgressEmit){y.next=11;break}if(r.media){y.next=6;break}return(E=r._mediaLoader)===null||E===void 0||E.cancel(),y.abrupt("return");case 6:g=f.headers,r.emit(L.TTFB,{url:r._opts.url,responseUrl:f.url,elapsed:p?_-p:d-c}),r.emit(L.LOAD_RESPONSE_HEADERS,{headers:g}),r._acceptRanges=!!(g!=null&&g.get("Accept-Ranges"))||!!(g!=null&&g.get("Content-Range")),r._firstProgressEmit=!0;case 11:if(r._bufferService){y.next=13;break}return y.abrupt("return");case 13:return clearTimeout(r._maxChunkWaitTimer),r._bandwidthService.addChunkRecord(o==null?void 0:o.byteLength,d-c),y.prev=15,y.next=18,r._bufferService.appendBuffer(o);case 18:r.isLive&&((S=r._bufferService)===null||S===void 0||S.evictBuffer(r._opts.bufferBehind)),y.next=24;break;case 21:return y.prev=21,y.t0=y.catch(15),y.abrupt("return",r._emitError(Se.create(y.t0)));case 24:if(r._urlSwitching&&(r._urlSwitching=!1,r.emit(L.SWITCH_URL_SUCCESS,{url:r._opts.url})),r._seamlessSwitching&&(r._seamlessSwitching=!1,r._tick()),!(u&&!r.media.seeking)){y.next=32;break}return r.emit(L.LOAD_COMPLETE),Ee.debug("load done"),y.abrupt("return",r._end());case 32:R=r._opts.maxReaderInterval,R&&(clearTimeout(r._maxChunkWaitTimer),r._maxChunkWaitTimer=setTimeout(function(){Ee.debug("onMaxChunkWait",R),r._end()},R));case 34:case"end":return y.stop()}},a,null,[[15,21]])}));return function(a,o,u,l){return i.apply(this,arguments)}}()),M(W(r),"_onRetryError",function(i,a){Ee.debug("load retry",i,a),r.emit(L.LOAD_RETRY,{error:Se.network(i),retryTime:a})}),M(W(r),"_end",function(){r._clear(),r._bufferService&&r._bufferService.endOfStream(),Ee.debug("end stream")}),M(W(r),"_tick",function(){clearTimeout(r._tickTimer);var i=W(r),a=i.media;if(a){r._tickTimer=setTimeout(r._tick,r._tickInterval);var o=se.end(se.get(a));if(!(o<.1||!a.readyState)){var u=r._opts;if(Qr(a))r._gapService&&r._gapService.do(a,u.maxJumpDistance,r.isLive,3);else{if(!a.currentTime&&r._gapService){r._gapService.do(a,u.maxJumpDistance,r.isLive,3);return}u.isLive&&o>u.disconnectTime&&r.disconnect()}}}}),M(W(r),"_onPlay",function(){var i,a,o=r._opts.softDecode||((i=r.media)===null||i===void 0||(a=i.buffered)===null||a===void 0?void 0:a.length);r.isLive&&!r._loading&&o&&r.replay(void 0,!0)}),M(W(r),"_onSeeking",ne(q().mark(function i(){var a,o,u,l,f;return q().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(!r.isLive&&r.seekable)){d.next=14;break}if(a=r._keyframes.times,o=r._keyframes.filepositions,!(!(a!=null&&a.length)||!(o!=null&&o.length))){d.next=5;break}return d.abrupt("return");case 5:if(u=r.media.currentTime,l=xi(r._keyframes.times,u),f=o[l],f!=null){d.next=10;break}return d.abrupt("return");case 10:return d.next=12,r._mediaLoader.cancel();case 12:r._loadData(null,[f]),r._bufferService.unContiguous(a[l]);case 14:case"end":return d.stop()}},i)}))),M(W(r),"_onTimeupdate",function(){if(r.media){var i=r._opts,a=r.media.currentTime;if(i.isLive&&i.maxLatency&&i.targetLatency){var o=se.end(se.get(r.media)),u=o-a;u>=i.maxLatency&&(r.media.currentTime=o-i.targetLatency)}r._seiService.throw(a)}}),M(W(r),"_onFlvScriptData",function(i){var a,o,u,l,f=(a=i.data)===null||a===void 0||(o=a.onMetaData)===null||o===void 0?void 0:o.keyframes,c=(u=i.data)===null||u===void 0||(l=u.onMetaData)===null||l===void 0?void 0:l.duration;f&&(r._keyframes=f),!r._opts.isLive&&c&&r._bufferService.updateDuration(c)}),r._opts=Ii(t),r.media=r._opts.media||document.createElement("video"),r._opts.media=null,r._firstProgressEmit=!1,r._mediaLoader=new ei(ae(ae({},r._opts.fetchOptions),{},{retry:r._opts.retryCount,retryDelay:r._opts.retryDelay,timeout:r._opts.loadTimeout,onRetryError:r._onRetryError,onProgress:r._onProgress,responseType:"arraybuffer"})),r._bufferService=new Li(W(r),r._opts.softDecode?r.media:void 0,r._opts),r._seiService=new ri(W(r)),r._bandwidthService=new ii,r._stats=new ni(W(r)),r._opts.softDecode||(r._gapService=new ti),r.media.addEventListener("play",r._onPlay),r.media.addEventListener("seeking",r._onSeeking),r.media.addEventListener("timeupdate",r._onTimeupdate),r.on(L.FLV_SCRIPT_DATA,r._onFlvScriptData),r}return it(e,[{key:"version",get:function(){return"3.0.5"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var r;return(r=this._bufferService)===null||r===void 0?void 0:r.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return se.info(se.get(this.media),(r=this.media)===null||r===void 0?void 0:r.currentTime,i)}},{key:"playbackQuality",value:function(){return $r(this.media)}},{key:"load",value:function(){var t=ne(q().mark(function i(a){var o,u=arguments;return q().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(o=u.length>1&&u[1]!==void 0?u[1]:!1,this._bufferService){f.next=3;break}return f.abrupt("return");case 3:return f.next=5,this._reset(o);case 5:this._loadData(a),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return f.stop()}},i,this)}));function r(i){return t.apply(this,arguments)}return r}()},{key:"replay",value:function(){var t=ne(q().mark(function i(){var a=this,o,u,l=arguments;return q().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o=l.length>0&&l[0]!==void 0?l[0]:this._opts.seamlesslyReload,u=l.length>1?l[1]:void 0,this.media){c.next=4;break}return c.abrupt("return");case 4:if(!o){c.next=10;break}return c.next=7,this._clear();case 7:setTimeout(function(){a._loadData(a._opts.url),a._bufferService.seamlessSwitch(),a._seamlessSwitching=!0}),c.next=12;break;case 10:return c.next=12,this.load();case 12:return c.abrupt("return",this.media.play(!u).catch(function(){}));case 13:case"end":return c.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"disconnect",value:function(){return Ee.debug("disconnect!"),this._clear()}},{key:"switchURL",value:function(){var t=ne(q().mark(function i(a,o){var u=this;return q().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this._bufferService){f.next=2;break}return f.abrupt("return");case 2:if(!(!o||!this._opts.isLive)){f.next=7;break}return f.next=5,this.load(a);case 5:return this._urlSwitching=!0,f.abrupt("return",this.media.play(!0).catch(function(){}));case 7:return f.next=9,this._clear();case 9:setTimeout(function(){u._loadData(a),u._bufferService.seamlessSwitch(),u._urlSwitching=!0,u._seamlessSwitching=!0});case 10:case"end":return f.stop()}},i,this)}));function r(i,a){return t.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var t=ne(q().mark(function i(){return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.media){o.next=2;break}return o.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),o.next=9,Promise.all([this._clear(),this._bufferService.destroy()]);case 9:this.media=null,this._bufferService=null;case 11:case"end":return o.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"_emitError",value:function(r){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Ee.table(r),Ee.error(r),Ee.error((i=this.media)===null||i===void 0?void 0:i.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(L.SWITCH_URL_FAILED,r)),this.emit(L.ERROR,r),a&&(this._seiService.reset(),this._end())}},{key:"_reset",value:function(){var t=ne(q().mark(function i(){var a,o=arguments;return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=o.length>0&&o[0]!==void 0?o[0]:!1,this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),l.next=6,this._clear();case 6:return l.next=8,this._bufferService.reset(a);case 8:this._firstProgressEmit=!1;case 9:case"end":return l.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"_loadData",value:function(){var t=ne(q().mark(function i(a,o){return q().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(a&&(this._opts.url=a),a=this._opts.url,a){l.next=4;break}throw new Error("Source url is missing");case 4:if(this.emit(L.LOAD_START,{url:a}),Ee.debug("load data, loading:",this._loading,a),!this._loading){l.next=9;break}return l.next=9,this._mediaLoader.cancel();case 9:return this._loading=!0,l.prev=10,l.next=13,this._mediaLoader.load({url:a,range:o});case 13:l.next=18;break;case 15:return l.prev=15,l.t0=l.catch(10),l.abrupt("return",this._emitError(Se.network(l.t0)));case 18:case"end":return l.stop()}},i,this,[[10,15]])}));function r(i,a){return t.apply(this,arguments)}return r}()},{key:"_clear",value:function(){var t=ne(q().mark(function i(){return q().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),!this._mediaLoader){o.next=5;break}return o.next=5,this._mediaLoader.cancel();case 5:this._loading=!1;case 6:case"end":return o.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()}],[{key:"isSupported",value:function(r){return!r||r==="video"||r==="audio"?nt.isSupported():typeof WebAssembly!="undefined"}},{key:"enableLogger",value:function(){Te.enable(),je.enable()}},{key:"disableLogger",value:function(){Te.disable(),je.disable()}}]),e}(tt);try{localStorage.getItem("xgd")?He.enableLogger():He.disableLogger()}catch(n){}var Bi=function(){function n(s,e){var t=this;rt(this,n),M(this,"_onLowDecode",function(){var r,i,a,o,u=t._opts,l=u.media,f=u.innerDegrade,c=u.backupURL;(r=t._plugin)===null||r===void 0||(i=r.player)===null||i===void 0||i.emit("lowdecode",l.degradeInfo),(a=t._plugin)===null||a===void 0||(o=a.player)===null||o===void 0||o.emit("core_event",ae(ae({},l.degradeInfo),{},{eventName:L.LOWDECODE})),(f===1||f===3)&&c&&t._degrade(c)}),M(this,"_degrade",function(r){var i=t._plugin.player,a=i.video;if((a==null?void 0:a.TAG)==="MVideo"){var o=i.video.degradeVideo;i.video=o,a.degrade(r),r&&(i.config.url=r);var u=i.root.firstChild;u.TAG==="MVideo"&&i.root.replaceChild(o,u);var l=t._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(l),i.once("canplay",function(){i.play()})}}),M(this,"forceDegradeToVideo",function(r){var i=t._opts.innerDegrade;(i===1||i===3)&&t._degrade(r)}),this._opts=s,this._plugin=e,this._init()}return it(n,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,i=e.innerDegrade,a=e.decodeMode;t&&(i&&t.setAttribute("innerdegrade",i),r&&t.setAttribute("preloadtime",r),t.setDecodeMode&&t.setDecodeMode(a),this._bindEvents())}},{key:"_bindEvents",value:function(){var e=this._opts.media;e.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;(e=this._opts)===null||e===void 0||(t=e.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),n}(),Mi=function(n){nr(e,n);var s=ar(e);function e(){var t;rt(this,e);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=s.call.apply(s,[this].concat(i)),M(W(t),"flv",null),M(W(t),"pluginExtension",null),M(W(t),"getStats",function(){var o;return(o=t.flv)===null||o===void 0?void 0:o.getStats()}),M(W(t),"destroy",function(){var o;t.flv&&(t.flv.destroy(),t.flv=null),(o=t.pluginExtension)===null||o===void 0||o.destroy(),t.pluginExtension=null}),M(W(t),"_onSwitchURL",function(o,u){if(t.flv){var l,f;t.player.config.url=o,t.flv.switchURL(o,u),!u&&(l=t.player.config)!==null&&l!==void 0&&(f=l.flv)!==null&&f!==void 0&&f.keepStatusAfterSwitch&&t._keepPauseStatus()}}),M(W(t),"_keepPauseStatus",function(){var o=t.player.paused;o&&t.player.once("canplay",function(){t.player.pause()})}),M(W(t),"_onDefinitionChange",function(o){var u=o.to;t.flv&&t.flv.switchURL(u)}),t}return it(e,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var r;return(r=this.flv)===null||r===void 0?void 0:r.version}},{key:"softDecode",get:function(){var r,i,a=(r=this.player)===null||r===void 0||(i=r.config)===null||i===void 0?void 0:i.mediaType;return!!a&&a!=="video"&&a!=="audio"}},{key:"beforePlayerInit",value:function(){var r=this,i=this.player.config;if(i.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var a=i.flv||{};if((a.disconnectTime===null||a.disconnectTime===void 0)&&(a.disconnectTime=0),this.flv=new He(ae({softDecode:this.softDecode,isLive:i.isLive,media:this.player.video},a)),this.softDecode||xt.defineGetterOrSetter(this.player,{url:{get:function(){var l,f;return(l=r.flv)===null||l===void 0||(f=l.media)===null||f===void 0?void 0:f.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Bi(ae({media:this.player.video},i.flv),this),this.player.forceDegradeToVideo=function(){for(var u,l=arguments.length,f=new Array(l),c=0;c<l;c++)f[c]=arguments[c];return(u=r.pluginExtension)===null||u===void 0?void 0:u.forceDegradeToVideo.apply(u,f)}),i.isLive){var o;(o=this.player)===null||o===void 0||o.useHooks("replay",function(){var u;return(u=r.flv)===null||u===void 0?void 0:u.replay()})}this.on(Dr,this._onSwitchURL),this.on(Ar,this.destroy),this._transError(),this._transCoreEvent(L.TTFB),this._transCoreEvent(L.LOAD_START),this._transCoreEvent(L.LOAD_RESPONSE_HEADERS),this._transCoreEvent(L.LOAD_COMPLETE),this._transCoreEvent(L.LOAD_RETRY),this._transCoreEvent(L.SOURCEBUFFER_CREATED),this._transCoreEvent(L.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(L.REMOVE_BUFFER),this._transCoreEvent(L.BUFFEREOS),this._transCoreEvent(L.KEYFRAME),this._transCoreEvent(L.METADATA_PARSED),this._transCoreEvent(L.SEI),this._transCoreEvent(L.SEI_IN_TIME),this._transCoreEvent(L.FLV_SCRIPT_DATA),this._transCoreEvent(L.STREAM_EXCEPTION),this._transCoreEvent(L.SWITCH_URL_SUCCESS),this._transCoreEvent(L.SWITCH_URL_FAILED),this.flv.load(i.url,!0)}}},{key:"_transError",value:function(){var r=this;this.flv.on(L.ERROR,function(i){r.player&&r.player.emit(Tr,new kr(r.player,i))})}},{key:"_transCoreEvent",value:function(r){var i=this;this.flv.on(r,function(a){i.player&&i.player.emit("core_event",ae(ae({},a),{},{eventName:r}))})}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(r,i){return He.isSupported(r,i)}}]),e}(xt);M(Mi,"Flv",He);export{se as B,L as E,Fi as F,ti as G,Te as L,fe as M,ei as N,Se as S,Ni as T,re as W,X as a,Ci as b,Jr as c,nt as d,ii as e,ri as f,ni as g,je as h,Qr as i,$r as j,Mi as k};

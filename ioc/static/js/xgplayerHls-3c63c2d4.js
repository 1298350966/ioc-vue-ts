import{E as Be,B as _e,S as Ne,U as $e,D as Ve,a as Ge,b as Fe}from"./xgplayer-65a6fa30.js";import{c as le,E as O,L as ae,S as G,a as W,W as x,F as He,T as Oe,b as je,M as ee,d as Y,B as Q,N as te,e as Ye,i as We,f as Xe,G as Ke,g as ze,h as be,j as Qe}from"./xgplayerFlv-70569a71.js";function qe(l,s){var t=l==null?null:typeof Symbol!="undefined"&&l[Symbol.iterator]||l["@@iterator"];if(t!=null){var r,e,i,a,n=[],u=!0,h=!1;try{if(i=(t=t.call(l)).next,s===0){if(Object(t)!==t)return;u=!1}else for(;!(u=(r=i.call(t)).done)&&(n.push(r.value),n.length!==s);u=!0);}catch(o){h=!0,e=o}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw e}}return n}}function Ee(l,s){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(l);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})),t.push.apply(t,r)}return t}function U(l){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?Ee(Object(t),!0).forEach(function(r){c(l,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Ee(Object(t)).forEach(function(r){Object.defineProperty(l,r,Object.getOwnPropertyDescriptor(t,r))})}return l}function b(){b=function(){return l};var l={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(g,p,S){g[p]=S.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",a=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function u(g,p,S){return Object.defineProperty(g,p,{value:S,enumerable:!0,configurable:!0,writable:!0}),g[p]}try{u({},"")}catch(g){u=function(p,S,L){return p[S]=L}}function h(g,p,S,L){var w=p&&p.prototype instanceof v?p:v,C=Object.create(w.prototype),N=new B(L||[]);return r(C,"_invoke",{value:T(g,S,N)}),C}function o(g,p,S){try{return{type:"normal",arg:g.call(p,S)}}catch(L){return{type:"throw",arg:L}}}l.wrap=h;var d={};function v(){}function m(){}function f(){}var y={};u(y,i,function(){return this});var _=Object.getPrototypeOf,E=_&&_(_(z([])));E&&E!==s&&t.call(E,i)&&(y=E);var k=f.prototype=v.prototype=Object.create(y);function M(g){["next","throw","return"].forEach(function(p){u(g,p,function(S){return this._invoke(p,S)})})}function P(g,p){function S(w,C,N,H){var j=o(g[w],g,C);if(j.type!=="throw"){var Z=j.arg,ie=Z.value;return ie&&typeof ie=="object"&&t.call(ie,"__await")?p.resolve(ie.__await).then(function(q){S("next",q,N,H)},function(q){S("throw",q,N,H)}):p.resolve(ie).then(function(q){Z.value=q,N(Z)},function(q){return S("throw",q,N,H)})}H(j.arg)}var L;r(this,"_invoke",{value:function(w,C){function N(){return new p(function(H,j){S(w,C,H,j)})}return L=L?L.then(N,N):N()}})}function T(g,p,S){var L="suspendedStart";return function(w,C){if(L==="executing")throw new Error("Generator is already running");if(L==="completed"){if(w==="throw")throw C;return se()}for(S.method=w,S.arg=C;;){var N=S.delegate;if(N){var H=D(N,S);if(H){if(H===d)continue;return H}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(L==="suspendedStart")throw L="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);L="executing";var j=o(g,p,S);if(j.type==="normal"){if(L=S.done?"completed":"suspendedYield",j.arg===d)continue;return{value:j.arg,done:S.done}}j.type==="throw"&&(L="completed",S.method="throw",S.arg=j.arg)}}}function D(g,p){var S=p.method,L=g.iterator[S];if(L===void 0)return p.delegate=null,S==="throw"&&g.iterator.return&&(p.method="return",p.arg=void 0,D(g,p),p.method==="throw")||S!=="return"&&(p.method="throw",p.arg=new TypeError("The iterator does not provide a '"+S+"' method")),d;var w=o(L,g.iterator,p.arg);if(w.type==="throw")return p.method="throw",p.arg=w.arg,p.delegate=null,d;var C=w.arg;return C?C.done?(p[g.resultName]=C.value,p.next=g.nextLoc,p.method!=="return"&&(p.method="next",p.arg=void 0),p.delegate=null,d):C:(p.method="throw",p.arg=new TypeError("iterator result is not an object"),p.delegate=null,d)}function K(g){var p={tryLoc:g[0]};1 in g&&(p.catchLoc=g[1]),2 in g&&(p.finallyLoc=g[2],p.afterLoc=g[3]),this.tryEntries.push(p)}function F(g){var p=g.completion||{};p.type="normal",delete p.arg,g.completion=p}function B(g){this.tryEntries=[{tryLoc:"root"}],g.forEach(K,this),this.reset(!0)}function z(g){if(g){var p=g[i];if(p)return p.call(g);if(typeof g.next=="function")return g;if(!isNaN(g.length)){var S=-1,L=function w(){for(;++S<g.length;)if(t.call(g,S))return w.value=g[S],w.done=!1,w;return w.value=void 0,w.done=!0,w};return L.next=L}}return{next:se}}function se(){return{value:void 0,done:!0}}return m.prototype=f,r(k,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:m,configurable:!0}),m.displayName=u(f,n,"GeneratorFunction"),l.isGeneratorFunction=function(g){var p=typeof g=="function"&&g.constructor;return!!p&&(p===m||(p.displayName||p.name)==="GeneratorFunction")},l.mark=function(g){return Object.setPrototypeOf?Object.setPrototypeOf(g,f):(g.__proto__=f,u(g,n,"GeneratorFunction")),g.prototype=Object.create(k),g},l.awrap=function(g){return{__await:g}},M(P.prototype),u(P.prototype,a,function(){return this}),l.AsyncIterator=P,l.async=function(g,p,S,L,w){w===void 0&&(w=Promise);var C=new P(h(g,p,S,L),w);return l.isGeneratorFunction(p)?C:C.next().then(function(N){return N.done?N.value:C.next()})},M(k),u(k,n,"Generator"),u(k,i,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),l.keys=function(g){var p=Object(g),S=[];for(var L in p)S.push(L);return S.reverse(),function w(){for(;S.length;){var C=S.pop();if(C in p)return w.value=C,w.done=!1,w}return w.done=!0,w}},l.values=z,B.prototype={constructor:B,reset:function(g){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(F),!g)for(var p in this)p.charAt(0)==="t"&&t.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=void 0)},stop:function(){this.done=!0;var g=this.tryEntries[0].completion;if(g.type==="throw")throw g.arg;return this.rval},dispatchException:function(g){if(this.done)throw g;var p=this;function S(j,Z){return C.type="throw",C.arg=g,p.next=j,Z&&(p.method="next",p.arg=void 0),!!Z}for(var L=this.tryEntries.length-1;L>=0;--L){var w=this.tryEntries[L],C=w.completion;if(w.tryLoc==="root")return S("end");if(w.tryLoc<=this.prev){var N=t.call(w,"catchLoc"),H=t.call(w,"finallyLoc");if(N&&H){if(this.prev<w.catchLoc)return S(w.catchLoc,!0);if(this.prev<w.finallyLoc)return S(w.finallyLoc)}else if(N){if(this.prev<w.catchLoc)return S(w.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<w.finallyLoc)return S(w.finallyLoc)}}}},abrupt:function(g,p){for(var S=this.tryEntries.length-1;S>=0;--S){var L=this.tryEntries[S];if(L.tryLoc<=this.prev&&t.call(L,"finallyLoc")&&this.prev<L.finallyLoc){var w=L;break}}w&&(g==="break"||g==="continue")&&w.tryLoc<=p&&p<=w.finallyLoc&&(w=null);var C=w?w.completion:{};return C.type=g,C.arg=p,w?(this.method="next",this.next=w.finallyLoc,d):this.complete(C)},complete:function(g,p){if(g.type==="throw")throw g.arg;return g.type==="break"||g.type==="continue"?this.next=g.arg:g.type==="return"?(this.rval=this.arg=g.arg,this.method="return",this.next="end"):g.type==="normal"&&p&&(this.next=p),d},finish:function(g){for(var p=this.tryEntries.length-1;p>=0;--p){var S=this.tryEntries[p];if(S.finallyLoc===g)return this.complete(S.completion,S.afterLoc),F(S),d}},catch:function(g){for(var p=this.tryEntries.length-1;p>=0;--p){var S=this.tryEntries[p];if(S.tryLoc===g){var L=S.completion;if(L.type==="throw"){var w=L.arg;F(S)}return w}}throw new Error("illegal catch attempt")},delegateYield:function(g,p,S){return this.delegate={iterator:z(g),resultName:p,nextLoc:S},this.method==="next"&&(this.arg=void 0),d}},l}function oe(l){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},oe(l)}function we(l,s,t,r,e,i,a){try{var n=l[i](a),u=n.value}catch(h){t(h);return}n.done?s(u):Promise.resolve(u).then(r,e)}function R(l){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=l.apply(s,t);function a(u){we(i,r,e,a,n,"next",u)}function n(u){we(i,r,e,a,n,"throw",u)}a(void 0)})}}function $(l,s){if(!(l instanceof s))throw new TypeError("Cannot call a class as a function")}function ke(l,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(l,Pe(r.key),r)}}function V(l,s,t){return s&&ke(l.prototype,s),t&&ke(l,t),Object.defineProperty(l,"prototype",{writable:!1}),l}function c(l,s,t){return s=Pe(s),s in l?Object.defineProperty(l,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[s]=t,l}function fe(l,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(s&&s.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),s&&ge(l,s)}function he(l){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},he(l)}function ge(l,s){return ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ge(l,s)}function Je(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(l){return!1}}function A(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function Ze(l,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A(l)}function de(l){var s=Je();return function(){var r=he(l),e;if(s){var i=he(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Ze(this,e)}}function X(l,s){return tt(l)||qe(l,s)||Ie(l,s)||nt()}function xe(l){return et(l)||rt(l)||Ie(l)||it()}function et(l){if(Array.isArray(l))return ye(l)}function tt(l){if(Array.isArray(l))return l}function rt(l){if(typeof Symbol!="undefined"&&l[Symbol.iterator]!=null||l["@@iterator"]!=null)return Array.from(l)}function Ie(l,s){if(l){if(typeof l=="string")return ye(l,s);var t=Object.prototype.toString.call(l).slice(8,-1);if(t==="Object"&&l.constructor&&(t=l.constructor.name),t==="Map"||t==="Set")return Array.from(l);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ye(l,s)}}function ye(l,s){(s==null||s>l.length)&&(s=l.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=l[t];return r}function it(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function at(l,s){if(typeof l!="object"||l===null)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var r=t.call(l,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(l)}function Pe(l){var s=at(l,"string");return typeof s=="symbol"?s:String(s)}var st=function(){function l(){$(this,l);var s=window.crypto||window.msCrypto;this.subtle=s&&(s.subtle||s.webkitSubtle),this.externalDecryptor=null}return V(l,[{key:"destroy",value:function(){var t;(t=this.externalDecryptor)!==null&&t!==void 0&&t.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(t,r){if(!(!t&&!r)){var e=[];return t&&(e[0]=this._decryptSegment(t)),r&&(e[1]=this._decryptSegment(r)),Promise.all(e)}}},{key:"_decryptSegment",value:function(){var s=R(b().mark(function r(e){var i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.data,!e.key){n.next=5;break}return n.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:i=n.sent;case 5:if(e.map){n.next=7;break}return n.abrupt("return",i);case 7:return n.abrupt("return",le(e.map,i));case 8:case"end":return n.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"_decryptData",value:function(){var s=R(b().mark(function r(e,i,a){var n;return b().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!this.externalDecryptor){h.next=6;break}return h.next=3,this.externalDecryptor.decrypt(e,i,a);case 3:return h.abrupt("return",h.sent);case 6:if(this.subtle){h.next=8;break}throw new Error("crypto is not defined");case 8:return h.next=10,this.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return n=h.sent,h.t0=Uint8Array,h.next=14,this.subtle.decrypt({name:"AES-CBC",iv:a},n,e);case 14:return h.t1=h.sent,h.abrupt("return",new h.t0(h.t1));case 16:case"end":return h.stop()}},r,this)}));function t(r,e,i){return s.apply(this,arguments)}return t}()}]),l}(),I=U(U({},O),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime"}),ue=new ae("Transmuxer"),Te=function(){function l(s,t,r){$(this,l),c(this,"_initSegmentId",""),this.hls=s,this._demuxer=t?new He:new Oe,this._isMP4=t,r&&(this._remuxer=new je(this._demuxer.videoTrack,this._demuxer.audioTrack))}return V(l,[{key:"transmux",value:function(t,r,e,i,a,n){var u=this._demuxer;try{this._isMP4?u.demux(t,r):u.demuxAndFix(le(t,r),e,i,a)}catch(P){throw new G(W.DEMUX,W.SUB_TYPES.HLS,P)}var h=u.videoTrack,o=u.audioTrack,d=u.metadataTrack,v="".concat(h.codec,"/").concat(h.width,"/").concat(h.height,"/").concat(o.codec,"/").concat(o.config);if(v!==this._initSegmentId&&(this._initSegmentId=v,n=!0),this._fireEvents(h,o,d,e||n),this.hls.emit(I.DEMUXED_TRACK,{videoTrack:h,audioTrack:o}),this._remuxer)try{var m=this._remuxer.remux(n),f=m.videoInitSegment,y=m.videoSegment,_=m.audioInitSegment,E=m.audioSegment,k=le(f,y),M=le(_,E);return[k?{codec:h.codec,data:k}:void 0,M?{codec:o.codec,data:M}:void 0]}catch(P){throw new G(W.REMUX,W.SUB_TYPES.FMP4,P)}else return[h,o]}},{key:"_fireEvents",value:function(t,r,e,i){var a=this;ue.debug(t.samples,r.samples),i&&(t.exist()&&this.hls.emit(I.METADATA_PARSED,{type:"video",track:t,meta:{codec:t.codec,timescale:t.timescale,width:t.width,height:t.height,sarRatio:t.sarRatio,baseDts:t.baseDts}}),r.exist()&&this.hls.emit(I.METADATA_PARSED,{type:"audio",track:r,meta:{codec:r.codec,channelCount:r.channelCount,sampleRate:r.sampleRate,timescale:r.timescale,baseDts:r.baseDts}}),ue.debug("discontinuity",t,r)),t.warnings.forEach(function(n){var u;switch(n.type){case x.LARGE_AV_SHIFT:u=I.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case x.LARGE_VIDEO_GAP:u=I.LARGE_VIDEO_DTS_GAP_DETECT;break;case x.LARGE_VIDEO_GAP_BETWEEN_CHUNK:u=I.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}u&&a.hls.emit(I.STREAM_EXCEPTION,U(U({},n),{},{type:u})),ue.warn("video exception",n)}),r.warnings.forEach(function(n){var u;switch(n.type){case x.LARGE_AUDIO_GAP:u=I.LARGE_AUDIO_DTS_GAP_DETECT;break;case x.AUDIO_FILLED:u=I.AUDIO_GAP_DETECT;break;case x.AUDIO_DROPPED:u=I.AUDIO_OVERLAP_DETECT;break}u&&a.hls.emit(I.STREAM_EXCEPTION,U(U({},n),{},{type:u})),ue.warn("audio exception",n)}),t.samples.forEach(function(n){n.keyframe&&a.hls.emit(I.KEYFRAME,{pts:n.pts})}),e.seiSamples.forEach(function(n){a.hls.emit(I.SEI,U(U({},n),{},{originPts:n.originPts/90,sei:{code:n.data.type,content:n.data.payload,dts:n.pts}}))})}}]),l}(),Ae=new ae("BufferService"),ut=function(){function l(s){$(this,l),c(this,"_decryptor",new st),c(this,"_transmuxer",null),c(this,"_mse",null),c(this,"_softVideo",null),c(this,"_sourceCreated",!1),c(this,"_needInitSegment",!0),c(this,"_directAppend",!1),this.hls=s,s.config.softDecode?this._softVideo=s.media:(this._mse=new Y,s.config.url&&this._mse.bindMedia(s.media)),s.config.decryptor&&(this._decryptor.externalDecryptor=s.config.decryptor)}return V(l,[{key:"baseDts",get:function(){var t,r,e;return(t=this._transmuxer)===null||t===void 0||(r=t._demuxer)===null||r===void 0||(e=r._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var t;return(t=this._mse)!==null&&t!==void 0&&t._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"updateDuration",value:function(){var s=R(b().mark(function r(e){return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(Ae.debug("update duration",e),!this._mse){a.next=9;break}if(this._mse.isOpened){a.next=5;break}return a.next=5,this._mse.open();case 5:return a.next=7,this._mse.updateDuration(e);case 7:a.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return a.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"createSource",value:function(t,r,e,i){if(!this._sourceCreated){var a=t||r;if(a){if(Oe.probe(a))this._transmuxer||(this._transmuxer=new Te(this.hls,!1,!this._softVideo));else if(ee.probe(a))if(this._softVideo)this._transmuxer||(this._transmuxer=new Te(this.hls,!0));else{this._directAppend=!0;var n=!1;t&&!e&&ee.findBox(t,["moov","trak"]).forEach(function(u){var h=ee.findBox(u.data,["trak","mdia","minf","stbl","stsd"])[0];if(h){var o=ee.stsd(h).entries[0];if(o){if(o.hvcC)e=o.hvcC.codec||"hev1.1.6.L93.B0";else if(o.avcC)e=o.avcC.codec;else if(o.sampleRate||o.esds){var d;i=((d=o.esds)===null||d===void 0?void 0:d.codec)||"mp4a.40.2",n=!0}}}}),r&&!i&&ee.findBox(r,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(u){var h=ee.stsd(u).entries[0];h&&h.esds&&(i=h.esds.codec)}),t&&!e&&(e="avc1.42e01e"),r&&!i&&(i="mp4a.40.2"),n&&(e+=", ".concat(i),i=""),this._createMseSource(e,i)}else throw new G(W.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var s=R(b().mark(function r(e,i,a,n,u,h,o){var d,v,m,f,y,_,E,k,M;return b().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!(!(a!=null&&a.length)&&!(n!=null&&n.length))){T.next=2;break}return T.abrupt("return");case 2:if(!this._directAppend){T.next=7;break}return d=[],a&&d.push(this._mse.append(Y.VIDEO,a)),n&&d.push(this._mse.append(Y.AUDIO,n)),T.abrupt("return",Promise.all(d));case 7:if(v=this._needInitSegment||u,m=this._transmuxer.transmux(a,n,u,h,o,this._needInitSegment||u),f=X(m,2),y=f[0],_=f[1],n&&i&&(i==null||i.setTrackExist(!1,!0)),n&&e&&(e==null||e.setTrackExist(!0,!1)),i||e==null||e.setTrackExist(!!y,!!_),y&&!_&&this.hls.emit(I.NO_AUDIO_TRACK),!this._softVideo){T.next=18;break}this._softVideo.appendBuffer(y,_),this._needInitSegment=!1,T.next=28;break;case 18:if(!this._mse){T.next=28;break}return E=!this._sourceCreated,E&&this._createMseSource(y==null?void 0:y.codec,_==null?void 0:_.codec),this._needInitSegment=!1,k=this._mse,M=[],v&&!E&&this._handleCodecChange(y,_),y&&M.push(k.append(Y.VIDEO,y.data)),_&&M.push(k.append(Y.AUDIO,_.data)),T.abrupt("return",Promise.all(M));case 28:case"end":return T.stop()}},r,this)}));function t(r,e,i,a,n,u,h){return s.apply(this,arguments)}return t}()},{key:"removeBuffer",value:function(){var s=R(b().mark(function r(){var e=this,i,a,n,u=arguments;return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=u.length>0&&u[0]!==void 0?u[0]:0,a=u.length>1&&u[1]!==void 0?u[1]:1/0,n=this.hls.media,!(!this._mse||!n||i<0||a<i||i>=this._mse.duration)){o.next=5;break}return o.abrupt("return");case 5:return o.abrupt("return",this._mse.clearBuffer(i,a).then(function(){return e.hls.emit(O.REMOVE_BUFFER,{start:i,end:a,removeEnd:a})}));case 6:case"end":return o.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var s=R(b().mark(function r(e){var i,a,n,u;return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=this.hls.media,!(!this._mse||!i||!e||e<0)){o.next=3;break}return o.abrupt("return");case 3:if(a=i.currentTime,n=a-e,!(n<=0)){o.next=7;break}return o.abrupt("return");case 7:if(u=Q.start(Q.get(i)),!(u+1>=n)){o.next=10;break}return o.abrupt("return");case 10:return o.abrupt("return",this.removeBuffer(0,n));case 11:case"end":return o.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"clearAllBuffer",value:function(){var s=R(b().mark(function r(){return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=2;break}return i.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"decryptBuffer",value:function(t,r){return this._decryptor.decrypt(t,r)}},{key:"reset",value:function(){var s=R(b().mark(function r(){var e,i=arguments;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){n.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,n.next=6,this._mse.unbindMedia();case 6:return n.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return n.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var s=R(b().mark(function r(){return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=5;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.hls.emit(O.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"setLiveSeekableRange",value:function(){var s=R(b().mark(function r(e,i){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,i);case 1:case"end":return n.stop()}},r,this)}));function t(r,e){return s.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var s=R(b().mark(function r(){var e;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((e=this._decryptor)===null||e===void 0||e.destroy(),!this._mse){a.next=4;break}return a.next=4,this._mse.unbindMedia();case 4:this._decryptor=null,this._mse=null,this._softVideo=null;case 7:case"end":return a.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"_createMseSource",value:function(t,r){Ae.debug("create mse source, videoCodec=".concat(t,", audioCodec=").concat(r));var e=this._mse;e&&(t&&(e.createSource(Y.VIDEO,"video/mp4;codecs=".concat(t)),this._sourceCreated=!0),r&&(e.createSource(Y.AUDIO,"audio/mp4;codecs=".concat(r)),this._sourceCreated=!0),this.hls.emit(O.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(t,r){var e=this._mse,i=[{type:Y.VIDEO,codecs:t==null?void 0:t.codec},{type:Y.AUDIO,codecs:r==null?void 0:r.codec}];i.filter(function(a){return!!a.codecs}).forEach(function(a){var n=a.type,u=a.codecs,h=e.getSourceBuffer(n);if(h){var o=u.split(",")[0];new RegExp(o,"ig").test(h.mimeType)||e.changeType(n,"".concat(n,"/mp4;codecs=").concat(u))}})}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}}]),l}();function lt(l){var s=(l==null?void 0:l.media)||document.createElement("video");return U(U({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0},l),{},{media:s})}var ot=V(function l(){$(this,l),c(this,"version",0),c(this,"streams",[]),c(this,"isMaster",!0)}),Re={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},Se=V(function l(){$(this,l),c(this,"id",0),c(this,"url",""),c(this,"default",!1),c(this,"autoSelect",!1),c(this,"forced",!1),c(this,"group",""),c(this,"name",""),c(this,"lang",""),c(this,"segments",[]),c(this,"endSN",0)}),ht=function(l){fe(t,l);var s=de(t);function t(){var r;$(this,t);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return r=s.call.apply(s,[this].concat(i)),c(A(r),"mediaType",Re.Audio),c(A(r),"channels",0),r}return V(t)}(Se),ct=function(l){fe(t,l);var s=de(t);function t(){var r;$(this,t);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return r=s.call.apply(s,[this].concat(i)),c(A(r),"mediaType",Re.SubTitle),r}return V(t)}(Se),ft=V(function l(){$(this,l),c(this,"id",0),c(this,"bitrate",0),c(this,"width",0),c(this,"height",0),c(this,"name",""),c(this,"url",""),c(this,"audioCodec",""),c(this,"videoCodec",""),c(this,"textCodec",""),c(this,"audioGroup",""),c(this,"audioStreams",[]),c(this,"subtitleStreams",[]),c(this,"closedCaptionsStream",[])}),dt=V(function l(){$(this,l),c(this,"version",0),c(this,"url",""),c(this,"type",""),c(this,"startCC",0),c(this,"endCC",0),c(this,"startSN",0),c(this,"endSN",0),c(this,"totalDuration",0),c(this,"targetDuration",0),c(this,"live",!0),c(this,"segments",[])}),me=function(){function l(){$(this,l),c(this,"sn",0),c(this,"cc",0),c(this,"url",""),c(this,"title",""),c(this,"start",0),c(this,"duration",0),c(this,"key",null),c(this,"byteRange",null),c(this,"isInitSegment",!1),c(this,"initSegment",null),c(this,"isLast",!1),c(this,"hasAudio",!1),c(this,"hasVideo",!1)}return V(l,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(t,r){this.hasVideo=t,this.hasAudio=r}},{key:"setByteRange",value:function(t,r){this.byteRange=[0];var e=t.split("@");e.length===1&&r&&r.byteRange?(this.byteRange[0]=r.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),l}(),mt=function(){function l(s){$(this,l),c(this,"method",""),c(this,"url",""),c(this,"iv",null),c(this,"keyFormat",""),c(this,"keyFormatVersions",""),s instanceof l&&(this.method=s.method,this.url=s.url,this.keyFormat=s.keyFormat,this.keyFormatVersions=s.keyFormatVersions,s.iv&&(this.iv=new Uint8Array(s.iv)))}return V(l,[{key:"clone",value:function(t){var r=new l(this);return t!=null&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(t){if(!this.iv&&this.method==="AES-128"&&typeof t=="number"&&this.url){this.iv=new Uint8Array(16);for(var r=12;r<16;r++)this.iv[r]=t>>8*(15-r)&255}}}]),l}(),vt=/^#(EXT[^:]*)(?::(.*))?$/,Le=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,pt=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,gt=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function yt(l){return l.split(/[\r\n]/).map(function(s){return s.trim()}).filter(Boolean)}function Ce(l){var s=l.match(vt);if(!(!s||!s[1]))return[s[1].replace("EXT-X-",""),s[2]]}function ce(l){for(var s={},t=Le.exec(l);t;)s[t[1]]=t[2]||t[3],t=Le.exec(l);return s}function ne(l,s){if(!s||!l||pt.test(l))return l;var t=gt.exec(s);return t?l[0]==="/"?t[1]+l:t[1]+t[2]+l:l}var St={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function ve(l,s){var t=St[l];if(!(!t||!s||!s.length)){for(var r=0;r<t.length;r++)for(var e=0;e<s.length;e++)if(t[r].test(s[e]))return s[e]}}function _t(l,s){for(var t=new ot,r=0,e,i=[],a=[];e=l[r++];){var n=Ce(e);if(n){var u=X(n,2),h=u[0],o=u[1];if(h==="VERSION")t.version=parseInt(o);else if(h==="MEDIA"&&o){var d=ce(o),v=void 0;switch(d.TYPE){case"AUDIO":v=new ht;break;case"SUBTITLES":v=new ct;break;default:v=new Se}v.url=ne(d.URI,s),v.default=d.DEFAULT==="YES",v.autoSelect=d.AUTOSELECT==="YES",v.group=d["GROUP-ID"],v.name=d.NAME,v.lang=d.LANGUAGE,d.CHANNELS&&(v.channels=Number(d.CHANNELS.split("/")[0]),Number.isNaN(v.channels)&&(v.channels=0)),d.TYPE==="AUDIO"&&d.URI&&i.push(v),d.TYPE==="SUBTITLES"&&a.push(v)}else if(h==="STREAM-INF"&&o){var m=new ft,f=ce(o);if(m.bitrate=parseInt(f["AVERAGE-BANDWIDTH"]||f.BANDWIDTH),m.name=f.NAME,m.url=ne(l[r++],s),f.RESOLUTION){var y=f.RESOLUTION.split("x"),_=X(y,2),E=_[0],k=_[1];m.width=parseInt(E),m.height=parseInt(k)}if(f.CODECS){var M=f.CODECS.split(/[ ,]+/).filter(Boolean);m.videoCodec=ve("video",M),m.audioCodec=ve("audio",M),m.textCodec=ve("text",M)}m.audioGroup=f.AUDIO,m.subtitleGroup=f.SUBTITLES,t.streams.push(m)}}}return t.streams.forEach(function(P,T){P.id=T}),i.length&&(i.forEach(function(P,T){P.id=T}),t.streams.forEach(function(P){P.audioGroup&&(P.audioStreams=i.filter(function(T){return T.group===P.audioGroup}))})),a.length&&(a.forEach(function(P,T){P.id=T}),t.streams.forEach(function(P){P.subtitleGroup&&(P.subtitleStreams=a.filter(function(T){return T.group===P.subtitleGroup}))})),t}function bt(l,s){var t=new dt;t.url=s;for(var r=new me,e=null,i=null,a=0,n=0,u=0,h=0,o,d=!1;(o=l[h++])&&!d;){if(o[0]!=="#"){r.sn=n,r.cc=u,r.url=ne(o,s),i&&(r.key=i.clone(n)),e&&(r.initSegment=e),t.segments.push(r),r=new me,n++;continue}var v=Ce(o);if(v){var m=X(v,2),f=m[0],y=m[1];switch(f){case"VERSION":t.version=parseInt(y);break;case"PLAYLIST-TYPE":t.type=y==null?void 0:y.toUpperCase();break;case"TARGETDURATION":t.targetDuration=parseFloat(y);break;case"ENDLIST":{var _=t.segments[t.segments.length-1];_&&(_.isLast=!0),t.live=!1,d=!0}break;case"MEDIA-SEQUENCE":n=t.startSN=parseInt(y);break;case"DISCONTINUITY-SEQUENCE":u=t.startCC=parseInt(y);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":r.setByteRange(y,t.segments[t.segments.length-1]);break;case"EXTINF":{var E=y.split(","),k=X(E,2),M=k[0],P=k[1];r.start=a,r.duration=parseFloat(M),a+=r.duration,r.title=P}break;case"KEY":{var T=ce(y);if(T.METHOD==="NONE"){i=null;break}if(T.METHOD!=="AES-128")throw new Error("encrypt ".concat(T.METHOD,"/").concat(T.KEYFORMAT," is not supported"));if(i=new mt,i.method=T.METHOD,i.url=/^blob:/.test(T.URI)?T.URI:ne(T.URI,s),i.keyFormat=T.KEYFORMAT||"identity",i.keyFormatVersions=T.KEYFORMATVERSIONS,T.IV){var D=T.IV.slice(2);D=(D.length&1?"0":"")+D,i.iv=new Uint8Array(D.length/2);for(var K=0,F=D.length/2;K<F;K++)i.iv[K]=parseInt(D.slice(K*2,K*2+2),16)}}break;case"MAP":{var B=ce(y);r.url=ne(B.URI,s),B.BYTERANGE&&r.setByteRange(B.BYTERANGE),r.isInitSegment=!0,r.sn=0,i&&(r.key=i.clone(0)),e=r,r=new me}break}}}t.segments=t.segments.filter(function(se){return se.duration!==0});var z=t.segments[t.segments.length-1];return z&&(t.endSN=z.sn),t.totalDuration=a,t.endCC=u,t}var pe=function(){function l(){$(this,l)}return V(l,null,[{key:"parse",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var e=yt(t);return l.isMediaPlaylist(t)?bt(e,r):_t(e,r)}},{key:"isMediaPlaylist",value:function(t){return t.includes("#EXTINF:")||t.includes("#EXT-X-TARGETDURATION:")}}]),l}(),Et=function(){function l(s){var t=this;$(this,l),c(this,"_onLoaderRetry",function(u,h){t.hls.emit(I.LOAD_RETRY,{error:G.network(u),retryTime:h})}),this.hls=s,this._timer=null;var r=this.hls.config,e=r.retryCount,i=r.retryDelay,a=r.loadTimeout,n=r.fetchOptions;this._loader=new te(U(U({},n),{},{responseType:"text",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._audioLoader=new te(U(U({},n),{},{responseType:"text",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new te(U(U({},n),{},{responseType:"text",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry}))}return V(l,[{key:"load",value:function(){var s=R(b().mark(function r(e,i,a){var n,u,h,o,d,v,m,f,y,_,E,k,M,P;return b().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return n=[this._loader.load(e)],i&&n.push(this._audioLoader.load(i)),a&&n.push(this._subtitleLoader.load(a)),D.prev=3,D.next=6,Promise.all(n);case 6:if(d=D.sent,v=X(d,3),m=v[0],f=v[1],y=v[2],m){D.next=13;break}return D.abrupt("return",[]);case 13:u=m.data,i?(h=f==null?void 0:f.data,o=y==null?void 0:y.data):o=f==null?void 0:f.data,D.next=20;break;case 17:throw D.prev=17,D.t0=D.catch(3),G.network(D.t0);case 20:if(_=this.hls.config.onPreM3U8Parse,D.prev=21,_&&(u=_(u)||u,h&&(h=_(h,!0)||h),o&&(o=_(o,!0)||o)),E=pe.parse(u,e),!(((P=E)===null||P===void 0?void 0:P.live)===!1&&E.segments&&!E.segments.length)){D.next=26;break}throw new Error("empty segments list");case 26:h&&(k=pe.parse(h,i)),o&&(M=pe.parse(o,a)),D.next=33;break;case 30:throw D.prev=30,D.t1=D.catch(21),new G(W.MANIFEST,W.SUB_TYPES.HLS,D.t1);case 33:return E&&(E.isMaster?this.hls.emit(I.HLS_MANIFEST_LOADED,{playlist:E}):this.hls.emit(I.HLS_LEVEL_LOADED,{playlist:E})),D.abrupt("return",[E,k,M]);case 35:case"end":return D.stop()}},r,this,[[3,17],[21,30]])}));function t(r,e,i){return s.apply(this,arguments)}return t}()},{key:"poll",value:function(t,r,e,i,a,n){var u=this;clearTimeout(this._timer),n=n||3e3;var h=this.hls.config.pollRetryCount,o=function(){var d=R(b().mark(function v(){var m;return b().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return clearTimeout(u._timer),y.prev=1,y.next=4,u.load(t,r,e);case 4:if(m=y.sent,m[0]){y.next=7;break}return y.abrupt("return");case 7:h=u.hls.config.pollRetryCount,i(m[0],m[1],m[2]),y.next=15;break;case 11:y.prev=11,y.t0=y.catch(1),h--,h<=0&&a(y.t0);case 15:u._timer=setTimeout(o,n);case 16:case"end":return y.stop()}},v,null,[[1,11]])}));return function(){return d.apply(this,arguments)}}();this._timer=setTimeout(o,n)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),l}();function Ue(l,s,t){return s>t&&(t=s),Math.min(Math.max(l,s),t)}var De=function(){function l(s,t,r){$(this,l),c(this,"live",void 0),c(this,"id",0),c(this,"bitrate",0),c(this,"width",0),c(this,"height",0),c(this,"name",""),c(this,"url",""),c(this,"audioCodec",""),c(this,"videoCodec",""),c(this,"textCodec",""),c(this,"startCC",0),c(this,"endCC",0),c(this,"startSN",0),c(this,"endSN",-1),c(this,"totalDuration",0),c(this,"targetDuration",0),c(this,"snDiff",null),c(this,"segments",[]),c(this,"audioStreams",[]),c(this,"subtitleStreams",[]),c(this,"closedCaptions",[]),c(this,"currentAudioStream",null),c(this,"currentSubtitleStream",null),this.update(s,t,r)}return V(l,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var t;return this.targetDuration||((t=this.segments[0])===null||t===void 0?void 0:t.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var t;return((t=this.lastSegment)===null||t===void 0?void 0:t.end)||0}},{key:"currentSubtitleEndSn",get:function(){var t;return((t=this.currentSubtitleStream)===null||t===void 0?void 0:t.endSN)||0}},{key:"clearOldSegment",value:function(t,r){return this.currentAudioStream&&this._clearSegments(t,r),this._clearSegments(t,r)}},{key:"getAudioSegment",value:function(t){if(!(!t||!this.currentAudioStream)){var r=t.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===r})}}},{key:"update",value:function(t,r){this.url=t.url,Array.isArray(t.segments)?((this.live===null||this.live===void 0)&&(this.live=t.live),this._updateSegments(t,this),this.startCC=t.startCC,this.endCC=t.endCC,this.startSN=t.startSN,this.endSN=t.endSN||-1,this.totalDuration=t.totalDuration,this.targetDuration=t.targetDuration,this.live=t.live,r&&this.currentAudioStream&&Array.isArray(r.segments)&&(this._updateSegments(r,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&t.segments.length&&r.segments.length&&(this.snDiff=t.segments[0].sn-r.segments[0].sn))):(this.id=t.id,this.bitrate=t.bitrate,this.width=t.width,this.height=t.height,this.name=t.name,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.textCodec=t.textCodec,this.audioStreams=t.audioStreams,this.subtitleStreams=t.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(t){var r=this;if(t&&this.currentSubtitleStream&&Array.isArray(t.segments)){var e=this._updateSegments(t,this.currentSubtitleStream),i=this.currentSubtitleStream.segments;if(i.length>100&&(this.currentSubtitleStream.segments=i.slice(100)),!!e)return e.map(function(a){return{sn:a.sn,url:a.url,duration:a.duration,start:a.start,end:a.end,lang:r.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(t){var r=this.subtitleStreams.find(function(i){return i.lang===t}),e=this.currentSubtitleStream;r&&(this.currentSubtitleStream=r,e.segments=[])}},{key:"_clearSegments",value:function(t,r){for(var e=0,i=this.segments,a=0,n=i.length;a<n;a++)if(i[a].end>=t){e=a;break}return e>r&&(e=r),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),r-e}},{key:"_updateSegments",value:function(t,r){var e=r.segments;if(this.live){var i=e[e.length-1],a=(i==null?void 0:i.sn)||-1;if(a<t.endSN&&t.segments.length){var n=t.segments.findIndex(function(d){return d.sn===a}),u=n<0?t.segments:t.segments.slice(n+1);if(e.length&&u.length){var h=i.end;u.forEach(function(d){d.start=h,h=d.end});var o=(i==null?void 0:i.cc)||-1;o>u[0].cc&&u.forEach(function(d){return d.cc+=o})}return r.endSN=t.endSN,r.segments=e.concat(u),u}}else r.segments=t.segments}}]),l}(),wt=function(){function l(s){$(this,l),c(this,"streams",[]),c(this,"currentStream",null),c(this,"dvrWindow",0),c(this,"_segmentPointer",-1),this.hls=s}return V(l,[{key:"lastSegment",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.lastSegment}},{key:"currentSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer]}},{key:"nextSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.segments}},{key:"currentSubtitleEndSn",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.liveEdge}},{key:"totalDuration",get:function(){var t;return((t=this.currentStream)===null||t===void 0?void 0:t.totalDuration)||0}},{key:"seekRange",get:function(){var t=this.currentSegments;if(!(!t||!t.length))return[t[0].start,t[t.length-1].end]}},{key:"isEmpty",get:function(){var t;return!((t=this.currentSegments)!==null&&t!==void 0&&t.length)}},{key:"isLive",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.live}},{key:"hasSubtitle",get:function(){var t;return!!((t=this.currentStream)!==null&&t!==void 0&&t.currentSubtitleStream)}},{key:"getAudioSegment",value:function(t){var r;return(r=this.currentStream)===null||r===void 0?void 0:r.getAudioSegment(t)}},{key:"moveSegmentPointer",value:function(t){var r;t==null&&(t=this._segmentPointer+1),this._segmentPointer=Ue(t,-1,(r=this.currentSegments)===null||r===void 0?void 0:r.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(t){var r;return(r=this.currentSegments)===null||r===void 0?void 0:r[t]}},{key:"setNextSegmentByIndex",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=t-1}},{key:"findSegmentIndexByTime",value:function(t){var r=this.currentSegments;if(r){for(var e=0,i=r.length,a;e<i;e++)if(a=r[e],t>=a.start&&t<a.end)return e;var n=r[r.length-1];if(Math.abs(t-n.end)<.2)return r.length-1}}},{key:"upsertPlaylist",value:function(t,r,e){var i=this;if(t){if(t.isMaster)this.streams.length=t.streams.length,t.streams.filter(function(h){return h.url}).forEach(function(h,o){i.streams[o]?i.streams[o].update(h):i.streams[o]=new De(h)}),this.currentStream=this.streams[0];else if(Array.isArray(t.segments)){var a=this.currentStream;if(a){a.update(t,r,e);var n=a.updateSubtitle(e);n&&this.hls.emit(I.SUBTITLE_SEGMENTS,{list:n})}else this.reset(),this.currentStream=this.streams[0]=new De(t,r,e)}var u=this.currentStream;u&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(h,o){return h+=o.duration,h},0))}}},{key:"switchSubtitle",value:function(t){var r;(r=this.currentStream)===null||r===void 0||r.switchSubtitle(t)}},{key:"clearOldSegment",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=this.currentStream;if(!(!this.dvrWindow||!r)){var e=r.endTime-this.dvrWindow;if(!(e<=0)){var i=r.segments;i.length<=t||(this._segmentPointer=r.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(t,r){var e=this.findSegmentIndexByTime(t),i=this.getSegmentByIndex(e);if(i&&!(!i.hasAudio&&!i.hasVideo)){if(r!==2&&i.hasAudio&&i.hasVideo)return i;if(!(i.end-t>.3)){var a=this.getSegmentByIndex(e+1);if(a&&!(!a.hasAudio&&!a.hasVideo)&&(a.hasAudio!==i.hasAudio||a.hasVideo!==i.hasVideo))return a}}}}]),l}(),kt=function(){function l(s){var t=this;$(this,l),c(this,"error",null),c(this,"_emitOnLoaded",function(u,h){var o=u.data,d=u.response,v=u.option,m=v||{},f=m.firstByteTime,y=m.startTime,_=m.endTime,E=m.contentLength,k=_-y;t._bandwidthService.addRecord(E||o.byteLength,k),t.hls.emit(O.SPEED,{time:k,byteLength:E,url:h}),t.hls.emit(O.LOAD_COMPLETE,{url:h,elapsed:k||0}),t.hls.emit(O.TTFB,{url:h,responseUrl:d.url,elapsed:f-y}),t.hls.emit(O.LOAD_RESPONSE_HEADERS,{headers:d.headers})}),c(this,"_onLoaderRetry",function(u,h){t.hls.emit(O.LOAD_RETRY,{error:G.network(u),retryTime:h})}),this.hls=s,this._bandwidthService=new Ye,this._mapCache={},this._keyCache={};var r=this.hls.config,e=r.retryCount,i=r.retryDelay,a=r.loadTimeout,n=r.fetchOptions;this._segmentLoader=new te(U(U({},n),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new te(U(U({},n),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry})),this._keyLoader=new te(U(U({},n),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:a,onRetryError:this._onLoaderRetry}))}return V(l,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(t,r,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,a=[];return t&&(a[0]=this.loadVideoSegment(t,e)),r&&(a[1]=this.loadAudioSegment(r,i)),Promise.all(a)}},{key:"loadVideoSegment",value:function(t,r){return this._loadSegment(this._segmentLoader,t,r)}},{key:"loadAudioSegment",value:function(t,r){return this._loadSegment(this._audioSegmentLoader,t,r)}},{key:"_loadSegment",value:function(){var s=R(b().mark(function r(e,i,a){var n=this,u,h,o,d,v,m,f,y,_,E,k,M,P,T,D;return b().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return f=[],this.hls.emit(O.LOAD_START,{url:i.url}),f[0]=e.load(i.url),a&&i.initSegment&&(_=i.initSegment.url,h=this._mapCache[_],h||(this.hls.emit(O.LOAD_START,{url:_}),f[1]=e.load(_).then(function(B){if(B){var z=Object.keys(n._mapCache);z>30&&(n._mapCache={}),h=n._mapCache[_]=B.data,n._emitOnLoaded(B,_)}})),E=(y=i.initSegment.key)===null||y===void 0?void 0:y.url,E&&(m=i.initSegment.key.iv,v=this._keyCache[E],v||(this.hls.emit(O.LOAD_START,{url:E}),f[2]=this._keyLoader.load(E).then(function(B){B&&(v=n._keyCache[E]=B.data,n._emitOnLoaded(B,E))})))),k=(u=i.key)===null||u===void 0?void 0:u.url,k&&(d=i.key.iv,o=this._keyCache[k],o||(this.hls.emit(O.LOAD_START,{url:k}),f[3]=this._keyLoader.load(k).then(function(B){B&&(o=n._keyCache[k]=B.data,n._emitOnLoaded(B,k))}))),F.next=8,Promise.all(f);case 8:if(M=F.sent,P=X(M,1),T=P[0],T){F.next=13;break}return F.abrupt("return");case 13:return D=T.data,this._emitOnLoaded(T,i.url),F.abrupt("return",{data:D,map:h,key:o,mapKey:v,keyIv:d,mapKeyIv:m});case 16:case"end":return F.stop()}},r,this)}));function t(r,e,i){return s.apply(this,arguments)}return t}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var s=R(b().mark(function r(){return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()}]),l}(),J=new ae("hls"),re=function(l){fe(t,l);var s=de(t);function t(r){var e;return $(this,t),e=s.call(this),c(A(e),"version",t.version),c(A(e),"media",null),c(A(e),"config",null),c(A(e),"_manifestLoader",null),c(A(e),"_segmentLoader",null),c(A(e),"_playlist",null),c(A(e),"_bufferService",null),c(A(e),"_gapService",null),c(A(e),"_seiService",null),c(A(e),"_stats",null),c(A(e),"_prevSegSn",null),c(A(e),"_prevSegCc",null),c(A(e),"_tickTimer",null),c(A(e),"_tickInterval",500),c(A(e),"_segmentProcessing",!1),c(A(e),"_reloadOnPlay",!1),c(A(e),"_switchUrlOpts",null),c(A(e),"_loadSegment",R(b().mark(function i(){var a,n,u;return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e._segmentProcessing||!e.media)){o.next=2;break}return o.abrupt("return");case 2:if(a=e.media.currentTime,n=e._playlist.currentSegment,u=e._playlist.nextSegment,!(!u||n&&!e.isLive&&n.end-a>=e.config.preloadTime)){o.next=7;break}return o.abrupt("return");case 7:return o.abrupt("return",e._loadSegmentDirect());case 8:case"end":return o.stop()}},i)}))),c(A(e),"_onPlay",R(b().mark(function i(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){n.next=6;break}e._reloadOnPlay=!1,e.replay(!0),n.next=9;break;case 6:return n.next=8,e._loadSegment();case 8:e._startTick();case 9:case"end":return n.stop()}},i)}))),c(A(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var i=e.config.disconnectTime;if(i==null&&(i=e._playlist.dvrWindow),!Number.isFinite(i))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},i||0)}}else e._stopTick()}),c(A(e),"_onSeeking",R(b().mark(function i(){var a,n,u,h,o,d,v;return b().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(e.media){f.next=2;break}return f.abrupt("return");case 2:if(a=e.media.currentTime,n=e._playlist.seekRange,!n){f.next=9;break}if(u=Ue(a,n[0]+.1,n[1]-.1),!(u>=0&&Math.abs(a-u)>=.1)){f.next=9;break}return e.media.currentTime=u,f.abrupt("return");case 9:if(h=e._playlist.currentSegment,!h){f.next=14;break}if(o=Q.info(Q.get(e.media),a,.1),!(o.end&&Math.abs(o.end-h.end)<.2)){f.next=14;break}return f.abrupt("return");case 14:if(d=e._playlist.findSegmentIndexByTime(a),v=e._playlist.getSegmentByIndex(d),!(d==null||!v||e._segmentProcessing&&v===e._playlist.nextSegment)){f.next=18;break}return f.abrupt("return");case 18:return J.debug("seek to",a,v),e._playlist.setNextSegmentByIndex(d),e._stopTick(),f.next=23,e._segmentLoader.cancel();case 23:return f.next=25,e._loadSegmentDirect();case 25:e._startTick();case 26:case"end":return f.stop()}},i)}))),c(A(e),"_onTimeupdate",function(){if(e.media){var i=e.config;if(i.isLive&&i.maxLatency&&i.targetLatency&&e.media){var a=e._playlist.liveEdge;if(!a)return;var n=a-e.media.currentTime;n>=i.maxLatency&&(J.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(a,",  latency=").concat(n)),e.media.currentTime=a-i.targetLatency)}e._seiService.throw(e.media.currentTime),e.config.allowedStreamTrackChange&&!e.config.softDecode&&e._checkStreamTrackChange(e.media.currentTime)}}),c(A(e),"_tick",function(){if(e.media){e._startTick();var i=e.media,a=Q.get(i),n=e._segmentLoader.error;if(n){var u=.5;(!i.readyState||e.bufferInfo(u).remaining<1)&&(n.fatal=!0,e._emitError(G.network(n)));return}Q.end(a)<.1||!i.readyState||(We(i)?(e._loadSegment(),e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,e.isLive)):i.readyState<2&&e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,i.currentTime?e.isLive:!0))}}),e.config=r=lt(r),e.media=e.config.media,e._manifestLoader=new Et(A(e)),e._segmentLoader=new kt(A(e)),e._playlist=new wt(A(e)),e._bufferService=new ut(A(e)),e._seiService=new Xe(A(e)),r.softDecode||(e._gapService=new Ke),e._stats=new ze(A(e),9e4),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return V(t,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return Q.info(Q.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Qe(this.media)}},{key:"load",value:function(){var r=R(b().mark(function i(a){var n,u=arguments;return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return n=u.length>1&&u[1]!==void 0?u[1]:!1,a&&(this.config.url=a),a=this.config.url,o.next=5,this._reset(n);case 5:return o.next=7,this._loadData(a);case 7:this._startTick();case 8:case"end":return o.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var r=R(b().mark(function i(a){var n,u,h,o,d,v,m,f,y,_;return b().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:try{a&&(a=a.trim())}catch(M){}if(a){k.next=3;break}throw this._emitError(new G(W.OTHER,W.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return k.next=5,this._loadM3U8(a);case 5:if(n=k.sent,u=this._playlist.currentStream,!this._urlSwitching){k.next=17;break}if(u.bitrate===0&&(h=this._switchUrlOpts)!==null&&h!==void 0&&h.bitrate&&(u.bitrate=(o=this._switchUrlOpts)===null||o===void 0?void 0:o.bitrate),d=this._getSeamlessSwitchPoint(),this.config.startTime=d,v=this._playlist.findSegmentIndexByTime(d),m=this._playlist.getSegmentByIndex(v+1),!m){k.next=17;break}return f=m.start,k.next=17,this._bufferService.removeBuffer(f);case 17:if(!n){k.next=29;break}if(!this.isLive){k.next=25;break}this._bufferService.setLiveSeekableRange(0,4294967295),J.log("totalDuration first time got",this._playlist.totalDuration),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),n.isMaster||this._pollM3U8(a),k.next=29;break;case 25:return k.next=27,this._bufferService.updateDuration(u.totalDuration);case 27:y=this.config.startTime,y&&((_=this._switchUrlOpts)!==null&&_!==void 0&&_.seamless||(this.media.currentTime=y),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(y)||0));case 29:return k.next=31,this._loadSegment();case 31:case"end":return k.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"replay",value:function(){var r=R(b().mark(function i(a){return b().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.config.startTime=0,u.next=3,this.load();case 3:return this._reloadOnPlay=!1,u.abrupt("return",this.media.play(!a));case 5:case"end":return u.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchURL",value:function(){var r=R(b().mark(function i(a){var n,u,h,o,d,v,m,f=arguments;return b().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:n=f.length>1&&f[1]!==void 0?f[1]:{},u={seamless:!1,startTime:0,bitrate:0},_.t0=oe(n),_.next=_.t0==="number"?5:_.t0==="boolean"?7:_.t0==="object"?9:11;break;case 5:return n={startTime:n},_.abrupt("break",12);case 7:return n={seamless:n},_.abrupt("break",12);case 9:for(h in n)(n[h]===void 0||n[h]===null)&&delete n[h];return _.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(n);case 12:if(n=Object.assign({},u,n),o=n,d=o.seamless,v=o.startTime,this.config.url=a,this.config.startTime=v,this._switchUrlOpts=n,d){_.next=38;break}if(_.prev=18,!this.config.softDecode){_.next=23;break}_.t1=this.load(a),_.next=26;break;case 23:return _.next=25,this.load(a);case 25:_.t1=_.sent;case 26:m=_.t1,_.next=33;break;case 29:throw _.prev=29,_.t2=_.catch(18),this.emit(I.SWITCH_URL_FAILED,_.t2),_.t2;case 33:return this._reloadOnPlay=!1,m&&this.emit(I.SWITCH_URL_SUCCESS,{url:a}),_.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._bufferService.seamlessSwitch(),_.next=45,this._clear();case 45:return _.next=47,this._loadData(a);case 47:this._startTick();case 48:this._switchUrlOpts=null;case 49:case"end":return _.stop()}},i,this,[[18,29]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchStream",value:function(){var r=R(b().mark(function i(a){var n,u,h,o,d,v=arguments;return b().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n=v.length>1&&v[1]!==void 0?v[1]:!0,u=this.currentStream,h=this.streams,!(!u||u.id===a||!h||h.length<2)){f.next=5;break}return f.abrupt("return");case 5:if(o=h.find(function(y){return y.id===a}),o){f.next=8;break}return f.abrupt("return");case 8:return f.prev=8,f.next=11,this._clear();case 11:if(!n){f.next=14;break}return f.next=14,this._bufferService.clearAllBuffer();case 14:f.next=19;break;case 16:throw f.prev=16,f.t0=f.catch(8),this._emitError(G.create(f.t0));case 19:if(u.currentAudioStream&&o.audioStreams.length>2&&(d=u.currentAudioStream.id,o.currentAudioStream=o.audioStreams.find(function(y){return y.id===d})||o.currentAudioStream),this._playlist.currentStream=o,f.prev=21,!(this.isLive||!o.segments.length)){f.next=25;break}return f.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,f.next=29,this._loadSegmentDirect();case 29:f.next=35;break;case 31:throw f.prev=31,f.t1=f.catch(21),this._playlist.currentStream=u,f.t1;case 35:return this._startTick(),f.abrupt("return",o);case 37:case"end":return f.stop()}},i,this,[[8,16],[21,31]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchAudioStream",value:function(){var r=R(b().mark(function i(a){var n,u,h,o,d=arguments;return b().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(n=d.length>1&&d[1]!==void 0?d[1]:!0,u=this.currentStream,u){m.next=4;break}return m.abrupt("return");case 4:if(h=u.currentAudioStream,!(!h||h.id===a||u.audioStreams.length<2)){m.next=7;break}return m.abrupt("return");case 7:if(o=u.audioStreams.find(function(f){return f.id===a}),o){m.next=10;break}return m.abrupt("return");case 10:return m.prev=10,m.next=13,this._clear();case 13:if(!n){m.next=16;break}return m.next=16,this._bufferService.clearAllBuffer();case 16:m.next=21;break;case 18:throw m.prev=18,m.t0=m.catch(10),this._emitError(G.create(m.t0));case 21:if(u.currentAudioStream=o,m.prev=22,!(this.isLive||!o.segments.length)){m.next=26;break}return m.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,m.next=30,this._loadSegmentDirect();case 30:m.next=36;break;case 32:throw m.prev=32,m.t1=m.catch(22),u.currentAudioStream=h,m.t1;case 36:return this._startTick(),m.abrupt("return",o);case 38:case"end":return m.stop()}},i,this,[[10,18],[22,32]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchSubtitleStream",value:function(){var r=R(b().mark(function i(a){return b().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._playlist.switchSubtitle(a),u.next=3,this._manifestLoader.stopPoll();case 3:return u.next=5,this._refreshM3U8();case 5:case"end":return u.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=R(b().mark(function i(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.media){n.next=2;break}return n.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),n.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return n.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadM3U8",value:function(){var r=R(b().mark(function i(a){var n,u,h,o;return b().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,this._manifestLoader.load(a);case 3:u=v.sent,h=X(u,1),n=h[0],v.next=11;break;case 8:throw v.prev=8,v.t0=v.catch(0),this._emitError(G.create(v.t0));case 11:if(n){v.next=13;break}return v.abrupt("return");case 13:if(this._playlist.upsertPlaylist(n),!n.isMaster){v.next=18;break}return(o=this._playlist.currentStream.subtitleStreams)!==null&&o!==void 0&&o.length&&this.emit(I.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),v.next=18,this._refreshM3U8();case 18:return this.emit(I.STREAM_PARSED),v.abrupt("return",n);case 20:case"end":return v.stop()}},i,this,[[0,8]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_refreshM3U8",value:function(){var e,i,a=this,n=this._playlist.currentStream;if(!n||!n.url)throw this._emitError(G.create(null,null,new Error("m3u8 url is not defined")));var u=n.url,h=(e=n.currentAudioStream)===null||e===void 0?void 0:e.url,o=(i=n.currentSubtitleStream)===null||i===void 0?void 0:i.url;return this._manifestLoader.load(u,h,o).then(function(d){var v=X(d,3),m=v[0],f=v[1],y=v[2];m&&(a._playlist.upsertPlaylist(m,f,y),a.isLive&&a._pollM3U8(u,h,o))}).catch(function(d){throw a._emitError(G.create(d))})}},{key:"_pollM3U8",value:function(e,i,a){var n=this,u,h=this._playlist.isEmpty;this._manifestLoader.poll(e,i,a,function(o,d,v){n._playlist.upsertPlaylist(o,d,v),n._playlist.clearOldSegment(),o&&h&&!n._playlist.isEmpty&&n._loadSegment(),h&&(h=n._playlist.isEmpty)},function(o){n._emitError(G.create(o))},(((u=this._playlist.lastSegment)===null||u===void 0?void 0:u.duration)||0)*1e3)}},{key:"_loadSegmentDirect",value:function(){var r=R(b().mark(function i(){var a,n,u;return b().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=this._playlist.nextSegment,a){o.next=3;break}return o.abrupt("return");case 3:return n=!1,u=null,o.prev=5,this._segmentProcessing=!0,o.next=9,this._reqAndBufferSegment(a,this._playlist.getAudioSegment(a));case 9:n=o.sent,o.next=15;break;case 12:o.prev=12,o.t0=o.catch(5),u=o.t0;case 15:return o.prev=15,this._segmentProcessing=!1,o.finish(15);case 18:if(!u){o.next=20;break}return o.abrupt("return",this._emitError(G.create(u)));case 20:return n&&(this._urlSwitching&&(this._urlSwitching=!1,this.emit(I.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),a.isLast?this._end():this._loadSegment()),o.abrupt("return",n);case 22:case"end":return o.stop()}},i,this,[[5,12,15,18]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"_reqAndBufferSegment",value:function(){var r=R(b().mark(function i(a,n){var u,h,o,d,v,m,f,y;return b().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return h=a?a.cc:n.cc,o=this._prevSegCc!==h,d=[],E.prev=3,E.next=6,this._segmentLoader.load(a,n,o);case 6:d=E.sent,E.next=14;break;case 9:throw E.prev=9,E.t0=E.catch(3),E.t0.fatal=!1,this._segmentLoader.error=E.t0,E.t0;case 14:if(d[0]){E.next=16;break}return E.abrupt("return");case 16:return E.next=18,(u=this._bufferService).decryptBuffer.apply(u,xe(d));case 18:if(v=E.sent,v){E.next=21;break}return E.abrupt("return");case 21:return m=a?a.sn:n.sn,f=a?a.start:n.start,y=this._playlist.currentStream,this._bufferService.createSource(v[0],v[1],y==null?void 0:y.videoCodec,y==null?void 0:y.audioCodec),E.next=27,this._bufferService.appendBuffer(a,n,v[0],v[1],o,this._prevSegSn===m-1,f);case 27:return E.next=29,this._bufferService.evictBuffer(this.config.bufferBehind);case 29:return this._prevSegCc=h,this._prevSegSn=m,E.abrupt("return",!0);case 32:case"end":return E.stop()}},i,this,[[3,9]])}));function e(i,a){return r.apply(this,arguments)}return e}()},{key:"_checkStreamTrackChange",value:function(e){var i=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);i&&this.switchURL(this.config.url,i.start+.2)}},{key:"_clear",value:function(){var r=R(b().mark(function i(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),n.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return n.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_reset",value:function(){var r=R(b().mark(function i(){var a,n=arguments;return b().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return a=n.length>0&&n[0]!==void 0?n[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this._stats.reset(),h.next=11,this._clear();case 11:return h.abrupt("return",this._bufferService.reset(a));case 12:case"end":return h.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),this.media.readyState<=2&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((i=e.originError)===null||i===void 0?void 0:i.fatal)===!1)J.warn(e);else{var n,u;J.table(e),J.error(e),J.error((n=this.media)===null||n===void 0?void 0:n.error),(u=this.media)!==null&&u!==void 0&&u.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(I.SWITCH_URL_FAILED,e)),this.emit(I.ERROR,e),a&&this._end(),this._seiService.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,i=e.currentTime;if(!e.paused){var a,n=this._playlist.findSegmentIndexByTime(e.currentTime),u=this._playlist.getSegmentByIndex(n),h=(a=this._stats)===null||a===void 0?void 0:a.getStats().downloadSpeed;if(h&&u){var o=u.duration*this._playlist.currentStream.bitrate/h+1;i+=o}else i+=5}return i}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?Y.isSupported():typeof WebAssembly!="undefined"}},{key:"enableLogger",value:function(){ae.enable(),be.enable()}},{key:"disableLogger",value:function(){ae.disable(),be.disable()}}]),t}(Be);c(re,"version","3.0.5");try{localStorage.getItem("xgd")?re.enableLogger():re.disableLogger()}catch(l){}var Tt=function(){function l(s,t){var r=this;$(this,l),c(this,"_opts",null),c(this,"_plugin",null),c(this,"_onLowDecode",function(){var e,i,a,n,u=r._opts,h=u.media,o=u.innerDegrade;(e=r._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",h.degradeInfo),(a=r._plugin)===null||a===void 0||(n=a.player)===null||n===void 0||n.emit("core_event",U(U({},h.degradeInfo),{},{eventName:I.LOWDECODE})),o===1&&r._degrade(h.src)}),c(this,"_degrade",function(e){var i=r._plugin.player,a=i.video;if(!(a&&a.TAG!=="MVideo")){var n=i.video.degradeVideo;i.video=n,a.degrade(e),e&&(i.config.url=e);var u=i.root.firstChild;u.TAG==="MVideo"&&i.root.replaceChild(n,u);var h=r._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(h),i.once("canplay",function(){i.play()})}}),c(this,"forceDegradeToVideo",function(e){var i=r._opts.innerDegrade;i===1&&r._degrade(e)}),this._opts=s,this._plugin=t,this._init()}return V(l,[{key:"_init",value:function(){var t=this._opts,r=t.media,e=t.preloadTime,i=t.innerDegrade,a=t.isLive;if(r){if(!a&&r.setPlayMode){r.setPlayMode("VOD");return}i&&r.setAttribute("innerdegrade",i),e&&r.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var t=this._opts.media;t.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var t,r;(t=this._opts)===null||t===void 0||(r=t.media)===null||r===void 0||r.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),l}();function At(l,s){var t=s.player,r=t.currentTime,e={startTime:r};switch(oe(l)){case"boolean":e.seamless=l;break;case"object":Object.assign(e,l);break}return e}var Me=function(l){fe(t,l);var s=de(t);function t(){var r;$(this,t);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return r=s.call.apply(s,[this].concat(i)),c(A(r),"hls",null),c(A(r),"pluginExtension",null),c(A(r),"getStats",function(){var n;return(n=r.hls)===null||n===void 0?void 0:n.getStats()}),c(A(r),"_onSwitchSubtitle",function(n){var u,h=n.lang;(u=r.hls)===null||u===void 0||u.switchSubtitleStream(h)}),c(A(r),"_onSwitchURL",function(n,u){var h=A(r),o=h.player,d=h.hls;if(d){var v,m,f=At(u,A(r));o.config.url=n,d.switchURL(n,f).catch(function(y){}),!f.seamless&&(v=r.player.config)!==null&&v!==void 0&&(m=v.hls)!==null&&m!==void 0&&m.keepStatusAfterSwitch&&r._keepPauseStatus()}}),c(A(r),"_keepPauseStatus",function(){var n=r.player.paused;n&&r.player.once("canplay",function(){r.player.pause()})}),r}return V(t,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,a=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!a&&a!=="video"&&a!=="audio"}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config;if(!(!i.url&&!i.__allowHlsEmptyUrl__)){this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL;var a=i.hls||{};if(a.innerDegrade=a.innerDegrade||i.innerDegrade,(a.disconnectTime===null||a.disconnectTime===void 0)&&(a.disconnectTime=0),this.hls=new re(U({softDecode:this.softDecode,isLive:i.isLive,media:this.player.media||this.player.video,startTime:i.startTime,url:i.url},a)),this.softDecode||_e.defineGetterOrSetter(this.player,{url:{get:function(){var h,o;return(h=e.hls)===null||h===void 0||(o=h.media)===null||o===void 0?void 0:o.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Tt(U({isLive:i.isLive,media:this.player.video},a),this),this.player.forceDegradeToVideo=function(){for(var u,h=arguments.length,o=new Array(h),d=0;d<h;d++)o[d]=arguments[d];return(u=e.pluginExtension)===null||u===void 0?void 0:u.forceDegradeToVideo.apply(u,o)}),i.isLive){var n;(n=this.player)===null||n===void 0||n.useHooks("replay",function(){var u;return(u=e.hls)===null||u===void 0?void 0:u.replay()})}this.on(Ne,this._onSwitchSubtitle),this.on($e,this._onSwitchURL),this.on(Ve,this.destroy.bind(this)),this._transError(),this._transCoreEvent(O.TTFB),this._transCoreEvent(O.LOAD_START),this._transCoreEvent(O.LOAD_RESPONSE_HEADERS),this._transCoreEvent(O.LOAD_COMPLETE),this._transCoreEvent(O.LOAD_RETRY),this._transCoreEvent(O.SOURCEBUFFER_CREATED),this._transCoreEvent(O.REMOVE_BUFFER),this._transCoreEvent(O.BUFFEREOS),this._transCoreEvent(O.KEYFRAME),this._transCoreEvent(O.METADATA_PARSED),this._transCoreEvent(O.DEMUXED_TRACK),this._transCoreEvent(O.SEI),this._transCoreEvent(O.SEI_IN_TIME),this._transCoreEvent(O.SPEED),this._transCoreEvent(O.HLS_MANIFEST_LOADED),this._transCoreEvent(O.HLS_LEVEL_LOADED),this._transCoreEvent(O.STREAM_EXCEPTION),this._transCoreEvent(O.SWITCH_URL_SUCCESS),this._transCoreEvent(O.SWITCH_URL_FAILED),this._transCoreEvent(I.NO_AUDIO_TRACK),this._transCoreEvent(I.STREAM_PARSED),this._transCoreEvent(I.SUBTITLE_SEGMENTS),this._transCoreEvent(I.SUBTITLE_PLAYLIST),i.url&&this.hls.load(i.url,!0).catch(function(u){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(I.ERROR,function(i){e.player&&e.player.emit(Ge,new Fe(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.hls.on(e,function(a){i.player&&(i.player.emit("core_event",U(U({},a),{},{eventName:e})),e===O.SEI_IN_TIME&&i.hls.hasSubtitle&&i._emitSeiPaylodTime(a))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var i=JSON.parse(Array.from(e.data.payload).map(function(a){return String.fromCharCode(a)}).join("").slice(0,-1));if(!i.rtmp_dts)return;this.player.emit("core_event",{eventName:I.SEI_PAYLOAD_TIME,time:i.rtmp_dts})}catch(a){}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,i){return re.isSupported(e,i)}}]),t}(_e);c(Me,"Hls",re);c(Me,"EVENT",I);export{Me as H};

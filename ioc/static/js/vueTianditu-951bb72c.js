var h=(C,B,v)=>new Promise((x,O)=>{var D=L=>{try{I(v.next(L))}catch(s){O(s)}},E=L=>{try{I(v.throw(L))}catch(s){O(s)}},I=L=>L.done?x(L.value):Promise.resolve(L.value).then(D,E);I((v=v.apply(C,B)).next())});import{c as hn}from"./lodash-f91682a1.js";import{r as vn}from"./vuedraggable-26823587.js";var G={exports:{}},K={},De;function wn(){return De||(De=1,function(C){var B=vn;Object.keys(B).forEach(function(v){C[v]=B[v]}),C.set=function(v,x,O){return Array.isArray(v)?(v.length=Math.max(v.length,x),v.splice(x,1,O),O):(v[x]=O,O)},C.del=function(v,x){if(Array.isArray(v)){v.splice(x,1);return}delete v[x]},C.Vue=B,C.Vue2=void 0,C.isVue2=!1,C.isVue3=!0,C.install=function(){}}(K)),K}(function(C,B){var v=Object.defineProperty,x=Object.defineProperties,O=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,L=(m,a,f)=>a in m?v(m,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):m[a]=f,s=(m,a)=>{for(var f in a||(a={}))E.call(a,f)&&L(m,f,a[f]);if(D)for(var f of D(a))I.call(a,f)&&L(m,f,a[f]);return m},j=(m,a)=>x(m,O(a)),Ie=(m,a)=>{var f={};for(var k in m)E.call(m,k)&&a.indexOf(k)<0&&(f[k]=m[k]);if(m!=null&&D)for(var k of D(m))a.indexOf(k)<0&&I.call(m,k)&&(f[k]=m[k]);return f};(function(m,a){a(B,wn())})(hn,function(m,a){function f({events:e,emit:o,instance:t,emitted:n,extData:i}){e instanceof Object&&(e=Object.keys(e)),e.forEach(l=>{t.addEventListener(l,c=>{o(l,j(s({},c),{extData:i})),n==null||n(l)})})}const k={v:"4.0",tk:"",plugins:[]},je={D3:["https://cdn.bootcss.com/d3/3.5.17/d3.min.js","http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/D3SvgOverlay.min.js"],CarTrack:["https://cdn.bootcss.com/d3/3.5.17/d3.min.js","http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/D3SvgOverlay.min.js","http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/CarTrack.min.js"],HeatmapOverlay:["http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/HeatmapOverlay.min.js"],BufferTool:["https://cdn.bootcss.com/Turf.js/3.0.14/turf.js","http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/BufferTool.min.js"],ImageOverLayer:["http://lbs.tianditu.gov.cn/api/js4.0/opensource/openlibrary/ImageOverlay.min.js"]};let U=!1;function F(){return h(this,arguments,function*(e={}){if(U)return new Promise(o=>{setTimeout(()=>o(F(e)))});if(!globalThis.T){U=!0;const{v:o,tk:t,plugins:n}=s(s({},k),e);yield H(`https://api.tianditu.gov.cn/api?v=${o}&tk=${t}`),yield Promise.all(n.map(i=>je[i]).flat().map(i=>H(i))),U=!1}})}function H(e){return new Promise((o,t)=>{var n,i;const l=(n=globalThis.document)==null?void 0:n.createElement("script");l||o(),l.src=e,l.type="text/javascript",l.async=!0,l.defer=!0,l.onload=()=>o(),l.onerror=c=>o(),(i=globalThis.document)==null||i.body.appendChild(l)})}function w(){return new Promise(e=>{const o=a.inject("mapRoot"),t=a.inject("mapEmitter");o!=null&&o.value?e(o==null?void 0:o.value):t==null||t.on("mapInit",n);function n(i){t==null||t.off("mapInit",n),e(i)}})}function q(e){return{all:e=e||new Map,on:function(o,t){var n=e.get(o);n?n.push(t):e.set(o,[t])},off:function(o,t){var n=e.get(o);n&&(t?n.splice(n.indexOf(t)>>>0,1):e.set(o,[]))},emit:function(o,t){var n=e.get(o);n&&n.slice().map(function(i){i(t)}),(n=e.get("*"))&&n.slice().map(function(i){i(o,t)})}}}const Ze={icon:{type:[String,Object]},draggable:{type:Boolean,default:!1},title:{type:String,default:""},zIndexOffset:{type:Number,default:0},opacity:{type:Number,default:1}},Ae={position:{type:Array,default:()=>[0,0]},visible:{type:Boolean,default:!0},extData:{type:void 0}},Y={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,dragstart:()=>!0,drag:()=>!0,dragend:()=>!0,remove:()=>!0},Ee={init:e=>e instanceof T.Marker},Fe=s(s({},Ze),Ae),Re=s(s({},Y),Ee);function J(e){const{draggable:o,title:t,zIndexOffset:n,opacity:i,position:l}=e;return new T.Marker(b(l),{draggable:o,title:t,zIndexOffset:n,opacity:i})}function Ue({props:e,instance:o}){a.watch(()=>e.position,t=>t&&o.setLngLat(b(t))),a.watch(()=>e.draggable,t=>t?o.enableDragging():o.disableDragging()),a.watch(()=>e.icon,t=>t&&o.setIcon(R(t)),{immediate:!0}),a.watch(()=>e.zIndexOffset,t=>t&&o.setZIndexOffset(t),{immediate:!0}),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const b=e=>{const[o,t]=e;return new T.LngLat(o,t)},S=e=>e.map(o=>{const[t,n]=o;return new T.LngLat(t,n)}),z=e=>{const[[o,t],[n,i]]=e;return new T.LngLatBounds(new T.LngLat(o,t),new T.LngLat(n,i))},M=e=>{const[o,t]=e;return new T.Point(o,t)},Q=e=>{const o={};return Object.keys(e).forEach(t=>{e[t]!==void 0&&(o[t]=e[t])}),o},R=e=>{if(typeof e=="string")return new T.Icon({iconUrl:e});{const{iconUrl:o,iconSize:t,iconAnchor:n}=e,i={iconUrl:o,iconSize:t&&M(t),iconAnchor:n&&M(n)};return new T.Icon(Q(i))}},_=e=>{const o=J(e);return e.icon&&o.setIcon(R(e.icon)),o.extData=e.extData,o};q();function _e(e,o){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");o=o!=null?o:t.length;let n=[];return e?n=new Array(e).fill(0).map(()=>t[0|Math.random()*o]):(e=36,n=new Array(e).fill(0).map((i,l)=>{const c=0|Math.random()*16;return t[l==19?c&3|8:c]}),n[8]=n[13]=n[18]=n[23]="-",n[14]="4"),n.join("")}function We(e,o=500,t=!1){let n;return function(...i){const l=this;if(n&&clearTimeout(n),t){const c=!n;n=setTimeout(function(){n=void 0},o),c&&e.apply(l,i)}else n=setTimeout(function(){e.apply(l,i)},o)}}const Ve=e=>e?Object.entries(e).reduce((o,[t,n])=>(t=t.charAt(0).toUpperCase()+t.slice(1),t=`on${t}`,j(s({},o),{[t]:n})),{}):null,u=(e,o,t)=>{if(a.isVue2)return a.h(e,o,t);const n=o!=null?o:{},{attrs:i,props:l,domProps:c,on:r,scopedSlots:p}=n,y=Ie(n,["attrs","props","domProps","on","scopedSlots"]),d=Ve(r),g=s(s(s(s(s({},y!=null?y:{}),i!=null?i:{}),l!=null?l:{}),c!=null?c:{}),d!=null?d:{});return a.h(e,g,p||t)},$e=(e,o)=>typeof e=="function"?e(o):e;function X(e){return{mousewheel:o=>o.stopPropagation(),click:o=>{o.stopPropagation(),e!=null&&e.isDoubleClickZoom()&&(e==null||e.disableDoubleClickZoom(),setTimeout(()=>e==null?void 0:e.enableDoubleClickZoom(),300))},mousemove:o=>{o.stopPropagation(),e!=null&&e.isDrag()&&(e==null||e.disableDrag(),setTimeout(()=>e==null?void 0:e.enableDrag(),300))}}}const Ke={projection:{type:String,default:"EPSG:900913"},minZoom:{type:Number,default:1},maxZoom:{type:Number,default:18},center:{type:Array,default:()=>[0,0]},zoom:{type:Number,default:1}},Ge={drag:{type:Boolean,default:!0},scrollWheelZoom:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},inertia:{type:Boolean,default:!0},continuousZoom:{type:Boolean,default:!0},pinchToZoom:{type:Boolean,default:!0},autoResize:{type:Boolean,default:!0},maxBounds:{type:Array},viewport:{type:Array},mapStyle:{type:String},mid:{type:String,default:()=>_e()},controls:{type:Array,default:()=>[]},loadConfig:{type:Object}},ee={click:()=>!0,dblclick:()=>!0,contextmenu:()=>!0,mousemove:()=>!0,mouseover:()=>!0,mouseout:()=>!0,movestart:()=>!0,move:()=>!0,moveend:()=>!0,zoomstart:()=>!0,zoomend:()=>!0,addoverlay:()=>!0,removeoverlay:()=>!0,addcontrol:()=>!0,removecontrol:()=>!0,clearoverlays:()=>!0,dragstart:()=>!0,drag:()=>!0,dragend:()=>!0,layeradd:()=>!0,layerremove:()=>!0,load:()=>!0,resize:()=>!0,levels:()=>!0,touchstart:()=>!0,touchmove:()=>!0,touchend:()=>!0,longpress:()=>!0},He={init:e=>e instanceof T.Map,viewchange:e=>!0},qe=s(s({},Ke),Ge),Ye=s(s({},ee),He);function Je(e,o){const{mid:t,projection:n,minZoom:i,maxZoom:l,center:c,zoom:r}=e,p=new T.Map(o!=null?o:t,{projection:n,minZoom:i,maxZoom:l,center:b(c),zoom:r});return p.centerAndZoom(b(c),r),p}function Qe({props:e,instance:o}){a.watch(()=>({center:e.center,zoom:e.zoom}),t=>{!t.center||!t.zoom||o.panTo(b(t.center),t.zoom)}),a.watch(()=>e.drag,t=>t?o.enableDrag():o.disableDrag(),{immediate:!0}),a.watch(()=>e.scrollWheelZoom,t=>t?o.enableScrollWheelZoom():o.disableScrollWheelZoom(),{immediate:!0}),a.watch(()=>e.doubleClickZoom,t=>t?o.enableDoubleClickZoom():o.disableDoubleClickZoom(),{immediate:!0}),a.watch(()=>e.keyboard,t=>t?o.enableKeyboard():o.disableKeyboard(),{immediate:!0}),a.watch(()=>e.inertia,t=>t?o.enableInertia():o.disableInertia(),{immediate:!0}),a.watch(()=>e.continuousZoom,t=>t?o.enableContinuousZoom():o.disableContinuousZoom(),{immediate:!0}),a.watch(()=>e.pinchToZoom,t=>t?o.enablePinchToZoom():o.disablePinchToZoom(),{immediate:!0}),a.watch(()=>e.autoResize,t=>t?o.enableAutoResize():o.disableAutoResize(),{immediate:!0}),a.watch(()=>e.minZoom,t=>t&&o.setMinZoom(t)),a.watch(()=>e.maxZoom,t=>t&&o.setMaxZoom(t),{immediate:!0}),a.watch(()=>e.maxBounds,t=>t&&o.setMaxBounds(z(t)),{immediate:!0}),a.watch(()=>e.viewport,t=>t&&o.setViewport(t==null?void 0:t.map(n=>b(n))),{immediate:!0}),a.watch(()=>e.mapStyle,t=>t?o.setStyle(t):o.removeStyle(),{immediate:!0})}function Xe(e,o,t){var n;(n=e.controls)==null||n.forEach(c=>{typeof c=="string"?i(c):typeof c=="object"&&l(c)});function i(c){const r=c;if(!T.Control[r]){setTimeout(()=>i(c));return}const p=new T.Control[r];r==="OverviewMap"&&p.addEventListener("viewchange",y=>t("viewchange",y)),o.addControl(p)}function l(c){var r,p;const y=c.name;if(!T.Control[y]){setTimeout(()=>l(c));return}switch(y){case"MapType":{const d=(r=c.mapTypes)==null?void 0:r.map(P=>j(s({},P),{layer:window[P.layer]})),g=new T.Control.MapType(d);c.position&&g.setPosition(c.position),o.addControl(g)}break;case"OverviewMap":{const d=new T.Control.OverviewMap(c);d.addEventListener("viewchange",g=>t("viewchange",g)),o.addControl(d)}break;case"Copyright":{const d=new T.Control.Copyright({position:c.position||"bottomleft"});o.addControl(d),d.addCopyright(j(s({},c),{bounds:(p=c.bounds)!=null&&p.length?z(c.bounds):void 0}))}break;default:{const d=new T.Control[y](c);o.addControl(d)}break}}}const te=a.defineComponent({name:"TdtMap",props:qe,emits:Ye,setup(e,{emit:o,slots:t}){const n=a.ref(),i=q();a.provide("mapRoot",n),a.provide("mapEmitter",i);const l=u("div",{class:"tdt-map",style:"width:100%;height:100%",attrs:{id:e.mid}});return a.onMounted(()=>h(this,null,function*(){yield F(e.loadConfig),n.value=Je(e,l.el||l.elm),f({events:ee,emit:o,instance:n.value}),Qe({props:e,instance:n.value}),Xe(e,n.value,o),o("init",n.value),i.emit("mapInit",n.value)})),()=>{var c;return u("div",{class:"tdt-map-container",style:"width:100%;height:100%"},[l,(c=t.default)==null?void 0:c.call(t)])}}}),et={position:{type:String,default:"topright"}},tt={offset:{type:Array},visible:{type:Boolean,default:!0}},oe={},ot={init:e=>e instanceof T.Control},nt=s(s({},et),tt),at=s(s({},oe),ot);function it(e){const{position:o}=e;return new T.Control({position:o})}function lt({props:e,instance:o}){a.watch(()=>e.position,t=>t&&o.setPosition(t)),a.watch(()=>e.offset,t=>t&&o.setOffset(M(t)),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const ne=a.defineComponent({name:"TdtControl",props:nt,emits:at,setup(e,{emit:o,slots:t}){let n=u("div");return a.onMounted(()=>h(this,null,function*(){a.onUnmounted(()=>l&&(i==null?void 0:i.removeControl(l)));const i=yield w(),l=it(e);l.onAdd=()=>n.el||n.elm,l.onRemove=()=>{},i.addControl(l),f({events:oe,emit:o,instance:l}),lt({props:e,instance:l}),o("init",l)})),()=>{var i;return n=u("div",{class:"tdt-control-custom"},(i=t.default)==null?void 0:i.call(t)),n}}}),st={markTool:{type:Object,default:()=>({})},polygonTool:{type:Object,default:()=>({})},polylineTool:{type:Object,default:()=>({})},rectangleTool:{type:Object,default:()=>({})},circleTool:{type:Object,default:()=>({})},paintBrushTool:{type:Object,default:()=>({})}},rt={},ct={"mark-mouseup":()=>!0,"polygon-draw":()=>!0,"polygon-addpoint":()=>!0,"polyline-draw":()=>!0,"polyline-addpoint":()=>!0,"rectangle-draw":()=>!0,"circle-draw":()=>!0,"circle-drawend":()=>!0},ut={init:e=>e.markTool instanceof T.MarkTool&&e.polygonTool instanceof T.PolygonTool&&e.polylineTool instanceof T.PolylineTool&&e.rectangleTool instanceof T.RectangleTool&&e.circleTool instanceof T.CircleTool&&e.paintBrushTool instanceof T.PaintBrushTool},pt=s(s({},st),rt),dt=s(s({},ct),ut);function mt(e,o){const{markTool:t,polygonTool:n,polylineTool:i,rectangleTool:l,circleTool:c,paintBrushTool:r}=e,p={};return t.icon?p.markTool=new T.MarkTool(o,{icon:R(t.icon),follow:t.follow}):p.markTool=new T.MarkTool(o,{follow:t.follow}),p.polygonTool=new T.PolygonTool(o,n),p.polylineTool=new T.PolylineTool(o,i),p.rectangleTool=new T.RectangleTool(o,l),p.circleTool=new T.CircleTool(o,c),p.paintBrushTool=new T.PaintBrushTool(o,{keepdrawing:r.keepdrawing,style:s({},r||{})}),p}function yt({props:e,instances:o}){a.watch(()=>{var t;return(t=e.markTool)==null?void 0:t.icon},t=>{var n,i;!t||(typeof t=="string"?(n=o.markTool)==null||n.setPointImage(t):t!=null&&t.iconUrl&&((i=o.markTool)==null||i.setPointImage(t==null?void 0:t.iconUrl)))})}function ft({emit:e,instances:o}){var t,n,i,l,c,r,p,y;(t=o.markTool)==null||t.addEventListener("mouseup",d=>e("mark-mouseup",d)),(n=o.polygonTool)==null||n.addEventListener("draw",d=>e("polygon-draw",d)),(i=o.polygonTool)==null||i.addEventListener("addpoint",d=>e("polygon-draw",d)),(l=o.polylineTool)==null||l.addEventListener("draw",d=>e("polyline-draw",d)),(c=o.polylineTool)==null||c.addEventListener("addpoint",d=>e("polyline-addpoint",d)),(r=o.rectangleTool)==null||r.addEventListener("draw",d=>e("rectangle-draw",d)),(p=o.circleTool)==null||p.addEventListener("draw",d=>e("circle-draw",d)),(y=o.circleTool)==null||y.addEventListener("drawend",d=>e("circle-drawend",d))}const ae=a.defineComponent({name:"TdtMousetool",props:pt,emits:dt,setup(e,{emit:o,expose:t}){return a.onBeforeMount(()=>h(this,null,function*(){var n;if(a.onUnmounted(()=>y()),t==null||t({open:c,close:r,clear:p,clearAll:y}),a.isVue2){const d=(n=a.getCurrentInstance())==null?void 0:n.proxy;d.open=c,d.close=r,d.clear=p,d.clearAll=y}const i=yield w(),l=mt(e,i);ft({emit:o,instances:l}),yt({props:e,instances:l}),o("init",l);function c(d){var g;(g=l[d])==null||g.open()}function r(d){var g;(g=l[d])==null||g.close()}function p(d){var g;try{(g=l[d])==null||g.clear()}catch(P){console.error(P)}}function y(){Object.keys(l).forEach(d=>{r(d),p(d)})}})),()=>{}}}),N=a.defineComponent({name:"TdtMarker",props:Fe,emits:Re,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=J(e);t.addOverLay(n),f({events:Y,emit:o,instance:n,extData:e.extData}),Ue({props:e,instance:n}),o("init",n)})),()=>{}}}),gt={text:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},position:{type:Array,default:()=>[0,0]}},ht={title:{type:String},zIndex:{type:Number},fontSize:{type:Number},fontColor:{type:String},backgroundColor:{type:String},borderLine:{type:Number},borderColor:{type:String},opacity:{type:Number},visible:{type:Boolean,default:!0},extData:{type:void 0}},ie={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,remove:()=>!0},vt={init:e=>e instanceof T.Label},wt=s(s({},gt),ht),bt=s(s({},ie),vt);function Tt(e){const{position:o,offset:t,text:n}=e;return new T.Label({position:b(o),offset:M(t),text:n})}function Ct({props:e,instance:o}){a.watch(()=>e.position,t=>t&&o.setLngLat(b(t))),a.watch(()=>e.text,t=>t&&o.setLabel(t)),a.watch(()=>e.offset,t=>t&&o.setOffset(M(t))),a.watch(()=>e.title,t=>t&&o.setTitle(t),{immediate:!0}),a.watch(()=>e.zIndex,t=>t&&o.setZIndex(t),{immediate:!0}),a.watch(()=>e.fontSize,t=>t&&o.setFontSize(t),{immediate:!0}),a.watch(()=>e.fontColor,t=>t&&o.setFontColor(t),{immediate:!0}),a.watch(()=>e.backgroundColor,t=>t&&o.setBackgroundColor(t),{immediate:!0}),a.watch(()=>e.borderLine,t=>t&&o.setBorderLine(t),{immediate:!0}),a.watch(()=>e.borderColor,t=>t&&o.setBorderColor(t),{immediate:!0}),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const le=a.defineComponent({name:"TdtLabel",props:wt,emits:bt,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=Tt(e);t.addOverLay(n),f({events:ie,emit:o,instance:n,extData:e.extData}),Ct({props:e,instance:n}),o("init",n)})),()=>{}}}),kt={color:{type:String,default:"#0000ff"},weight:{type:Number,default:3},opacity:{type:Number,default:.5},lineStyle:{type:String,default:"solid"}},St={edit:{type:Boolean,default:!1},path:{type:Array,default:()=>[]},visible:{type:Boolean,default:!0},extData:{type:void 0}},se={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,remove:()=>!0},xt={init:e=>e instanceof T.Polyline},Lt=s(s({},kt),St),Mt=s(s({},se),xt);function Pt(e){const{path:o,color:t,weight:n,opacity:i,lineStyle:l}=e;return new T.Polyline(S(o),{color:t,weight:n,opacity:i,lineStyle:l})}function Ot({props:e,instance:o}){a.watch(()=>e.path,t=>t&&o.setLngLats(S(t))),a.watch(()=>e.color,t=>t&&o.setColor(t)),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.weight,t=>t&&o.setWeight(t)),a.watch(()=>e.lineStyle,t=>t&&o.setLineStyle(t)),a.watch(()=>e.edit,t=>t?o.enableEdit():o.disableEdit(),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const A=a.defineComponent({name:"TdtPolyline",props:Lt,emits:Mt,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=Pt(e);t.addOverLay(n),f({events:se,emit:o,instance:n,extData:e.extData}),Ot({props:e,instance:n}),o("init",n)})),()=>{}}}),Bt={color:{type:String,default:"#0000ff"},weight:{type:Number,default:3},opacity:{type:Number,default:.5},lineStyle:{type:String,default:"solid"},fillColor:{type:String,default:"#0000ff"},fillOpacity:{type:Number,default:.2}},zt={edit:{type:Boolean,default:!1},path:{type:Array,default:()=>[]},visible:{type:Boolean,default:!0},extData:{type:void 0}},re={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,remove:()=>!0},Nt={init:e=>e instanceof T.Polygon},Dt=s(s({},Bt),zt),It=s(s({},re),Nt);function jt(e){const{path:o,color:t,weight:n,opacity:i,lineStyle:l,fillColor:c,fillOpacity:r}=e;return new T.Polygon(S(o),{color:t,weight:n,opacity:i,lineStyle:l,fillColor:c,fillOpacity:r})}function Zt({props:e,instance:o}){a.watch(()=>e.path,t=>t&&o.setLngLats(S(t))),a.watch(()=>e.color,t=>t&&o.setColor(t)),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.weight,t=>t&&o.setWeight(t)),a.watch(()=>e.lineStyle,t=>t&&o.setLineStyle(t)),a.watch(()=>e.fillColor,t=>t&&o.setFillColor(t)),a.watch(()=>e.fillOpacity,t=>t&&o.setFillOpacity(t)),a.watch(()=>e.edit,t=>t?o.enableEdit():o.disableEdit(),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const ce=a.defineComponent({name:"TdtPolygon",props:Dt,emits:It,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=jt(e);t.addOverLay(n),f({events:re,emit:o,instance:n,extData:e.extData}),Zt({props:e,instance:n}),o("init",n)})),()=>{}}}),At={color:{type:String,default:"#0000ff"},weight:{type:Number,default:3},opacity:{type:Number,default:.5},lineStyle:{type:String,default:"solid"},fillColor:{type:String,default:"#0000ff"},fillOpacity:{type:Number,default:.2}},Et={edit:{type:Boolean,default:!1},bounds:{type:Array,default:()=>[]},visible:{type:Boolean,default:!0},extData:{type:void 0}},ue={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,remove:()=>!0},Ft={init:e=>e instanceof T.Rectangle},Rt=s(s({},At),Et),Ut=s(s({},ue),Ft);function _t(e){const{bounds:o,color:t,weight:n,opacity:i,lineStyle:l,fillColor:c,fillOpacity:r}=e;return new T.Rectangle(z(o),{color:t,weight:n,opacity:i,lineStyle:l,fillColor:c,fillOpacity:r})}function Wt({props:e,instance:o}){a.watch(()=>e.bounds,t=>t&&o.setBounds(z(t))),a.watch(()=>e.color,t=>t&&o.setColor(t)),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.weight,t=>t&&o.setWeight(t)),a.watch(()=>e.lineStyle,t=>t&&o.setLineStyle(t)),a.watch(()=>e.fillColor,t=>t&&o.setFillColor(t)),a.watch(()=>e.fillOpacity,t=>t&&o.setFillOpacity(t)),a.watch(()=>e.edit,t=>t?o.enableEdit():o.disableEdit(),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const pe=a.defineComponent({name:"TdtRectangle",props:Rt,emits:Ut,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=_t(e);t.addOverLay(n),f({events:ue,emit:o,instance:n,extData:e.extData}),Wt({props:e,instance:n}),o("init",n)})),()=>{}}}),Vt={color:{type:String,default:"#0000ff"},weight:{type:Number,default:3},opacity:{type:Number,default:.5},lineStyle:{type:String,default:"solid"},fillColor:{type:String,default:"#0000ff"},fillOpacity:{type:Number,default:.2}},$t={edit:{type:Boolean,default:!1},center:{type:Array,default:()=>[0,0]},radius:{type:Number,default:0},visible:{type:Boolean,default:!0},extData:{type:void 0}},de={click:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,remove:()=>!0},Kt={init:e=>e instanceof T.Circle},Gt=s(s({},Vt),$t),Ht=s(s({},de),Kt);function qt(e){const{center:o,radius:t,color:n,weight:i,opacity:l,lineStyle:c,fillColor:r,fillOpacity:p}=e;return new T.Circle(b(o),t,{color:n,weight:i,opacity:l,lineStyle:c,fillColor:r,fillOpacity:p})}function Yt({props:e,instance:o}){a.watch(()=>e.center,t=>t&&o.setCenter(b(t))),a.watch(()=>e.radius,t=>t&&o.setRadius(t)),a.watch(()=>e.color,t=>t&&o.setColor(t)),a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.weight,t=>t&&o.setWeight(t)),a.watch(()=>e.lineStyle,t=>t&&o.setLineStyle(t)),a.watch(()=>e.fillColor,t=>t&&o.setFillColor(t)),a.watch(()=>e.fillOpacity,t=>t&&o.setFillOpacity(t)),a.watch(()=>e.edit,t=>t?o.enableEdit():o.disableEdit(),{immediate:!0}),a.watch(()=>e.visible,t=>t?o.show():o.hide(),{immediate:!0})}const me=a.defineComponent({name:"TdtCircle",props:Gt,emits:Ht,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeOverLay(n)));const t=yield w(),n=qt(e);t.addOverLay(n),f({events:de,emit:o,instance:n,extData:e.extData}),Yt({props:e,instance:n}),o("init",n)})),()=>{}}}),Jt={minWidth:{type:Number,default:50},maxWidth:{type:Number,default:300},maxHeight:{type:Number,default:null},autoPan:{type:Boolean,default:!1},closeButton:{type:Boolean,default:!0},offset:{type:Array,default:()=>[0,7]},autoPanPadding:{type:Array,default:()=>[5,5]},closeOnClick:{type:Boolean,default:!1}},Qt={content:{type:[String,Object,HTMLElement],default:""},target:{type:[Object,Array],default:null}},ye={close:()=>!0,open:()=>!0,clickclose:()=>!0},Xt={init:e=>e instanceof T.InfoWindow,"update:target":e=>!0},eo=s(s({},Jt),Qt),to=s(s({},ye),Xt);function oo(e,o){const{minWidth:t,maxWidth:n,maxHeight:i,autoPan:l,closeButton:c,offset:r,autoPanPadding:p,closeOnClick:y,content:d}=e;return new T.InfoWindow(o||d,{minWidth:t,maxWidth:n,maxHeight:i,autoPan:l,closeButton:c,offset:M(r),autoPanPadding:M(p),closeOnClick:y})}function no({props:e,instance:o,map:t}){a.watch(()=>e.offset,n=>n&&o.setOffset(M(n))),a.watch(()=>e.content,n=>n&&o.setContent(n)),a.watch(()=>e.target,n=>{n instanceof Array?t.openInfoWindow(o,b(n)):n?n.openInfoWindow(o):o.closeInfoWindow()},{immediate:!0})}const W=a.defineComponent({name:"TdtInfowindow",props:eo,emits:to,setup(e,{emit:o,slots:t}){const n=a.computed(()=>{var l;return u("div",{class:"tdt-infowindow-custom",style:{minWidth:e.minWidth,maxWidth:e.maxWidth,maxHeight:e.maxHeight,display:t.default&&e.target?"block":"none"}},(l=t.default)==null?void 0:l.call(t))});a.onMounted(()=>h(this,null,function*(){a.onUnmounted(()=>c==null?void 0:c.closeInfoWindow());const l=t.default?n.value.el||n.value.elm:void 0,c=yield w(),r=oo(e,l);f({events:ye,emit:o,instance:r,emitted:i}),no({props:e,instance:r,map:c}),o("init",r)}));function i(l){l==="close"&&o("update:target",null)}return()=>n.value}}),ao={ShapeType:{type:String,default:"CIRCLE"},SizeType:{type:String,default:"TINY"},color:{type:String,default:"#fa937e"}},io={lnglats:{type:Array,default:()=>[]}},fe={click:()=>!0,mouseover:()=>!0,mouseout:()=>!0},lo={init:e=>e instanceof T.CloudMarkerCollection},so=s(s({},ao),io),ro=s(s({},fe),lo);function co(e){const{ShapeType:o,SizeType:t,color:n,lnglats:i}=e;return new T.CloudMarkerCollection(S(i),{ShapeType:o,SizeType:t,color:n})}function uo({props:e,instance:o}){a.watch(()=>e.lnglats,t=>t&&o.setLnglats(S(t))),a.watch(()=>e,t=>o.setStyles(t))}const ge=a.defineComponent({name:"TdtCloudMarkerCollection",props:so,emits:ro,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>{n==null||n.clear(),n&&(t==null||t.removeOverLay(n))});const t=yield w(),n=co(e);t.addOverLay(n),f({events:fe,emit:o,instance:n}),uo({props:e,instance:n}),o("init",n)})),()=>{}}}),po={markers:{type:Array},girdSize:{type:Number},maxZoom:{type:Number},styles:{type:Array}},mo={},he={click:()=>!0,clusterclick:()=>!0,dblclick:()=>!0,mousedown:()=>!0,mouseup:()=>!0,mouseout:()=>!0,mouseover:()=>!0,dragstart:()=>!0,drag:()=>!0,dragend:()=>!0,remove:()=>!0},yo={init:e=>e instanceof T.MarkerClusterer},fo=s(s({},po),mo),go=s(s({},he),yo);function ho(e,o){const{markers:t,girdSize:n,maxZoom:i}=e,l=t==null?void 0:t.map(c=>_(c));return new T.MarkerClusterer(o,{markers:l,girdSize:n,maxZoom:i})}function vo({props:e,instance:o}){a.watch(()=>e.girdSize,t=>t&&o.setGridSize(t)),a.watch(()=>e.maxZoom,t=>t&&o.setMaxZoom(t)),a.watch(()=>e.markers,t=>{o.clearMarkers(),t!=null&&t.length&&o.addMarkers(t.map(_))}),a.watch(()=>e.styles,t=>{var n;const i=(n=t==null?void 0:t.map(l=>j(s({},l),{offset:l.offset&&M(l.offset)})))!=null?n:[];o.setStyles(i)},{immediate:!0})}const ve=a.defineComponent({name:"TdtMarkerClusterer",props:fo,emits:go,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n==null?void 0:n.clearMarkers());const t=yield w(),n=ho(e,t);f({events:he,emit:o,instance:n}),vo({props:e,instance:n}),o("init",n)})),()=>{}}}),wo={minZoom:{type:Number},maxZoom:{type:Number},errorTileUrl:{type:String},opacity:{type:Number},zIndex:{type:Number},bounds:{type:Array,default:()=>[]},url:{type:String,default:""}},bo={},we={loading:()=>!0,load:()=>!0,tileloadstart:()=>!0,tileload:()=>!0,tileunload:()=>!0,tileerror:()=>!0},To={init:e=>e instanceof T.TileLayer},Co=s(s({},wo),bo),ko=s(s({},we),To);function So(e,o){const{url:t,minZoom:n,maxZoom:i,errorTileUrl:l,opacity:c,zIndex:r,bounds:p}=e;return new T.TileLayer(t,s({minZoom:n,maxZoom:i,errorTileUrl:l,opacity:c,zIndex:r,bounds:p.length?z(p):void 0},o))}function xo({props:e,instance:o}){a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.zIndex,t=>t&&o.setZIndex(t)),a.watch(()=>e.url,t=>t&&o.setUrl(t))}const be=a.defineComponent({name:"TdtTilelayer",props:Co,emits:ko,setup(e,{emit:o,attrs:t}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>i&&(n==null?void 0:n.removeLayer(i)));const n=yield w(),i=So(e,t);n.addLayer(i),f({events:we,emit:o,instance:i}),xo({props:e,instance:i}),o("init",i)})),()=>{}}}),Lo={minZoom:{type:Number},maxZoom:{type:Number},errorTileUrl:{type:String},opacity:{type:Number},zIndex:{type:Number},bounds:{type:Array,default:()=>[]},url:{type:String,default:""}},Mo={},Te={loading:()=>!0,load:()=>!0,tileloadstart:()=>!0,tileload:()=>!0,tileunload:()=>!0,tileerror:()=>!0},Po={init:e=>e instanceof T.TileLayer.TDT},Oo=s(s({},Lo),Mo),Bo=s(s({},Te),Po);function zo(e,o){const{url:t,minZoom:n,maxZoom:i,errorTileUrl:l,opacity:c,zIndex:r,bounds:p}=e;return new T.TileLayer.TDT(t,s({minZoom:n,maxZoom:i,errorTileUrl:l,opacity:c,zIndex:r,bounds:p.length?z(p):void 0},o))}function No({props:e,instance:o}){a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.zIndex,t=>t&&o.setZIndex(t)),a.watch(()=>e.url,t=>t&&o.setUrl(t))}const Ce=a.defineComponent({name:"TdtTilelayerTdt",props:Oo,emits:Bo,setup(e,{emit:o,attrs:t}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>i&&(n==null?void 0:n.removeLayer(i)));const n=yield w(),i=zo(e,t);n.addLayer(i),f({events:Te,emit:o,instance:i}),No({props:e,instance:i}),o("init",i)})),()=>{}}}),Do={layers:{type:String},styles:{type:String},format:{type:String},transparent:{type:Boolean},version:{type:String},srs:{type:String},url:{type:String,default:""}},Io={opacity:{type:Number},zIndex:{type:Number}},ke={loading:()=>!0,load:()=>!0,tileloadstart:()=>!0,tileload:()=>!0,tileunload:()=>!0,tileerror:()=>!0},jo={init:e=>e instanceof T.TileLayer.WMS},Zo=s(s({},Do),Io),Ao=s(s({},ke),jo);function Eo(e,o){const{url:t,layers:n,styles:i,format:l,transparent:c,version:r,srs:p}=e;return new T.TileLayer.WMS(t,s({layers:n,styles:i,format:l,transparent:c,version:r,srs:p},o))}function Fo({props:e,instance:o}){a.watch(()=>e.opacity,t=>t&&o.setOpacity(t),{immediate:!0}),a.watch(()=>e.zIndex,t=>t&&o.setZIndex(t),{immediate:!0}),a.watch(()=>e.url,t=>t&&o.setUrl(t))}const Se=a.defineComponent({name:"TdtTilelayerWms",props:Zo,emits:Ao,setup(e,{emit:o,attrs:t}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>i&&(n==null?void 0:n.removeLayer(i)));const n=yield w(),i=Eo(e,t);n.addLayer(i),f({events:ke,emit:o,instance:i}),Fo({props:e,instance:i}),o("init",i)})),()=>{}}}),Ro={tileSize:{type:Number,default:256},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:18},opacity:{type:Number,default:1},outlineSize:{type:Object,default:()=>({width:1,style:"solid",color:"#999"})},textSize:{type:Object,default:()=>({display:!1,fontSize:"14",fontWeight:!0,color:"black"})}},Uo={zIndex:{type:Number}},xe={loading:()=>!0,load:()=>!0},_o={init:e=>e instanceof T.GridlineLayer},Wo=s(s({},Ro),Uo),Vo=s(s({},xe),_o);function $o(e){const{tileSize:o,minZoom:t,maxZoom:n,opacity:i,outlineSize:l,textSize:c}=e;return new T.GridlineLayer({tileSize:o,minZoom:t,maxZoom:n,opacity:i,outlineSize:l,textSize:c})}function Ko({props:e,instance:o}){a.watch(()=>e.opacity,t=>t&&o.setOpacity(t)),a.watch(()=>e.zIndex,t=>t&&o.setZIndex(t))}const Le=a.defineComponent({name:"TdtGridlineLayer",props:Wo,emits:Vo,setup(e,{emit:o}){return a.onBeforeMount(()=>h(this,null,function*(){a.onUnmounted(()=>n&&(t==null?void 0:t.removeLayer(n)));const t=yield w(),n=$o(e);t.addLayer(n),f({events:xe,emit:o,instance:n}),Ko({props:e,instance:n}),o("init",n)})),()=>{}}});function Go(e,o){function t(r=e.queryType,p=e.keyword,y=0){var d,g,P;e.queryType=r,e.keyword=p,e.current=1,(d=e.localSearch)==null||d.setSpecifyAdminCode(y),e.keyword?(g=e.localSearch)==null||g.search(e.keyword,e.queryType):((P=e.localSearch)==null||P.clearResults(),e.target=null,e.pois=!1,e.statistics=!1,e.area=!1,e.suggests=!1,e.prompt=!1,e.lineData=!1)}function n(r){e.target=null,e.pois=r.pois,e.statistics=r.statistics,e.area=r.area,e.suggests=r.suggests,e.prompt=r.prompt,e.lineData=r.lineData,e.total=Number(r.count),o("search-complete",r)}function i(r){var p;const y=r.lonlat.split(" ").map(Number);(p=e.tdtMap)==null||p.panTo(b(y)),e.target=y,e.content=`
      <strong>${r.name}</strong>
      <div>地址：${r.address}</div>
      <div>坐标：${r.lonlat}</div>
      `,o("poi-click",r)}function l(r){t(1,r.name,Number(r.gbCode)),o("suggest-click",r)}function c(r){var p;e.current=r.current||1,(p=e.localSearch)==null||p.gotoPage(e.current)}return{onSearch:We(t,100),onSearchComplete:n,onPoiClick:i,onSuggestClick:l,onPageChange:c}}function Ho(){const e={tdtMap:null,localSearch:null,keyword:"",queryType:1,showRoute:!1},o={pois:!1,statistics:!1,area:!1,suggests:!1,prompt:!1,lineData:!1},t={markers:[],target:null,content:"",current:1,total:0};return a.reactive(s(s(s({},e),o),t))}const qo=a.defineComponent({setup(){return()=>u("svg",{class:"tdt-icon",attrs:{t:"1636975674954",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7028",width:"200",height:"200"}},[u("path",{attrs:{d:"M789.804097 737.772047 742.865042 784.699846 898.765741 940.600545 945.704796 893.672746Z","p-id":"7029"}}),u("path",{attrs:{d:"M456.92259 82.893942c-209.311143 0-379.582131 170.282245-379.582131 379.582131s170.270988 379.570875 379.582131 379.570875c209.287607 0 379.558595-170.270988 379.558595-379.570875S666.210197 82.893942 456.92259 82.893942zM770.128989 462.477097c0 172.721807-140.508127 313.229934-313.206398 313.229934-172.720783 0-313.229934-140.508127-313.229934-313.229934s140.508127-313.229934 313.229934-313.229934C629.620861 149.247162 770.128989 289.75529 770.128989 462.477097z","p-id":"7030"}})])}}),Yo=a.defineComponent({setup(){return()=>u("svg",{class:"tdt-icon",attrs:{t:"1638934785539",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"8230",width:"200",height:"200"}},[u("path",{attrs:{d:"M301.952 387.669333l144.981333 54.357334c56.234667 21.077333 113.578667 80.597333 132.565334 137.557333l15.658666 46.933333a42.666667 42.666667 0 1 1-80.981333 26.965334l-15.616-46.933334c-10.88-32.512-49.493333-72.533333-81.578667-84.608L155.733333 423.936c-38.016-14.250667-36.522667-68.565333 2.261334-80.64l682.666666-213.333333a42.666667 42.666667 0 0 1 53.418667 53.418666l-213.333333 682.666667a42.666667 42.666667 0 0 1-81.408-25.429333l189.013333-604.928-486.4 151.978666z","p-id":"8231"}})])}}),Me=a.defineComponent({setup(){return()=>u("svg",{class:"tdt-icon",attrs:{t:"1636975957032",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7161",width:"200",height:"200"}},[u("path",{attrs:{d:"M562.281173 510.800685l294.996664-293.466821c13.94971-13.878079 14.020318-36.367279 0.14224-50.316989-13.913894-13.984503-36.367279-14.020318-50.316989-0.14224L512.034792 460.377272 219.528855 166.982082c-13.842263-13.878079-36.367279-13.94971-50.316989-0.071631-13.913894 13.878079-13.948687 36.403095-0.071631 50.352805L461.576587 510.587837 166.721139 803.876604c-13.94971 13.878079-14.020318 36.367279-0.14224 50.316989 6.939039 6.974855 16.084327 10.497075 25.229614 10.497075 9.073656 0 18.148335-3.451612 25.087375-10.354835l294.926056-293.360398 295.17472 296.064996c6.939039 6.974855 16.048511 10.462283 25.193799 10.462283 9.109472 0 18.184151-3.487428 25.12319-10.390651 13.913894-13.878079 13.94971-36.367279 0.071631-50.316989L562.281173 510.800685z","p-id":"7162"}})])}}),V=a.defineComponent({props:{value:{type:String,default:""},modelValue:{type:String,default:""},placeholder:{type:String,default:"输入关键字搜索"},searchBtn:{type:Boolean,default:!0},routeBtn:{type:Boolean,default:!0}},emits:{input:e=>!0,"update:modelValue":e=>!0,search:e=>!0},setup(e,{emit:o,slots:t}){let n=!1;const i=a.computed({get(){return a.isVue2?e.value:e.modelValue},set(l){a.isVue2?o("input",l):o("update:modelValue",l)}});return()=>u("div",{class:"tdt-search-box"},[u("input",{class:"tdt-search-box__input",attrs:{type:"text",placeholder:e.placeholder},domProps:{value:i.value},on:{compositionstart:()=>n=!0,compositionend:()=>n=!1,input:l=>setTimeout(()=>!n&&(i.value=l.target.value)),keyup:l=>l.code==="Enter"&&o("search",i.value)}}),u("i",{class:"tdt-search-box__close",style:{display:e.value||e.modelValue?"block":"none"},on:{click:()=>i.value=""}},[u(Me)]),$e(t.default)])}}),Jo=a.defineComponent({props:{suggests:{type:Array,default:()=>[]}},emits:{"suggest-click":e=>!0},setup(e,{emit:o}){return()=>u("div",{class:"tdt-search-suggests",style:{display:e.suggests.length?"block":"none"}},e.suggests.map(t=>u("div",{class:"search-suggests-item",on:{click:()=>o("suggest-click",t)}},[u("span",{class:"search-suggests-item__name"},t.name),u("span",{class:"search-suggests-item__address"},t.address)])))}}),Qo=a.defineComponent({props:{current:{type:Number,default:1},size:{type:Number,default:10},total:{type:Number,default:0}},emits:{"update:current":e=>!0},setup(e,{emit:o}){const t=a.computed(()=>Math.ceil(Number(e.total)/Number(e.size))),n=a.computed({get(){return e.current},set(i){let l=i;i<1&&(l=1),i>t.value&&(l=t.value),o("update:current",l)}});return()=>u("div",{class:"tdt-search-page"},[u("span",{class:"tdt-search-page__btn first-page",on:{click:()=>n.value=1}},"«"),u("span",{class:"tdt-search-page__btn prev-page",on:{click:()=>n.value--}},"‹"),u("span",null,n.value),u("span",null," / "),u("span",null,t.value),u("span",{class:"tdt-search-page__btn next-page",on:{click:()=>n.value++}},"›"),u("span",{class:"tdt-search-page__btn last-page",on:{click:()=>n.value=t.value}},"»")])}}),Pe=a.defineComponent({props:{pois:{type:Array,default:()=>[]},page:{type:Object}},emits:{"poi-click":e=>!0,"update:page":e=>!0},setup(e,{emit:o}){return()=>{var t,n,i;return u("div",{class:"tdt-search-pois",style:{display:e.pois.length?"block":"none"}},[...e.pois.map(l=>u("div",{class:"search-pois-item",on:{click:()=>o("poi-click",l)}},[u("strong",{class:"search-pois-item__name"},l.name),u("br"),u("span",{class:"search-pois-item__address"},l.address)])),u(Qo,{props:{current:(t=e.page)==null?void 0:t.current,size:(n=e.page)==null?void 0:n.size,total:(i=e.page)==null?void 0:i.total},on:{"update:current":l=>{o("update:page",j(s({},e.page||{}),{current:l}))}}})])}}}),Xo=a.defineComponent({props:{pois:{type:Array,default:()=>[]},target:{type:Array,default:()=>null},content:{type:String,default:""}},emits:{"poi-click":e=>!0,"update-target":e=>!0},setup(e,{emit:o}){const t=a.computed(()=>e.pois.map(n=>({position:n.lonlat.split(" ").map(Number),extData:n})));return a.onBeforeMount(()=>h(this,null,function*(){const n=yield w();a.watch(t,()=>{n==null||n.setViewport(S(t.value.map(i=>i.position)))})})),()=>u("div",null,[...t.value.map(n=>u(N,{props:s({},n),on:{click:()=>o("poi-click",n.extData)}})),u(W,{props:{target:e.target,content:e.content,offset:[0,-30],minWidth:150},on:{"update:target":n=>o("update-target",n)}})])}});function en(e){return h(this,null,function*(){const{onSearchComplete:o,onDrivingComplete:t,onTransitComplete:n}=Oe(e);e.tdtMap=yield w(),e.localSearch=new T.LocalSearch(e.tdtMap,{pageCapacity:10,onSearchComplete:o}),e.drivingRoute=new T.DrivingRoute(e.tdtMap,{policy:e.drivingPolicy,onSearchComplete:t}),e.transitRoute=new T.TransitRoute(e.tdtMap,{policy:e.transitPolicy,onSearchComplete:n})})}function tn(e){function o(){e.drivingLines=[],e.walkLines=[],e.busLines=[],e.busMarkers=[],e.metroMarkers=[]}function t(){e.transitPlans=[],e.transitPlanIndex=0,e.drivingPlans=[],e.drivingPlanIndex=0}a.watch(()=>{const{startMarker:n,endMarker:i,routeType:l,drivingPolicy:c,transitPolicy:r}=e;return{startMarker:n,endMarker:i,routeType:l,drivingPolicy:c,transitPolicy:r}},({startMarker:n,endMarker:i,routeType:l,drivingPolicy:c,transitPolicy:r})=>{var p,y,d,g,P,Ne;if(t(),o(),n.length&&i.length)switch(l){case 0:(p=e.drivingRoute)==null||p.setPolicy(c),(y=e.drivingRoute)==null||y.search(b(n),b(i));break;case 1:(d=e.transitRoute)==null||d.setPolicy(r),(g=e.transitRoute)==null||g.search(b(n),b(i));break;case 2:(P=e.drivingRoute)==null||P.setPolicy(4),(Ne=e.drivingRoute)==null||Ne.search(b(n),b(i));break}},{immediate:!0}),a.watch(()=>({drivingPlans:e.drivingPlans,drivingPlanIndex:e.drivingPlanIndex}),({drivingPlans:n,drivingPlanIndex:i})=>{var l;o();const{routelatlon:c}=n[i]||{};if(!c)return;const r=c.split(";").filter(p=>p).map(p=>p.split(",").map(Number));e.drivingLines.push(r),(l=e.tdtMap)==null||l.setViewport(S(e.drivingLines.flat()))},{immediate:!0}),a.watch(()=>({transitPlans:e.transitPlans,transitPlanIndex:e.transitPlanIndex}),({transitPlans:n,transitPlanIndex:i})=>{var l;o();const{segments:c}=n[i]||{};!c||(c.forEach(r=>{const p=r.segmentLine.map(d=>d.linePoint.split(";").filter(g=>g).map(g=>g.split(",").map(Number))),y=[r.stationStart,r.stationEnd].map(d=>d.lonlat.split(",").map(Number));switch(r.segmentType){case 1:case 4:e.walkLines.push(...p);break;case 2:e.busMarkers.push(...y),e.busLines.push(...p);break;case 3:e.metroMarkers.push(...y),e.busLines.push(...p);break}}),(l=e.tdtMap)==null||l.setViewport(S([...e.busLines,...e.walkLines].flat())))},{immediate:!0})}function Oe(e){function o(r){e.pois=r.pois}function t(r){e.drivingPlans=[],e.drivingPlans=[r.results]}function n(r){e.transitPlans=[],e.transitPlans=r.results.lines}function i(r,p,y){var d;e.pois=[],e.poiType=y,e[`${y}Keyword`]=p,p&&((d=e.localSearch)==null||d.search(p,r))}function l(r){e[`${e.poiType}Keyword`]=r.name,e[`${e.poiType}Marker`]=r.lonlat.split(" ").map(Number),e.pois=[]}function c(r){var p;e.current=r.current||1,(p=e.localSearch)==null||p.gotoPage(e.current)}return{onSearchComplete:o,onDrivingComplete:t,onTransitComplete:n,onSearch:i,onPoiClick:l,onPageChange:c}}function Z(){const e={tdtMap:null,localSearch:null,startKeyword:"",startMarker:[],endKeyword:"",endMarker:[],routeType:0,poiType:"start",pois:[],current:1,total:0},o={drivingRoute:null,drivingLines:[],drivingPolicy:0,drivingPlans:[],drivingPlanIndex:0},t={transitRoute:null,transitPlans:[],transitPlanIndex:0,transitPolicy:1,walkLines:[],busLines:[],busMarkers:[],metroMarkers:[]};return a.inject("routeState")||a.reactive(s(s(s({},e),o),t))}const on=a.defineComponent({setup(){const e=Z();return()=>u("span",null,[e.startMarker.length?u(N,{props:{position:e.startMarker,icon:{iconUrl:"http://lbs.tianditu.gov.cn/images/bus/start.png",iconSize:[44,34],iconAnchor:[12,31]}}}):"",e.endMarker.length?u(N,{props:{position:e.endMarker,icon:{iconUrl:"http://lbs.tianditu.gov.cn/images/bus/end.png",iconSize:[44,34],iconAnchor:[12,31]}}}):"",e.drivingLines.map(o=>u(A,{props:{path:o,color:"#2C64A7",lineStyle:"solid",weight:5,opacity:1}})),e.walkLines.map(o=>u(A,{props:{path:o,color:"#2E9531",lineStyle:"dashed",weight:4,opacity:1}})),e.busLines.map(o=>u(A,{props:{path:o,color:"#2C64A7",lineStyle:"solid",weight:4,opacity:1}})),e.busMarkers.map(o=>u(N,{props:{position:o,icon:{iconUrl:"http://lbs.tianditu.gov.cn/images/bus/map_bus.png",iconSize:[23,23],iconAnchor:[12,12]}}})),e.metroMarkers.map(o=>u(N,{props:{position:o,icon:{iconUrl:"http://lbs.tianditu.gov.cn/images/bus/map_metro.png",iconSize:[23,23],iconAnchor:[12,12]}}}))])}}),nn=a.defineComponent({setup(){const e=Z();return()=>u("div",{class:"route-plans"},[e.drivingPlans.length?u("div",null,e.drivingPlans.map((o,t)=>u("details",{on:{click:()=>{e.drivingPlanIndex=t}}},[u("summary",null,`方案${t+1}: ${o.duration} 秒 | ${o.distance} 公里`),...o.routes.item.map((n,i)=>u("div",null,`${i+1}.${n.strguide}`))]))):"",e.drivingPlans.length?u("div",null,e.transitPlans.map((o,t)=>u("details",{on:{click:()=>{e.transitPlanIndex=t}},style:{backgroundColor:"#fff"}},[u("summary",null,`方案${t+1}: ${o.lineName}`),o.segments.map((n,i)=>{const l=n.segmentLine[0],c=l.segmentStationCount?"，经过"+l.segmentStationCount+"站":"";switch(n.segmentType){case 1:return"步行约"+l.segmentDistance+"米，到达"+n.stationEnd.name;case 2:case 3:return"乘坐"+l.direction+c+"，到达"+n.stationEnd.name;case 4:return"站内换乘";default:return""}}).join("，")+"终点"]))):""])}}),an=a.defineComponent({setup(){const e=Z(),o={0:"最少时间",1:"最短距离",2:"避开高速"},t={1:"最少时间",2:"最少换乘",4:"最少步行",8:"不乘地铁"};return()=>u("div",{class:"route-policies"},[...e.routeType===0?Object.entries(o).map(([n,i])=>u("div",{class:"route-policies-item"+(e.drivingPolicy==Number(n)?" active":""),on:{click:()=>e.drivingPolicy=Number(n)}},i)):[],...e.routeType===1?Object.entries(t).map(([n,i])=>u("div",{class:"route-policies-item"+(e.transitPolicy==Number(n)?" active":""),on:{click:()=>e.transitPolicy=Number(n)}},i)):[]])}}),ln=a.defineComponent({setup(){const e=Z(),{onSearch:o,onPoiClick:t,onPageChange:n}=Oe(e);return()=>u("div",{class:"route-search"},[u(V,{props:{value:e.startKeyword,modelValue:e.startKeyword,placeholder:"请输入起点"},on:{focus:()=>e.poiType="start",input:i=>o(1,i,"start"),"update:modelValue":i=>o(1,i,"start")}}),u(V,{props:{value:e.endKeyword,modelValue:e.endKeyword,placeholder:"请输入终点"},on:{focus:()=>e.poiType="end",input:i=>o(1,i,"end"),"update:modelValue":i=>o(1,i,"end")}}),u(Pe,{props:{pois:e.pois||[],page:{current:e.current,size:10,total:e.total}},on:{"poi-click":t,"update:page":n}})])}}),sn=a.defineComponent({setup(){const e=Z(),o={0:"驾车",1:"公交",2:"步行"};return()=>u("div",{class:"route-types"},[...Object.entries(o).map(([t,n])=>u("div",{class:"route-types-item"+(e.routeType==Number(t)?" active":""),on:{click:()=>e.routeType=Number(t)}},n))])}}),$=a.defineComponent({name:"TdtRoute",setup(){const e=Z();return a.provide("routeState",e),a.onBeforeMount(()=>h(this,null,function*(){yield en(e),tn(e)})),()=>u("div",{class:"tdt-route",on:s({},X(e.tdtMap))},[u(sn),u(ln),u(an),u(nn),u(on)])}}),Be=a.defineComponent({name:"TdtSearch",props:{placeholder:{type:String,default:"输入关键字搜索"},searchBtn:{type:Boolean,default:!0},routeBtn:{type:Boolean,default:!0}},emits:{"poi-click":e=>!0,"suggest-click":e=>!0,"search-complete":e=>!0},setup(e,{emit:o}){const t=Ho(),{onSearchComplete:n,onPoiClick:i,onSuggestClick:l,onSearch:c,onPageChange:r}=Go(t,o);return a.onBeforeMount(()=>h(this,null,function*(){t.tdtMap=yield w(),t.localSearch=new T.LocalSearch(t.tdtMap,{pageCapacity:10,onSearchComplete:n})})),()=>u("div",{class:"tdt-search",on:s({},X(t.tdtMap))},t.showRoute?[u($),u("i",{class:"tdt-search-route__close",on:{click:()=>t.showRoute=!1}},[u(Me)])]:[u(V,{props:{value:t.keyword,modelValue:t.keyword,placeholder:e.placeholder},on:{input:p=>{t.keyword=p,c(4,p)},"update:modelValue":p=>{t.keyword=p,c(4,p)},search:p=>c(1,p)},scopedSlots:{default:()=>[e.searchBtn&&u("button",{class:"tdt-search-box__btn",on:{click:()=>c(1)}},[u(qo)]),e.routeBtn&&u("button",{class:"tdt-search-box__btn",on:{click:()=>t.showRoute=!0}},[u(Yo)])]}}),u(Jo,{props:{suggests:t.suggests||[]},on:{"suggest-click":l}}),u(Pe,{props:{pois:t.pois||[],page:{current:t.current,size:10,total:t.total}},on:{"poi-click":i,"update:page":r}}),u(Xo,{props:{pois:t.pois||[],target:t.target,content:t.content},on:{"poi-click":i,"update:target":p=>t.target=p}})])}}),rn={interval:{type:Number,default:1e3},speed:{type:Number,default:0},dynamicLine:{type:Boolean,default:!1},Datas:{type:Array,default:()=>[]},carstyle:{type:Object},polylinestyle:{type:Object}},cn={},un={},pn={init:e=>e instanceof T.CarTrack,passOneNode:(e,o,t)=>!0},dn=s(s({},rn),cn),mn=s(s({},un),pn);function yn(e,o,t){const{interval:n,speed:i,dynamicLine:l,Datas:c,carstyle:r,polylinestyle:p}=e;return new T.CarTrack(t,{interval:n,speed:i,dynamicLine:l,Datas:S(c),carstyle:r,polylinestyle:p,passOneNode:(y,d,g)=>{o("passOneNode",[y.lng,y.lat],d,g)}})}const ze=a.defineComponent({name:"TdtCarTrack",props:dn,emits:mn,setup(e,{emit:o,expose:t}){return a.onBeforeMount(()=>h(this,null,function*(){var n;if(a.onUnmounted(()=>l==null?void 0:l.clear()),t==null||t({start:c,pause:r,stop:p,clear:y}),a.isVue2){const d=(n=a.getCurrentInstance())==null?void 0:n.proxy;d.star=c,d.paus=r,d.sto=p}const i=yield w();let l=null;a.watch(()=>e.Datas,d=>{l==null||l.clear(),l=null,d.length&&(l=yn(e,o,i),o("init",l))},{immediate:!0});function c(){l==null||l.start()}function r(){l==null||l.pause()}function p(){l==null||l.stop()}function y(){l==null||l.clear()}})),()=>{}}});var fn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TdtMap:te,TdtControl:ne,TdtMousetool:ae,TdtMarker:N,TdtLabel:le,TdtPolyline:A,TdtPolygon:ce,TdtRectangle:pe,TdtCircle:me,TdtInfowindow:W,TdtCloudMarkerCollection:ge,TdtMarkerClusterer:ve,TdtTilelayer:be,TdtTilelayerTdt:Ce,TdtTilelayerWms:Se,TdtGridlineLayer:Le,TdtSearch:Be,TdtRoute:$,TdtCarTrack:ze}),gn={install:(e,o)=>{F(o),Object.values(fn).forEach(t=>{e.component(t.name,t)})}};m.TdtCarTrack=ze,m.TdtCircle=me,m.TdtCloudMarkerCollection=ge,m.TdtControl=ne,m.TdtGridlineLayer=Le,m.TdtInfowindow=W,m.TdtLabel=le,m.TdtMap=te,m.TdtMarker=N,m.TdtMarkerClusterer=ve,m.TdtMousetool=ae,m.TdtPolygon=ce,m.TdtPolyline=A,m.TdtRectangle=pe,m.TdtRoute=$,m.TdtSearch=Be,m.TdtTilelayer=be,m.TdtTilelayerTdt=Ce,m.TdtTilelayerWms=Se,m.default=gn,m.objectFilter=Q,m.toBounds=z,m.toIcon=R,m.toLngLat=b,m.toLngLats=S,m.toMarker=_,m.toPoint=M,m.useApiLoader=F,Object.defineProperty(m,"__esModule",{value:!0}),m[Symbol.toStringTag]="Module"})})(G,G.exports);var kn=G.exports;export{kn as v};

var Z=(c,r,v)=>new Promise((g,a)=>{var w=s=>{try{y(v.next(s))}catch(d){a(d)}},h=s=>{try{y(v.throw(s))}catch(d){a(d)}},y=s=>s.done?g(s.value):Promise.resolve(s.value).then(w,h);y((v=v.apply(c,r)).next())});import{_ as x}from"./vueRepl-a238c739.js";import{d as Se,ar as U,R as Te,am as xe}from"./index-4e626338.js";/* empty css                         *//* empty css                */import{_ as oe}from"./EditorWorker.vue_vue_type_script_setup_true_lang-44860150.js";/* empty css                     */import{_ as le}from"./hCode-f0cdea69.js";import"./el-tooltip-4ed993c7.js";/* empty css                  */import"./fileTypeEnum-eae25d97.js";/* empty css                    *//* empty css                  *//* empty css                *//* empty css                 */import{_ as De}from"./SettingItem-0e9c370f.js";/* empty css                 */import{d as ne,a7 as W,r as C,g as F,f as K,o as f,c as X,u as l,s as R,w as t,h as k,a as e,a6 as p,F as Ae,ah as ee,G as se,H as re,aJ as D,al as te,a5 as Re,y as ke,x as J,z as Ie,a0 as be,k as Ve}from"./vue-65382a1b.js";import{bz as ae,bA as Fe,bB as A}from"./index-55ccac47.js";import{i as Le}from"./icon-24f36b03.js";import{T as Q,D as B}from"./index.d-4993f78d.js";import{_ as Ne}from"./index-806da9dd.js";/* empty css                *//* empty css                    */import"./el-collapse-item-4ed993c7.js";/* empty css                   *//* empty css               */import{u as ie}from"./useTargetData.hook-7e83673b.js";import{g as ze}from"./plugin-68db7aa1.js";import{c as Be}from"./http-0d114cdb.js";import{k as ue,n as ce,p as de,d as Ue,an as Pe,o as qe,U as $e,T as Me,i as _e,ao as Oe,al as je,a5 as He,x as Ge,w as Je,ab as Qe,C as We,a4 as Ke}from"./elementPlus-07602b2b.js";import{_ as pe}from"./xgplayerVue-c27b6911.js";import{u as Xe}from"./useFile.hooks-6b86f602.js";const Y=c=>(se("data-v-20a6fde0"),c=c(),re(),c),Ye=Y(()=>k("p",null,[k("span",{class:"func-keyword"},"function"),p("  filter(data, res)  { ")],-1)),Ze={class:"go-ml-4"},et=Y(()=>k("p",null,"}",-1)),tt=Y(()=>k("span",{class:"func-keyword"},"function",-1)),at=ne({__name:"index",setup(c){const{targetData:r,chartEditStore:v}=ie();W(r.value.request),W(v.getRequestGlobalConfig);const g=C(!1),a=C(r.value.filter||"return data"),w=C(!1),h=C(""),y=()=>Z(this,null,function*(){try{const i=yield Be(ee(r.value.request),ee(v.getRequestGlobalConfig));if(i){h.value=i;return}window.$message.warning("数据异常，请检查参数！")}catch(i){window.$message.warning("数据异常，请检查参数！")}}),s=F(()=>{try{const i=new Function("data","res",a.value),u=Se(h.value),m=i(u==null?void 0:u.data,u);return w.value=!1,U(m)}catch(i){return w.value=!0,"过滤函数错误"}}),d=()=>{g.value=!0},I=()=>{ze({message:"是否删除过滤器",onPositiveCallback:()=>{r.value.filter=void 0}})},L=()=>{g.value=!1},P=()=>{if(w.value){window.$message.error("过滤函数错误，无法进行保存");return}r.value.filter=a.value,L()};return K(()=>g.value,i=>{i&&(y(),a.value=r.value.filter||"return data")}),(i,u)=>{const m=le,S=ue,q=ce,$=de,N=Ue,M=Pe,O=qe,b=$e,j=Me,n=_e,o=Oe,_=je,H=Ne;return f(),X(Ae,null,[l(r).filter?(f(),R($,{key:0,shadow:"never"},{default:t(()=>[Ye,k("div",Ze,[e(m,{code:l(r).filter,language:"typescript"},null,8,["code"])]),et,e(q,{alignment:"end"},{default:t(()=>[e(S,{type:"primary",tertiary:"",size:"small",onClick:d},{default:t(()=>[p(" 编辑 ")]),_:1}),e(S,{tertiary:"",size:"small",onClick:I},{default:t(()=>[p(" 删除 ")]),_:1})]),_:1})]),_:1})):(f(),R(S,{key:1,type:"primary",onClick:d},{default:t(()=>[p(" 新增过滤器 ")]),_:1})),e(H,{"custom-class":"FunEditorDialog",modelValue:g.value,"onUpdate:modelValue":u[1]||(u[1]=E=>g.value=E),title:"过滤器函数编辑器"},{footer:t(()=>[e(S,{onClick:L},{default:t(()=>[p("取消")]),_:1}),e(S,{type:"primary",onClick:P},{default:t(()=>[p("保存")]),_:1})]),default:t(()=>[e(_,{style:{height:"680px"}},{default:t(()=>[e(M,{style:{padding:"0"}},{default:t(()=>[k("div",null,[e(N,{size:"large",type:"info"},{default:t(()=>[tt,p("  filter(data, res)  { ")]),_:1}),e(l(oe),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=E=>a.value=E),height:"610px",language:"javascript"},null,8,["modelValue"]),e(N,{size:"large",type:"info"},{default:t(()=>[p("}")]),_:1})])]),_:1}),e(O,{direction:"vertical",style:{height:"680px"}}),e(o,{width:"300px"},{default:t(()=>[e(n,null,{default:t(()=>[e(j,{"model-value":[1,2,3]},{default:t(()=>[e(b,{title:"默认过滤数据(data)",name:1},{default:t(()=>{var E;return[e(m,{code:l(U)((E=h.value)==null?void 0:E.data)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]}),_:1}),e(b,{title:"接口返回数据(res)",name:2},{default:t(()=>[e(m,{code:l(U)(h.value)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1}),e(b,{title:"过滤器结果",name:3},{default:t(()=>[e(m,{code:s.value||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const ot=pe(at,[["__scopeId","data-v-20a6fde0"]]),lt=c=>(se("data-v-6c2d8c5e"),c=c(),re(),c),nt=lt(()=>k("p",null,"过滤器默认处理接口返回值的「data」字段",-1)),st={key:1,style:{padding:"10px"}},rt={key:0,class:"text-right"},it=ne({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(c){const r=D(()=>x(()=>import("./BarsAndLines-02c993be.js"),["static/js/BarsAndLines-02c993be.js","static/js/index-806da9dd.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/css/index-a29e27ad.css","static/css/el-overlay-1d67a486.css","static/js/el-tooltip-4ed993c7.js","static/css/BarsAndLines-6efc6494.css","static/css/el-table-5bb7fb37.css","static/css/el-checkbox-e117c7b0.css","static/css/el-tag-2fca7a82.css","static/css/el-popper-b17b6765.css","static/css/el-scrollbar-df5aa9a0.css","static/css/el-button-46bfe638.css","static/css/el-table-column-d409cc84.css","static/css/el-input-9bb615ea.css","static/css/el-icon-b1770749.css"])),v=D(()=>x(()=>import("./Pies-849f8160.js"),["static/js/Pies-849f8160.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/js/el-tooltip-4ed993c7.js","static/css/Pies-4d91540c.css","static/css/el-popper-b17b6765.css","static/css/el-input-9bb615ea.css"])),g=D(()=>x(()=>import("./Scatters-16886496.js"),["static/js/Scatters-16886496.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/js/el-tooltip-4ed993c7.js","static/css/Scatters-f5344120.css","static/css/el-popper-b17b6765.css","static/css/el-input-9bb615ea.css"])),{targetData:a}=ie(),{DocumentAddIcon:w,DocumentDownloadIcon:h}=Le.carbon,{dimensions:y}=W(a.value.option.dataset),s=F(()=>{var n,o;return((n=a.value)==null?void 0:n.data)||((o=a.value)==null?void 0:o.option.dataset)||"此组件无数据源"}),d=C(!1),I=C(null);function L(){I.value=JSON.stringify(s.value,null,2)}function P(){a.value.data=JSON.parse(I.value),d.value=!1}const i=C(),u=C(!1),{uploadFileListRef:m,customRequest:S,beforeUpload:q,download:$}=Xe(a),N=F(()=>a.value.request.requestDataType!==Te.STATIC),M=F(()=>a.value.chartConfig.chartFrame===ae.ECHARTS),O=n=>{let o=B.SUCCESS;for(let _=0;_<s.value.length;_++)if(s.value[_][n]===void 0)return o=B.FAILURE,o;return B.SUCCESS},b=()=>{try{return y.value.map((n,o)=>o===0?{field:"通用标识",mapping:n,result:B.NULL}:{field:`数据项-${o}`,mapping:n,result:O(n)})}catch(n){return[]}},j=F(()=>{if(a.value)switch(a.value.chartConfig.category){case A.BAR:return r;case A.LINE:return r;case A.PIE:return v;case A.SCATTER:return g;case A.RADAR:return D(()=>x(()=>import("./Radar-703bae49.js"),["static/js/Radar-703bae49.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/css/Radar-431b2e64.css","static/css/el-input-9bb615ea.css"]));case A.TREE_MAP:return D(()=>x(()=>import("./TreeMap-753cec01.js"),["static/js/TreeMap-753cec01.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/css/TreeMap-02c5090f.css","static/css/el-input-9bb615ea.css"]));case A.FUNNEl:return D(()=>x(()=>import("./Funnel-ce351de2.js"),["static/js/Funnel-ce351de2.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/css/Funnel-e777d0b2.css","static/css/el-input-9bb615ea.css"]));case Fe.TABLE:return D(()=>x(()=>import("./ElTable-a0be1ba9.js"),["static/js/ElTable-a0be1ba9.js","static/js/index-4e626338.js","static/js/vue-65382a1b.js","static/js/elementPlus-07602b2b.js","static/js/vuema-115cb50e.js","static/js/lodash-f91682a1.js","static/js/xgplayerVue-c27b6911.js","static/js/vueRepl-a238c739.js","static/css/index-bc362552.css","static/js/index-55ccac47.js","static/js/echarts-676dbcd6.js","static/css/ElTable-c587cf5a.css","static/css/el-button-46bfe638.css","static/css/el-icon-b1770749.css","static/css/el-table-column-d409cc84.css","static/css/el-checkbox-e117c7b0.css","static/css/el-tag-2fca7a82.css","static/css/el-input-9bb615ea.css"]));default:return null}});return K(()=>{var n;return(n=a.value)==null?void 0:n.data},n=>{var o,_;n&&((_=(o=a==null?void 0:a.value)==null?void 0:o.chartConfig)==null?void 0:_.chartFrame)===ae.ECHARTS||(n!=null?i.value=null:u.value=!0),xe(n)&&(i.value=null)},{immediate:!0}),K(y,()=>{M.value&&(i.value=b())}),(n,o)=>{const _=He,H=Ge,E=De,z=ce,G=Je,V=ue,me=Qe,fe=te("QuestionFilled"),ve=We,ge=le,he=te("Edit"),ye=_e,Ee=oe,Ce=de,we=Ke;return f(),R(we,{style:{"padding-left":"10px"}},{default:t(()=>[e(_,{color:"#2a2a2b",size:"large",hollow:!0,type:"info",timestamp:l(Q).MAPPING,placement:"top"},{default:t(()=>[(f(),R(Re(j.value),{targetData:l(a),dataMapping:l(a).dataMapping||[]},null,8,["targetData","dataMapping"]))]),_:1},8,["timestamp"]),ke(e(_,{type:"warning",color:"#2a2a2b",size:"large",hollow:!0,timestamp:l(Q).FILTER,placement:"top"},{default:t(()=>[l(a).filter?J("",!0):(f(),R(E,{key:0,name:"过滤节点(添加过滤器配置过滤节点失效)"},{default:t(()=>[e(H,{style:{width:"100%"},modelValue:l(a).filterNode,"onUpdate:modelValue":o[0]||(o[0]=T=>l(a).filterNode=T)},null,8,["modelValue"])]),_:1})),e(z,{direction:"vertical",alignment:"start",fill:"",style:{width:"100%"}},{default:t(()=>[nt,e(l(ot))]),_:1})]),_:1},8,["timestamp"]),[[Ie,N.value]]),e(_,{type:"success",color:"#2a2a2b",size:"large",hollow:!0,timestamp:l(Q).CONTENT,placement:"top"},{default:t(()=>[e(z,{direction:"horizontal","fill-ratio":100,fill:"",style:{width:"100%"}},{default:t(()=>[e(z,null,{default:t(()=>[e(me,{"file-list":l(m),"onUpdate:fileList":o[1]||(o[1]=T=>be(m)?m.value=T:null),"show-file-list":!1,"http-request":l(S),onBeforeUpload:l(q)},{default:t(()=>[e(z,null,{default:t(()=>[c.ajax?J("",!0):(f(),R(V,{key:0,class:"sourceBtn-item",disabled:u.value},{icon:t(()=>[e(G,{size:14},{default:t(()=>[e(l(w))]),_:1})]),default:t(()=>[p(" 导入（json / txt） ")]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["file-list","http-request","onBeforeUpload"]),e(V,{class:"sourceBtn-item",disabled:u.value,onClick:l($)},{icon:t(()=>[e(G,{size:14},{default:t(()=>[e(l(h))]),_:1})]),default:t(()=>[p(" 下载 ")]),_:1},8,["disabled","onClick"]),e(ve,{content:"点击【下载】查看完整数据"},{default:t(()=>[e(G,{size:16},{default:t(()=>[e(fe)]),_:1})]),_:1})]),_:1}),e(Ce,{shadow:"never",style:{padding:"0",position:"relative"}},{default:t(()=>[d.value?(f(),X("div",st,[e(Ee,{height:"400px",modelValue:I.value,"onUpdate:modelValue":o[3]||(o[3]=T=>I.value=T),language:"json",editorOptions:{lineNumbers:"off",lineDecorationsWidth:-10,minimap:{enabled:!1}}},null,8,["modelValue"])])):(f(),R(ye,{key:0,"wrap-style":"height:400px;padding:10px;"},{default:t(()=>[e(ge,{code:l(U)(s.value),language:"json"},null,8,["code"]),e(V,{class:"edit",text:"",circle:"",type:"primary",size:"small",onClick:o[2]||(o[2]=Ve(T=>{d.value=!0,L()},["stop"]))},{default:t(()=>[e(he,{style:{width:"15px",height:"15px"}})]),_:1})]),_:1}))]),_:1}),d.value?(f(),X("div",rt,[e(V,{onClick:o[4]||(o[4]=T=>d.value=!1)},{default:t(()=>[p("取消")]),_:1}),e(V,{type:"primary",onClick:P},{default:t(()=>[p("保存")]),_:1})])):J("",!0)]),_:1})]),_:1},8,["timestamp"])]),_:1})}}});const Mt=pe(it,[["__scopeId","data-v-6c2d8c5e"]]);export{Mt as C};

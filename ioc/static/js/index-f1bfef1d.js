var D=Object.defineProperty;var H=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var T=(e,o,t)=>o in e?D(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,w=(e,o)=>{for(var t in o||(o={}))ee.call(o,t)&&T(e,t,o[t]);if(H)for(var t of H(o))te.call(o,t)&&T(e,t,o[t]);return e};var z=(e,o,t)=>new Promise((r,s)=>{var c=a=>{try{n(t.next(a))}catch(l){s(l)}},i=a=>{try{n(t.throw(a))}catch(l){s(l)}},n=a=>a.done?r(a.value):Promise.resolve(a.value).then(c,i);n((t=t.apply(e,o)).next())});import{t as F,af as m}from"./index-4e626338.js";import{a as j,g as E,b as G}from"./style-2d240cf8.js";import"./axios-ba46900f.js";import{u as K,c as ne,s as oe,a as U}from"./useEvent.hook-afeb4a8c.js";import{d as $,o as h,c as f,q as b,m as W,u,n as R,s as S,a3 as X,ao as Y,a5 as L,F as x,g as C,r as v,A as ie,B as _,aa as re,b as A,f as se,p as O,h as ae,a as P,x as k}from"./vue-65382a1b.js";import{_ as I}from"./xgplayerVue-c27b6911.js";import{a as ce,f as N,b as le}from"./index-55ccac47.js";import{g as de}from"./storage-b4c0d534.js";import"./echarts-676dbcd6.js";import"./lodash-f91682a1.js";import{u as ue,C as he}from"./chartEditStore-8641b951.js";import{p as q}from"./config-84ed6ba6.js";const V=(e,o)=>({zIndex:o+1,left:`${e.x}px`,top:`${e.y}px`}),M=(e,o)=>({width:`${o?o*e.w:e.w}px`,height:`${o?o*e.h:e.h}px`}),we=e=>{const o=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return w({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},o)},pe=(e,o,t,r,s)=>{const c=e,i=o,n={width:1,height:1},a=parseFloat((c/i).toFixed(5)),l=()=>{let p=r&&r.clientWidth||window.innerWidth,J=r&&r.clientHeight||window.innerHeight;const Z=parseFloat((p/J).toFixed(5));t&&(Z>a?(n.width=parseFloat((window.innerHeight*a/c).toFixed(5)),n.height=parseFloat((window.innerHeight/i).toFixed(5)),t.style.transform=`scale(${n.width}, ${n.height})`):(n.height=parseFloat((p/a/i).toFixed(5)),n.width=parseFloat((p/c).toFixed(5)),t.style.transform=`scale(${n.width}, ${n.height})`),s&&s(n))},d=F(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},fe=(e,o,t,r,s)=>{const c=e,i=o,n={width:1,height:1},a=parseFloat((c/i).toFixed(5)),l=()=>{if(t){let p=r&&r.clientWidth||window.innerWidth;n.height=parseFloat((p/a/i).toFixed(5)),n.width=parseFloat((p/c).toFixed(5)),t.style.transform=`scale(${n.width}, ${n.height})`,s&&s(n)}},d=F(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},ge=(e,o,t,r,s)=>{const c=e,i=o,n={height:1,width:1},a=parseFloat((c/i).toFixed(5)),l=()=>{if(t){let p=r&&r.clientHeight||window.innerHeight;n.width=parseFloat((p*a/c).toFixed(5)),n.height=parseFloat((p/i).toFixed(5)),t.style.transform=`scale(${n.width}, ${n.height})`,s&&s(n)}},d=F(()=>{l()},200);return{calcRate:l,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},ve=(e,o,t,r,s)=>{const c={width:1,height:1},i=()=>{if(t){let d=r&&r.clientWidth||window.innerWidth,y=r&&r.clientHeight||window.innerHeight;c.width=parseFloat((d/e).toFixed(5)),c.height=parseFloat((y/o).toFixed(5)),t.style.transform=`scale(${c.width}, ${c.height})`,s&&s(c)}},n=F(()=>{i()},200);return{calcRate:i,windowResize:()=>{window.addEventListener("resize",n)},unWindowResize:()=>{window.removeEventListener("resize",n)}}},me=$({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(o,t)=>(h(!0),f(x,null,b(e.groupData.groupList,r=>(h(),f("div",{class:W(["chart-item",u(j)(r.styles.animations)]),key:r.id,style:R(w(w(w({},u(V)(r.attr,e.groupIndex)),u(E)(r.styles)),u(G)(r.styles)))},[(h(),S(L(r.chartConfig.chartKey),X({chartConfig:r,themeSetting:e.themeSetting,themeColor:e.themeColor,style:w({},u(M)(r.attr))},Y(u(K)(r,this))),null,16,["chartConfig","themeSetting","themeColor","style"]))],6))),128))}});const ye=I(me,[["__scopeId","data-v-53617bd8"]]),Ce=["id"],_e=$({__name:"index",props:{localStorageInfo:{type:Object,required:!0}},setup(e){const o=e,t=C(()=>o.localStorageInfo.editCanvasConfig.chartThemeSetting),r=C(()=>{const s=o.localStorageInfo.editCanvasConfig.chartThemeColor;return ce[s]});return(s,c)=>(h(!0),f(x,null,b(e.localStorageInfo.componentList,(i,n)=>(h(),f("div",{id:i.id,class:W(["chart-item",u(j)(i.styles.animations)]),key:i.id,style:R(w(w(w({},u(V)(i.attr,n)),u(E)(i.styles)),u(G)(i.styles)))},[i.isGroup?(h(),S(u(ye),{key:0,groupData:i,groupIndex:n,themeSetting:t.value,themeColor:r.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(h(),S(L(i.chartConfig.chartKey),X({key:1,ref_for:!0,ref:i.id,chartConfig:i,themeSetting:t.value,themeColor:r.value,style:w({},u(M)(i.attr))},Y(u(K)(i,this))),null,16,["chartConfig","themeSetting","themeColor","style"]))],14,Ce))),128))}});const B=I(_e,[["__scopeId","data-v-8a577c0e"]]),Re=e=>{const o=v(!1),t=setInterval(()=>{if(window.$vue.component){clearInterval(t);const r=s=>{window.$vue.component(s.chartConfig.chartKey)||window.$vue.component(s.chartConfig.chartKey,le(s.chartConfig))};e.componentList.forEach(s=>z(void 0,null,function*(){s.isGroup?s.groupList.forEach(c=>{r(c)}):r(s)})),e.globalDialog.forEach(s=>z(void 0,null,function*(){window.$vue.component(s.component)||window.$vue.component(s.component,N(s.component)),window.$vue.component(s.body.component.is)||window.$vue.component(s.body.component.is,N(s.body.component.is))})),o.value=!0}},200);return{show:o}},Se=e=>{const o=v(),t=v(),r=v(),s=v(e.editCanvasConfig.width),c=v(e.editCanvasConfig.height);return ie(()=>{switch(console.dir(o.value),console.dir(r.value),e.editCanvasConfig.previewScaleType){case m.FIT:(()=>{const{calcRate:i,windowResize:n,unWindowResize:a}=pe(s.value,c.value,t.value,r.value);i(),n(),_(()=>{a()})})();break;case m.SCROLL_Y:(()=>{const{calcRate:i,windowResize:n,unWindowResize:a}=fe(s.value,c.value,t.value,r.value,l=>{const d=o.value;d.style.width=`${s.value*l.width}px`,d.style.height=`${c.value*l.height}px`});i(),n(),_(()=>{a()})})();break;case m.SCROLL_X:(()=>{const{calcRate:i,windowResize:n,unWindowResize:a}=ge(s.value,c.value,t.value,r.value,l=>{const d=o.value;d.style.width=`${s.value*l.width}px`,d.style.height=`${c.value*l.height}px`});i(),n(),_(()=>{a()})})();break;case m.FULL:(()=>{const{calcRate:i,windowResize:n,unWindowResize:a}=ve(s.value,c.value,t.value,r.value);i(),n(),_(()=>{a()})})();break}}),{entityRef:o,previewRef:t,contextRef:r}},xe=e=>{const o=ue();o.requestGlobalConfig=e[he.REQUEST_GLOBAL_CONFIG]};function Q(e,o,t){const r=U();return e.fun&&r.on(o.key,(...s)=>{new Function(...o.paramsName,e.fun).call(this,...s)}),e.configFun&&r.on(o.key,(...s)=>{debugger;e.configFun.trigger.forEach(c=>{let i=t[c.type].find(n=>n.id=c.targetId);if(i){const n=o.paramsName;let a={};if(n.forEach((l,d)=>{a[l]=s[d]}),!ne(e.configFun.filters))return;console.log("output->",a),oe(c,i,a)}})}),{emitEvent:r}}function Fe(e,{rootConfig:o}){if(!e)return{};const t=re(),r=A(s());function s(){let i={};return e.forEach(n=>{i[n.field]=t[n.field]||n.default}),i}function c(){e.forEach(i=>{const{emitEvent:n}=Q(i,q,o);se(()=>r[i.field],(a,l)=>{console.log("output->",a,l,o),n.emit(q.key,a,l,o)},{immediate:!0})})}return c(),{props:r}}function ze(e,{rootConfig:o}){const t=U();return e&&e.forEach(r=>{const s=C(()=>{let i=[],n=r.eventArgs.map(a=>(i.push(a.field),{label:a.field,value:"${"+a.field+"}",type:a.type}));return i.push("rootConfig"),{key:"IframeEvent",name:"iframe触发事件",paramsName:i,vars:n}}),{emitEvent:c}=Q(r,s.value,o);t.on(r.eventName,i=>{let n=Object.keys(i).map(a=>i[a]);console.log("output->",n),c.emit(s.value.key,...n,o)})}),{iframeEmitEvent:t}}const ke=$({__name:"index",props:{rootConfig:{}},setup(e){const t=A(e.rootConfig||de()),r=ze(t.globalIframeEvent,{rootConfig:t});Fe(t.globalProps,{rootConfig:t}),O("rootConfig",t),O("rootIframeEmit",r.iframeEmitEvent);const s=C(()=>w(w({},we(t.editCanvasConfig)),E(t.editCanvasConfig))),c=C(()=>{const d=t.editCanvasConfig.previewScaleType;return d===m.SCROLL_Y||d===m.SCROLL_X});xe(t);const{entityRef:i,previewRef:n,contextRef:a}=Se(t),{show:l}=Re(t);return(d,y)=>(h(),f("div",{ref_key:"contextRef",ref:a,class:W(`kh-preview ${u(t).editCanvasConfig.previewScaleType}`)},[c.value?(h(),f("div",{key:0,ref_key:"entityRef",ref:i,class:"kh-preview-entity"},[ae("div",{ref_key:"previewRef",ref:n,class:"kh-preview-scale"},[u(l)?(h(),f("div",{key:0,style:R(s.value)},[P(u(B),{localStorageInfo:u(t)},null,8,["localStorageInfo"])],4)):k("",!0)],512)],512)):(h(),f("div",{key:1,ref_key:"previewRef",ref:n,class:"kh-preview-scale"},[u(l)?(h(),f("div",{key:0,style:R(s.value)},[P(u(B),{localStorageInfo:u(t)},null,8,["localStorageInfo"])],4)):k("",!0)],512)),(h(!0),f(x,null,b(u(t).globalDialog,(g,p)=>(h(),f(x,{key:p},[g.show?(h(),S(L(g.component),{key:0,config:g},null,8,["config"])):k("",!0)],64))),128))],2))}});const je=I(ke,[["__scopeId","data-v-bd23ed49"]]);export{je as P};
